{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MkDocs For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"index"},{"location":"#welcome-to-mkdocs","text":"For full documentation visit mkdocs.org .","title":"Welcome to MkDocs"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"Linux%20%E7%A7%91%E5%AD%A6%E4%B8%8E%E5%B7%A5%E7%A8%8B/","text":"Linux \u79d1\u5b66\u4e0e\u5de5\u7a0b \u79d1\u5b66\u6ce8\u91cd\u601d\u60f3\u548c\u7406\u5ff5\uff0c\u8d70\u5728\u4e8b\u7269\u53d1\u5c55\u7684\u524d\u7aef\uff0c\u65b9\u6848\u6781\u7aef\uff0c\u4e0d\u7a33\u5b9a\uff1b \u5de5\u7a0b\u6ce8\u91cd\u5e73\u8861\u548c\u5b9e\u8df5\uff0c\u7a33\u6b65\u524d\u884c\uff0c\u901a\u5e38\u4f1a\u662f\u591a\u4e2a\u6781\u7aef\u65b9\u6848\u7684\u6298\u4e2d\u3002 \u4e0b\u9762\u6211\u4eec\u770b\u4e00\u4e0b \u5927\u4f6cPeter\u5bf9Linux\u76f8\u5173\u7684\u95ee\u9898\u6536\u96c6 \u7b2c\u4e00\u90e8\u5206\u3001\u79d1\u5b66 Linux\u5185\u5b58\u7ba1\u7406 Linux\u8fdb\u7a0b\u7ba1\u7406 \u7b2c\u4e8c\u90e8\u5206\u3001\u5de5\u7a0b Linux\u8c03\u5f0f\u8c03\u4f18","title":"Linux \u79d1\u5b66\u4e0e\u5de5\u7a0b"},{"location":"Linux%20%E7%A7%91%E5%AD%A6%E4%B8%8E%E5%B7%A5%E7%A8%8B/#linux","text":"\u79d1\u5b66\u6ce8\u91cd\u601d\u60f3\u548c\u7406\u5ff5\uff0c\u8d70\u5728\u4e8b\u7269\u53d1\u5c55\u7684\u524d\u7aef\uff0c\u65b9\u6848\u6781\u7aef\uff0c\u4e0d\u7a33\u5b9a\uff1b \u5de5\u7a0b\u6ce8\u91cd\u5e73\u8861\u548c\u5b9e\u8df5\uff0c\u7a33\u6b65\u524d\u884c\uff0c\u901a\u5e38\u4f1a\u662f\u591a\u4e2a\u6781\u7aef\u65b9\u6848\u7684\u6298\u4e2d\u3002 \u4e0b\u9762\u6211\u4eec\u770b\u4e00\u4e0b \u5927\u4f6cPeter\u5bf9Linux\u76f8\u5173\u7684\u95ee\u9898\u6536\u96c6","title":"Linux \u79d1\u5b66\u4e0e\u5de5\u7a0b"},{"location":"Linux%20%E7%A7%91%E5%AD%A6%E4%B8%8E%E5%B7%A5%E7%A8%8B/#_1","text":"Linux\u5185\u5b58\u7ba1\u7406 Linux\u8fdb\u7a0b\u7ba1\u7406","title":"\u7b2c\u4e00\u90e8\u5206\u3001\u79d1\u5b66"},{"location":"Linux%20%E7%A7%91%E5%AD%A6%E4%B8%8E%E5%B7%A5%E7%A8%8B/#_2","text":"Linux\u8c03\u5f0f\u8c03\u4f18","title":"\u7b2c\u4e8c\u90e8\u5206\u3001\u5de5\u7a0b"},{"location":"Operating%20System/","text":"Go \u7684IO \u9996\u8981\u95ee\u9898\uff0c\u5185\u6838\u4e2d\u7684\u7f13\u51b2\u548c\u8fdb\u7a0b\u4e2d\u7684\u7f13\u51b2 \u5185\u6838\u4e2d\u7684\u7f13\u51b2 \u65e0\u8bba\u8fdb\u7a0b\u662f\u5426\u63d0\u4f9b\u7f13\u51b2\uff0c\u5185\u6838\u90fd\u662f\u63d0\u4f9b\u7f13\u51b2\u7684\uff0c\u7cfb\u7edf\u5bf9\u78c1\u76d8\u7684\u8bfb\u5199\u90fd\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u7f13\u51b2\uff08page/buffer cache\uff09\uff0c\u5c06\u6570\u636e\u5199\u5165\u5230\u9875/\u5757\u7f13\u51b2\u8fdb\u884c\u6392\u961f\uff0c\u5f53\u9875/\u5757\u7f13\u51b2\u8fbe\u5230\u4e00\u5b9a\u7684\u91cf\u65f6\uff0c\u624d\u80fd\u628a\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002 \u8fdb\u7a0b\u4e2d\u7684\u7f13\u51b2 \u662f\u6307\u5bf9\u8f93\u5165\u8f93\u51fa\u6d41\u8fdb\u884c\u4e86\u6539\u8fdb\uff0c\u63d0\u4f9b\u4e86\u6d41\u7f13\u51b2\u3002\u5f53\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u5411\u78c1\u76d8\u5199\u6570\u636e\u65f6\uff0c\u5148\u628a\u6570\u636e\u5199\u5165\u7f13\u51b2\u533a\uff0c\u5f53\u8fbe\u5230\u67d0\u4e2a\u6761\u4ef6\u540e\uff0c\u5982\u6d41\u7f13\u51b2\u6ee1\u4e86\uff0c\u6216\u8005\u5237\u65b0\u6d41\u7f13\u51b2\uff0c\u8fd9\u65f6\u5019\u624d\u4f1a\u628a\u6570\u636e\u4e00\u6b21\u9001\u5f80\u5185\u6838\u63d0\u4f9b\u7684\u9875/\u5757\u7f13\u51b2\u533a\u4e2d\uff0c\u518d\u7ecf\u9875/\u5757\u5316\u91cd\u5199\u5165\u78c1\u76d8\u3002 Operating System --- linux\u7684\u6587\u4ef6I/O\u7cfb\u7edf \u5f15\u8a00 \u64cd\u4f5c\u7cfb\u7edf\u9996\u5148\u662f\u4e00\u4e2a\u7cfb\u7edf\uff0c\u4e00\u822c\u7531\u4e0d\u540c\u7684\u6a21\u5757\u7ec4\u6210\uff0c\u5f80\u5f80\u4e3b\u8981\u529f\u80fd\u662fxxx\u7684 \u589e\u5220\u6539\u67e5 \u529f\u80fd\u3002\u64cd\u4f5c\u7cfb\u7edf\u4e3b\u8981\u662f\u7ba1\u7406\u786c\u4ef6\u548c\u63d0\u4f9b\u7ed9\u6211\u4eec\u4e00\u4e2a\u8212\u9002\u7684\u5f00\u53d1\u73af\u5883\u7684\u4f5c\u7528\u3002 \u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a \u5b50\u7cfb\u7edf \uff08VFS\u7b97\u4e00\u4e2a\uff09\uff0c\u5404\u4e2a\u5b50\u7cfb\u7edf\u53c8\u6709\u591a\u4e2a \u6a21\u5757 \u3002 \u4e3a\u4ec0\u4e48\u5904\u7406\u5668\u8bbe\u6709\u4e24\u79cd\u6a21\u5f0f\uff1f \u5185\u6838\u6001\u548c\u7528\u6237\u6001\uff0c \u5b89\u5168\u7b2c\u4e00 \u3002 \u865a\u62df\u5185\u5b58\u3002\u5176\u5b9e\u672c\u8d28\u4e0a\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u5c06\u7a0b\u5e8f\u5e38\u7528\u7684\u6570\u636e\u653e\u5230\u5185\u5b58\u91cc\u52a0\u901f\u8bbf\u95ee\uff0c\u4e0d\u5e38\u7528\u7684\u6570\u636e\u653e\u5728\u78c1\u76d8\u4e0a\u3002 \u8fd9\u4e00\u5207\u5bf9\u7528\u6237\u7a0b\u5e8f\u6765\u8bf4\u5b8c\u5168\u662f\u900f\u660e\u7684\uff0c\u7528\u6237\u7a0b\u5e8f\u53ef\u4ee5\u5047\u88c5\u6240\u6709\u6570\u636e\u90fd\u5728\u5185\u5b58\u91cc\uff0c\u7136\u540e\u901a\u8fc7\u865a\u62df\u5185\u5b58\u5730\u5740\u53bb\u8bbf\u95ee\u6570\u636e\u3002\u5728\u8fd9\u80cc\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u5728\u4e3b\u5b58\u548c\u78c1\u76d8\u4e4b\u95f4\u8fdb\u884c\u4ea4\u6362\u3002 \u64cd\u4f5c\u7cfb\u7edf\u5bf9\u5185\u5b58\u7684\u7ba1\u7406\u673a \u7a81\u7136\u60f3\u5230\u4e00\u4e2a\u54f2\u5b66\u95ee\u9898\uff0c\u8ddf\u751f\u6d3b\u662f\u76f8\u5173\u7684\u3002\u50cf\u6211\u4eec\u5e73\u65f6\u751f\u6d3b\u4e00\u6837\uff0c\u603b\u662f\u5c3d\u53ef\u80fd\u7684\u628a\u6bcf\u4e2a\u4e1c\u897f\u7528\u5c3d \u7528\u597d \u7528\u5230\u5b83\u7684\u6700\u5927\u6781\u9650\u3002\u540c\u7406\uff0c Go \u8bed\u8a00\u7684\u5185\u5b58\u7ba1\u7406\u662f\u53c2\u8003 tcmalloc \u5b9e\u73b0\u7684\uff0c\u5b83\u5176\u5b9e\u5c31\u662f\u5229\u7528\u597d\u4e86 OS \u7ba1\u7406\u5185\u5b58\u7684\u8fd9\u4e9b\u7279\u70b9\uff0c\u6765\u6700\u5927\u5316\u5185\u5b58\u5206\u914d\u6027\u80fd\u7684\u3002 Go \u8bed\u8a00\u662f\u5982\u4f55\u5229\u7528\u5e95\u5c42\u7684\u8fd9\u4e9b\u7279\u6027\u6765\u4f18\u5316\u5185\u5b58\u7684\uff1f \u5185\u5b58\u5206\u914d\u5927\u591a\u65f6\u5019\u90fd\u662f \u5728\u7528\u6237\u6001 \u5b8c\u6210\u7684\uff0c\u4e0d\u9700\u8981\u9891\u7e41\u8fdb\u5165\u5185\u6838\u6001\u3002 \u6bcf\u4e2a P \u90fd\u6709\u72ec\u7acb\u7684 span cache\uff0c\u591a\u4e2a CPU \u4e0d\u4f1a\u5e76\u53d1\u8bfb\u5199\u540c\u4e00\u5757\u5185\u5b58\uff0c\u8fdb\u800c\u51cf\u5c11 CPU L1 cache \u7684 cacheline \u51fa\u73b0 dirty \u60c5\u51b5\uff0c\u589e\u5927 cpu cache \u547d\u4e2d\u7387\u3002 \u5185\u5b58\u788e\u7247\u7684\u95ee\u9898\uff0cGo \u662f\u81ea\u5df1\u5728\u7528\u6237\u6001\u7ba1\u7406\u7684\uff0c\u5728 OS \u5c42\u9762\u770b\u662f\u6ca1\u6709\u788e\u7247\u7684\uff0c\u4f7f\u5f97\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u5bf9\u788e\u7247\u7684\u7ba1\u7406\u538b\u529b\u4e5f\u4f1a\u964d\u4f4e\u3002 mcache \u7684\u5b58\u5728\u4f7f\u5f97\u5185\u5b58\u5206\u914d\u4e0d\u9700\u8981\u52a0\u9501\u3002 Linux\u4e2dVFS ---> \u6587\u4ef6IO\u7cfb\u7edf \u200b \u5982\u4e0a\u56fe\u6240\u793a\uff0cpage cache\u7684\u672c\u8d28\u662f\u7531 Linux \u5185\u6838\u7ba1\u7406\u7684\u5185\u5b58\u533a\u57df\u3002\u6211\u4eec\u901a\u8fc7 mmap \u4ee5\u53ca buffered IO \u5c06\u6587\u4ef6\u8bfb\u53d6\u5230\u5185\u5b58\u7a7a\u95f4\u3002\u5b9e\u9645\u4e0a\uff0c\u90fd\u662f\u8bfb\u53d6\u5230 page cache\u4e2d\u3002 page cache \u9664\u4e86 Direct IO\uff0c\u4e0e\u78c1\u76d8\u76f8\u5173\u7684\u6587\u4ef6\u8bfb\u5199\u90fd\u6709\u4f7f\u7528\u5230 page cache\u6280\u672f kernel 2.6\u4ee5\u540e\uff08\u5f15\u5165\u4e86\u865a\u62df\u5185\u5b58\uff09\uff0cpage cache \u9762\u5411\u6587\u4ef6 \u6587\u4ef6I/O \uff08\u7cfb\u7edfI/O\uff09\u64cd\u4f5c\u53ea\u548cpage cache\u4ea4\u4e92 \u7528\u5728\u6240\u6709 \u4ee5\u6587\u4ef6\u4e3a\u5355\u5143 \u7684\u573a\u666f\u4e2d\uff0c\u6bd4\u5982\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf address_space \u4f5c\u4e3a\u6587\u4ef6\u7cfb\u7edf\u548c\u9875\u7f13\u5b58\u7684\u4e2d\u95f4\u9002\u914d\u5668\uff0c\u7528\u6765\u6307\u793a\u4e00\u4e2a\u6587\u4ef6\u5728page cache\u4e2d\u5df2\u7ecf\u7f13\u5b58\u4e86\u7684\u7269\u7406\u9875 \u5982\u4f55\u67e5\u770bOS\u7684 page cache? \u901a\u8fc7\u8bfb\u53d6 /proc/meminfo \u6587\u4ef6\uff0c\u80fd\u591f\u5b9e\u65f6\u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u60c5\u51b5\uff1a shell $ cat /proc/meminfo ... Buffers: 1224 kB Cached: 111472 kB SwapCached: 36364 kB Active: 6224232 kB Inactive: 979432 kB Active(anon): 6173036 kB Inactive(anon): 927932 kB Active(file): 51196 kB Inactive(file): 51500 kB ... Shmem: 10000 kB ... SReclaimable: 43532 kB ... \u6839\u636e\u4e0a\u9762\u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u7b80\u5355\u5f97\u51fa\u8fd9\u6837\u7684\u516c\u5f0f\uff1a page cache = buffers + cached + swap = active + inactive + share + swap \u4e3a\u4ec0\u4e48 swap \u548c buffers \u4e5f\u662f page cache\u7684\u4e00\u90e8\u5206\uff1f \u56e0\u4e3a\u5f53\u533f\u540d\u9875 Inactive(anon)\u4ee5\u53ca Active(anon) \u5148\u88ab\u4ea4\u6362\u5230\u78c1\u76d8\uff08out\uff09\u540e\uff0c\u7136\u540e\u518d\u52a0\u8f7d\u56de\uff08in\uff09\u5185\u5b58\u4e2d\uff0c\u7531\u4e8e\u8bfb\u5165\u5230\u5185\u5b58\u540e\u539f\u6765\u5730 swap file \u8fd8\u5728\uff0c\u6240\u4ee5 swap cached \u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f File-backed page\uff0c\u5373\u5c5e\u4e8e page cache\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a page \u548c page cache page \u662f\u5185\u6838\u5185\u5b58\u7ba1\u7406\u5206\u914d\u7684\u57fa\u672c\u5355\u4f4d\uff084KB\uff09 page cache \u7531\u591a\u4e2apage\u6784\u6210\uff084KB\u7684\u6574\u6570\u500d\uff09 \u6ce8\u610f \uff1a\u5e76\u4e0d\u662f\u6240\u6709 page \u90fd\u88ab\u7ec4\u7ec7\u6210\u4e3a page cache Linux \u7cfb\u7edf\u4e0a\u4f9b\u7528\u6237\u53ef\u8bbf\u95ee\u7684\u5185\u5b58\u5206\u4e3a\u4e24\u4e2a\u7c7b\u578b\uff1a File-backed pages: \u6587\u4ef6\u5907\u4efd\u9875\uff0c\u4e5f\u5c31\u662fpage cache\u4e2d\u7684 page\uff0c\u5bf9\u5e94\u4e8e\u78c1\u76d8\u4e0a\u7684\u82e5\u5e72\u6570\u636e\u5757\uff1b\u5bf9\u4e8e\u8fd9\u4e9b\u9875\u6700\u5927\u7684\u95ee\u9898\u662f\u810f\u9875\u56de\u76d8 Anonymous pages: \u533f\u540d\u9875\u4e0d\u5bf9\u5e94\u78c1\u76d8\u4e0a\u7684\u4efb\u4f55\u78c1\u76d8\u6570\u636e\u5757\uff0c\u4ed6\u4eec\u662f\u8fdb\u7a0b\u7684\u8fd0\u884c\u5185\u5b58\u7a7a\u95f4\uff0c\u6bd4\u5982\u65b9\u6cd5\u6808\u3001\u5c40\u90e8\u53d8\u91cf\u7b49\u5c5e\u6027 \u4e24\u79cd\u7c7b\u578b\u5728 swap \u673a\u5236\u4e0b\u7684\u6027\u80fd\u6bd4\u8f83\uff1a File-backed pages\u7684\u5185\u5b58\u56de\u6536\u4ee3\u4ef7\u8f83\u4f4e\u3002page cache \u901a\u5e38\u5bf9\u5e94\u4e8e\u4e00\u4e2a\u6587\u4ef6\u4e0a\u7684\u82e5\u5e72\u987a\u5e8f\u5757\uff0c \u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7\u987a\u5e8fIO\u7684\u65b9\u5f0f\u843d\u76d8\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c page cache \u4e0a\u6ca1\u6709\u8fdb\u884c\u5199\u64cd\u4f5c\uff08\u5373\u6ca1\u6709\u810f\u9875\uff09\uff0c\u751a\u81f3\u4e0d\u4f1a\u5c06page cache \u56de\u76d8\uff0c\u56e0\u4e3a\u6570\u636e\u7684\u5185\u5bb9\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7\u518d\u6b21\u8bfb\u53d6\u78c1\u76d8\u6587\u4ef6\u5f97\u5230\u3002 page cache \u7684\u4e3b\u8981\u96be\u70b9\u5728\u4e8e\u810f\u9875\u56de\u76d8\uff0c\u600e\u4e48\u4e2a\u96be\u6cd5\u5462\uff1f Anonymous pages \u7684\u5185\u5b58\u4f1a\u540e\u4ee3\u4ef7\u8f83\u9ad8\u3002\u56e0\u4e3a\u8fd9\u79cdpages \u901a\u5e38\u968f\u673a\u5730\u5199\u5165\u6301\u4e45\u5316\u4ea4\u6362\u8bbe\u5907\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u65e0\u8bba\u662f\u5426\u6709\u5199\u64cd\u4f5c\uff0c\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u4e0d\u4e22\u5931\uff0cAnonymous pages\u5728swap\u65f6\u5fc5\u987b\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 swap \u4e0e \u7f3a\u9875\u4e2d\u65ad swap \u673a\u5236 \u6307\u5730\u662f\u5f53\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\uff0c\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08MMU\uff09\u9700\u8981\u63d0\u4f9b \u8c03\u5ea6\u7b97\u6cd5 \u6765\u56de\u6536\u76f8\u5173\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u5c06\u6e05\u7406\u51fa\u6765\u5730\u5185\u5b58\u7a7a\u95f4\u7ed9\u5f53\u524d\u5185\u5b58\u7533\u8bf7\u65b9\u3002 swap \u5b58\u5728\u5730\u672c\u8d28\u539f\u56e0\u662f Linux \u7cfb\u7edf\u63d0\u4f9b\u4e86\u865a\u62df\u5185\u5b58\u7ba1\u7406\u673a\u5236\u3002\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u8ba4\u4e3a\u81ea\u5df1\u72ec\u5360\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u6b64\u6240\u6709\u8fdb\u7a0b\u5730\u5185\u5b58\u7a7a\u95f4\u4e4b\u548c\u8fdc\u8fdc\u5927\u4e8e\u7269\u7406\u5185\u5b58\u3002\u6240\u6709\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u4e4b\u548c\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u7684\u90e8\u5206\u5c31\u9700\u8981\u4ea4\u6362\u5230\u78c1\u76d8\u4e0a\u3002 OS\u4ee5 page \u4e3a\u5355\u4f4d\u7ba1\u7406\u5185\u5b58\uff0c\u5f53\u8fdb\u7a0b\u53d1\u73b0\u9700\u8981\u8bbf\u95ee\u7684\u6570\u636e\u4e0d\u5728\u5185\u5b58\u65f6\uff0cOS\u53ef\u80fd\u4f1a\u5c06\u6570\u636e\u4ee5\u9875\u7684\u65b9\u5f0f\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u4e0a\u8ff0\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u7f3a\u9875\u4e2d\u65ad\u3002\u5f53OS\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u5c06 page \u518d\u6b21\u8bfb\u5230\u5185\u5b58\u4e2d\u3002 \u4f46\u4e3b\u5185\u5b58\u7684\u7a7a\u95f4\u65f6\u6709\u9650\u7684\uff0c\u5f53\u4e3b\u5185\u5b58\u4e2d\u4e0d\u5305\u542b\u53ef\u4ee5\u4f7f\u7528\u7684\u7a7a\u95f4\u65f6\uff0cOS\u4f1a\u9009\u62e9\u5408\u9002\u7684\u7269\u7406\u5185\u5b58\u9010\u9875\u9a71\u9010\u56de\u78c1\u76d8\uff0c\u4e3a\u65b0\u7684\u5185\u5b58\u9875\u8ba9\u51fa\u4f4d\u7f6e\uff0c\u9009\u62e9\u5f85\u9a71\u9010\u9875\u7684\u8fc7\u7a0b\u5728OS\u4e2d\u53eb\u505a\u9875\u9762\u66ff\u6362\uff08page replacement\uff09,\u66ff\u6362\u64cd\u4f5c\u53c8\u4f1a\u89e6\u53d1 swap \u673a\u5236\u3002 \u5982\u679c\u7269\u7406\u5185\u5b58\u8db3\u591f\u5927\uff0c\u90a3\u4e48\u53ef\u80fd\u4e0d\u9700\u8981 swap \u673a\u5236\uff0c\u4f46\u662f swap \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8fd8\u662f\u6709\u4e00\u5b9a\u4f18\u52bf\uff1a\u5bf9\u4e8e\u6709\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\u51e0\u7387\u7684\u5e94\u7528\u7a0b\u5e8f\uff08\u8fdb\u7a0b\uff09, swap\u4ea4\u6362\u5206\u533a\u66f4\u662f\u91cd\u8981\uff0c\u8fd9\u53ef\u4ee5\u786e\u4fdd\u5185\u5b58\u6cc4\u6f0f\u4e0d\u81f3\u4e8e\u5bfc\u81f4\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\uff0c\u6700\u7ec8\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\u3002\u4f46\u5185\u5b58\u6cc4\u6f0f\u4f1a\u5f15\u8d77\u9891\u7e41\u7684 swap\uff0c\u6b64\u65f6\u4f1a\u975e\u5e38\u5f71\u54cdOS\u7684\u6027\u80fd\u3002 Linux \u901a\u8fc7\u4e00\u4e2a swappiness \u53c2\u6570\u6765\u63a7\u5236 swap \u673a\u5236\uff1a\u8fd9\u4e2a\u53c2\u6570\u53ef\u4e3a 0~100\uff0c\u63a7\u5236\u7cfb\u7edfswap\u7684\u4f18\u5148\u7ea7\u3002 \u9ad8\u6570\u503c\uff0c\u8f83\u9ad8\u9891\u7387\u7684swap\uff0c\u8fdb\u7a0b\u4e0d\u6d3b\u8dc3\u65f6\u5c06\u5176\u8f6c\u6362\u51fa\u7269\u7406\u5185\u5b58 \u4f4e\u6570\u503c\uff0c\u8f83\u4f4e\u9891\u7387\u7684swap\uff0c\u8fd9\u53ef\u4ee5\u786e\u4fdd\u4ea4\u4e92\u5f0f\u4e0d\u56e0\u4e3a\u5185\u5b58\u7a7a\u95f4\u9891\u7e41\u5730\u4ea4\u6362\u5230\u78c1\u76d8\u800c\u63d0\u9ad8\u54cd\u5e94\u5ef6\u8fdf\u3002 page cache \u548c buffer cache shell ~ free -m total used free shared buffers cached Mem: 128956 96440 32515 0 5368 39900 -/+ buffers/cache: 51172 77784 Swap: 16002 0 16001 \u5176\u4e2d\uff0ccached \u8868\u793a\u5f53\u524d\u7684\u9875\u7f13\u5b58\uff08page cache\uff09\u5360\u7528\u91cf\uff0c\u7528\u4e8e\u7f13\u5b58\u6587\u4ef6\u7684\u9875\u6570\u636e\uff1b\u9875\u662f\u903b\u8f91\u4e0a\u7684\u6982\u5ff5\uff0c\u56e0\u6b64page cache \u662f\u4e0e\u6587\u4ef6\u7cfb\u7edf\u540c\u7ea7\u7684 buffers \u8868\u793a\u5f53\u524d\u7684\u5757\u7f13\u5b58\uff08buffer cache\uff09\u5360\u7528\u91cf\uff0c\u7528\u4e8e\u7f13\u5b58\u5757\u8bbe\u5907\u7684\u5757\u6570\u636e\uff1b\u5757\u662f\u7269\u7406\u4e0a\u7684\u6982\u5ff5\uff0c\u56e0\u6b64buffer cache\u662f\u4e0e\u5757\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u540c\u7ea7\u7684\u3002 page cache \u548c buffer cache\u7684\u5171\u540c\u76ee\u7684\u90fd\u662f\u52a0\u901f\u6570\u636eIO\u3002\u5199\u6570\u636e\u65f6\uff0c\u9996\u5148\u5199\u5230\u7f13\u5b58\uff0c\u5c06\u5199\u5165\u7684\u9875\u6807\u8bb0\u4e3a dirty\uff0c\u7136\u540e\u5411\u5916\u90e8\u5b58\u50a8 flush\uff0c\u4e5f\u5c31\u662f\u7f13\u5b58\u5199\u673a\u5236\u4e2d\u7684 write-back\uff08\u53e6\u4e00\u79cd\u662f write-through\uff0cLinux\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u91c7\u7528\uff09\uff1b\u8bfb\u6570\u636e\u65f6\uff0c\u9996\u5148\u8bfb\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u547d\u4e2d\uff0c\u518d\u53bb\u5916\u90e8\u5b58\u50a8\u8bfb\u53d6\uff0c\u5e76\u4e14\u5c06\u8bfb\u53d6\u6765\u7684\u6570\u636e\u9875\u52a0\u5165\u7f13\u5b58\u3002OS \u603b\u662f\u79ef\u6781\u5730 \u5c06\u6240\u6709\u7a7a\u95f2\u5185\u5b58\u90fd\u7528\u505a page cache\u548c buffer cache\uff0c\u5f53\u5185\u5b58\u4e0d\u591f\u7528\u65f6\uff0c\u4e5f\u4f1a\u7528LRU\u7b49\u7b97\u6cd5\u6dd8\u6c70\u7f13\u5b58\u9875\u3002 \u5728Linux 2.4 \u5185\u6838\u4e4b\u524d\uff0cpage cache \u548c buffer cache\u662f\u5b8c\u5168\u5206\u79bb\u7684\u3002\u4f46\u662f\uff0c\u5757\u8bbe\u5907\u5927\u591a\u662f\u78c1\u76d8\uff0c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u53c8\u5927\u591a\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u6765\u7ec4\u7ec7\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5bfc\u81f4\u5f88\u591a\u6570\u636e\u88ab\u7f13\u5b58\u4e86\u4e24\u6b21\uff0c\u6d6a\u8d39\u5185\u5b58\u3002\u6240\u4ee5\uff0c \u57282.4\u7248\u672c\u4e4b\u540e\uff0c\u4e24\u5757\u7f13\u5b58\u8fd1\u4f3c\u878d\u5408\u5728\u4e86\u4e00\u8d77\uff0c\u5982\u679c\u4e00\u4e2a\u6587\u4ef6\u7684\u9875\u52a0\u8f7d\u5230\u4e86 page cache\uff0c\u90a3\u4e48\u540c\u65f6 buffer cache\u53ea\u9700\u8981\u7ef4\u62a4\u5757\u6307\u5411\u9875\u7684\u6307\u9488\u5c31\u53ef\u4ee5\u4e86\u3002 \u53ea\u6709\u90a3\u4e48\u6ca1\u6709\u7528\u6587\u4ef6\u8868\u793a\u7684\u5757\uff0c\u6216\u8005\u7ed5\u8fc7\u4e86OS\u76f4\u63a5\u64cd\u4f5c\u7684\u5757\uff08\u5982dd\u547d\u4ee4\uff09\uff0c\u624d\u4f1a\u771f\u6b63\u653e\u5230 buffer cache\u4e2d\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u73b0\u5728\u63d0\u8d77 page cache\uff0c\u57fa\u672c\u4e0a\u90fd\u540c\u65f6\u6307 page cache \u548c buffer cache \u4e24\u8005\u3002 \u4e0b\u56fe\u8fd1\u4f3c\u5730\u7ed9\u51fa 32\u4f4d Linux\u7cfb\u7edf\u4e2d\u53ef\u80fd\u5730\u4e00\u79cd page cache\u7ed3\u6784\uff1a block size = 1KB page size = 4KB page cache\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u90fd\u662f\u4e00\u68f5 \u57fa\u6570\u6811 \uff08radix tree,\u672c\u8d28\u4e0a\u662f\u591a\u5dee\u641c\u7d22\u6811\uff09\uff0c\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u9875\u3002\u6839\u636e\u6587\u4ef6\u5185\u7684\u504f\u79fb\u91cf\u5c31\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u5230\u6240\u5728\u7684\u9875\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 page cache\u4e0e\u9884\u8bfb OS\u4e3a\u57fa\u4e8epage cache\u7684\u8bfb\u7f13\u5b58\u673a\u5236\u63d0\u4f9b\u9884\u8bfb\u673a\u5236\uff08PAGE_READAHEAD\uff09,eg: \u7528\u6237\u7ebf\u7a0b\u4ec5\u4ec5\u8bf7\u6c42\u8bfb\u53d6\u78c1\u76d8\u4e0a\u6587\u4ef6A\u7684offset\u4e3a0-3KB\u8303\u56f4\u5185\u7684\u6570\u636e\uff0c\u7531\u4e8e\u78c1\u76d8\u7684\u57fa\u672c\u8bfb\u5199\u5355\u4f4d\u4e3a block = 4KB\uff0c\u4e8e\u662fOS\u81f3\u5c11\u4f1a\u8bfb0-4KB\u7684\u5185\u5bb9\uff0c\u8fd9\u6070\u597d\u53ef\u4ee5\u5728\u4e00\u4e2apage\u4e2d\u88c5\u4e0b\u3002 \u4f46\u662fOS\u5904\u4e8e \u5c40\u90e8\u6027\u539f\u7406 \u4f1a\u9009\u62e9\u5c06\u78c1\u76d8\u5757 offset[4KB,8KB)\u3001[8KB,12KB)\u3001[12KB,16KB)\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4e8e\u662f\u989d\u5916\u5728\u5185\u5b58\u4e2d\u7533\u8bf7\u4e863\u4e2apage\u3002\u5982\u4e0b\u5982\u56fe\u6240\u793aOS\u7684\u9884\u8bfb\u673a\u5236\uff1a page cache\u4e0e\u6587\u4ef6\u6301\u4e45\u5316\u7684\u4e00\u81f4\u6027 \u73b0\u4ee3 Linux \u7684page cache\u6b63\u5982\u5176\u540d\uff0c\u662f\u5bf9\u78c1\u76d8\u4e0a\u7684 page \u7684\u5185\u5b58\u7f13\u5b58\uff0c\u540c\u65f6\u53ef\u4ee5\u7528\u4e8e\u8bfb/\u5199\u64cd\u4f5c\u3002 \u4efb\u4f55\u7cfb\u7edf\u5f15\u5165\u7f13\u5b58\uff0c\u5c31\u4f1a\u5f15\u53d1\u4e00\u81f4\u6027\u95ee\u9898 \uff1a\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4e0e\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5982\u6700\u5e38\u89c1\u540e\u7aef\u67b6\u6784\u4e2d\u7684redis\u7f13\u5b58\u4e0emysql\u6570\u636e\u5e93\u5c31\u5b58\u5728\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002 Linux \u63d0\u4f9b\u591a\u79cd\u673a\u5236\u6765\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f46\u65e0\u8bba\u662f\u5355\u673a\u4e0a\u7684\u5185\u5b58\u4e0e\u78c1\u76d8\u4e00\u81f4\u6027\uff0c\u8fd8\u662f\u5206\u5e03\u5f0f\u7ec4\u4ef6\u4e2d\u8282\u70b91\u4e0e\u8282\u70b92\u30013\u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u7406\u89e3\u7684\u5173\u952e\u662f trade-off\uff1a\u541e\u5410\u91cf\u4e0e\u6570\u636e\u4e00\u81f4\u6027\u4fdd\u8bc1\u662f\u4e00\u5bf9\u77db\u76fe\u3002 \u9996\u5148\uff0c\u9700\u8981\u6211\u4eec\u7406\u89e3\u4e00\u4e0b\u6587\u4ef6\u7684\u6570\u636e\uff0c\u6587\u4ef6 = \u5143\u6570\u636e+\u6570\u636e\u3002 \u5143\u6570\u636e=\u6587\u4ef6\u5927\u5c0f+\u521b\u5efa\u65f6\u95f4+\u8bbf\u95ee\u65f6\u95f4+\u5c5e\u4e3b\u5c5e\u7ec4\u7b49\u4fe1\u606f Linux \u91c7\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u5b9e\u73b0\u6587\u4ef6\u4e00\u81f4\u6027\uff1a Write Through(\u5199\u7a7f)\uff1a\u5411\u7528\u6237\u5c42\u63d0\u4f9b\u7279\u5b9a\u63a5\u53e3\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4e3b\u52a8\u8c03\u7528\u63a5\u53e3\u6765\u4fdd\u8bc1\u6587\u4ef6\u4e00\u81f4\u6027\uff1b \u4ee5\u727a\u7272\u7cfb\u7edfIO\u541e\u5410\u91cf\u4e3a\u4ee3\u4ef7\uff0c\u5411\u4e0a\u5c42\u5e94\u7528\u786e\u4fdd\u4e00\u65e6\u5199\u5165\uff0c\u6570\u636e\u5c31\u5df2\u7ecf\u843d\u76d8\uff0c\u4e0d\u4f1a\u4e22\u5931\u3002 Write Back(\u5199\u56de)\uff1a\u7cfb\u7edf\u4e2d\u5b58\u5728\u5b9a\u671f\u4efb\u52a1\uff08\u8868\u73b0\u5f62\u5f0f\u4e3a\u5185\u6838\u7ebf\u7a0b\uff09\uff0c\u5468\u671f\u6027\u5730\u540c\u6b65\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6587\u4ef6\u810f\u6570\u636e\u5757\uff0c\u8fd9\u5c31\u662f\u9ed8\u8ba4\u7684Linux\u4e00\u81f4\u6027\u65b9\u6848\uff1b \u5728\u7cfb\u7edf\u53d1\u751f\u5b95\u673a\u7684\u60c5\u51b5\u4e0b\u65e0\u6cd5\u786e\u4fdd\u6570\u636e\u5df2\u7ecf\u843d\u76d8\uff0c\u56e0\u6b64\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002\u4e0d\u8fc7\uff0c\u5728\u7a0b\u5e8f\u6302\u4e86\uff0c\u5982\u88ab kill -9, OS\u4f1a\u786e\u4fddpage cache \u4e2d\u7684\u6570\u636e\u843d\u76d8\u3002 \u4e24\u79cd\u65b9\u6cd5\u90fd\u4f9d\u8d56\u7cfb\u7edf\u8c03\u7528\uff0c\u4e3b\u8981\u5206\u4e3a\u4e09\u79cd\u7cfb\u7edf\u8c03\u7528\uff0c\u53ef\u4ee5\u5206\u522b\u7531\u7528\u6237\u8fdb\u7a0b\u4e0e\u5185\u6838\u8fdb\u7a0b\u53d1\u8d77\uff1a fsync(int fd)\uff0c\u5c06fd \u4ee3\u8868\u7684 \u6587\u4ef6\u7684 \u810f\u6570\u636e\u548c\u810f\u5143\u6570\u636e\u5168\u90e8\u5237\u65b0\u5230\u78c1\u76d8\u4e2d fdatasync(int fd)\uff0c\u5c06 fd \u4ee3\u8868\u7684\u6587\u4ef6\u7684\u810f\u6570\u636e\u5237\u65b0\u81f3\u78c1\u76d8\uff0c\u540c\u65f6\u5bf9\u5fc5\u8981\u7684\uff08\u6587\u4ef6\u5927\u5c0f\uff0c\u800c\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u7b49\u4e0d\u5c5e\u4e8e\u5fc5\u8981\u4fe1\u606f\uff09\u5143\u6570\u636e\u5237\u65b0\u81f3\u78c1\u76d8\u4e2d\u3002 sync()\uff0c\u5bf9 \u7cfb\u7edf\u4e2d\u6240\u6709\u7684 \u810f\u7684\u6587\u4ef6\u6570\u636e\u3001\u5143\u6570\u636e\u90fd\u5237\u65b0\u81f3\u78c1\u76d8\u4e2d \u63cf\u8ff0\u4e00\u4e0b\u5185\u6838\u7ebf\u7a0b\u7684\u76f8\u5173\u7279\u6027\uff1a \u521b\u5efa\u7684\u9488\u5bf9 \u56de\u5199\u4efb\u52a1 \u7684\u5185\u6838\u7ebf\u7a0b\u6570\u7531\u7cfb\u7edf\u4e2d\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u51b3\u5b9a\uff0c\u4e3a\u6bcf\u4e2a\u5b58\u50a8\u8bbe\u5907\u521b\u5efa\u5355\u72ec\u7684\u5237\u65b0\u7ebf\u7a0b\uff1b \u5173\u4e8e \u591a\u7ebf\u7a0b\u7684\u67b6\u6784 \u95ee\u9898\uff0cLinux\u5185\u6838\u91c7\u53d6\u4e86 Lighthttp \u7684\u505a\u6cd5\u3002\u5373\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e00\u4e2a\u7ba1\u7406\u7ebf\u7a0b\u548c\u591a\u4e2a\u5237\u65b0\u7ebf\u7a0b\uff08\u6bcf\u4e2a\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u5bf9\u5e94\u4e00\u4e2a\u5237\u65b0\u7ebf\u7a0b\uff09\u3002\u7ba1\u7406\u7ebf\u7a0b\u76d1\u63a7\u8bbe\u5907\u4e0a\u7684\u810f\u9875\u9762\u60c5\u51b5\uff0c\u82e5\u8bbe\u5907\u4e00\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u4ea7\u751f\u810f\u9875\u9762\uff0c\u5c31\u9500\u6bc1\u8bbe\u5907\u4e0a\u7684\u5237\u65b0\u7ebf\u7a0b\uff1b\u82e5\u76d1\u6d4b\u5230\u8bbe\u5907\u4e0a\u6709\u810f\u9875\u9762\u9700\u8981\u56de\u5199\u4e14\u5c1a\u672a\u4e3a\u8be5\u8bbe\u5907\u521b\u5efa\u5237\u65b0\u7ebf\u7a0b\uff0c\u90a3\u4e48\u521b\u5efa\u5237\u65b0\u7ebf\u7a0b\u5904\u7406\u810f\u9875\u9762\u56de\u5199\u3002\u800c\u5237\u65b0\u7ebf\u7a0b\u7684\u4efb\u52a1\u8f83\u4e3a\u5355\u8c03\uff0c\u53ea\u8d1f\u8d23\u5c06\u8bbe\u5907\u4e2d\u7684\u810f\u9875\u9762\u56de\u5199\u81f3\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u4e2d\u3002 \u5237\u65b0\u7ebf\u7a0b\u5237\u65b0\u8bbe\u5907\u4e0a\u810f\u9875\u9762\u5927\u81f4\u8bbe\u8ba1\u5982\u4e0b\uff1a \u6bcf\u4e2a\u8bbe\u5907\u4fdd\u5b58\u810f\u6587\u4ef6\u94fe\u8868\uff0c\u4fdd\u5b58\u7684\u662f\u8be5\u8bbe\u5907\u4e0a\u5b58\u50a8\u7684\u810f\u6587\u4ef6\u7684inode\u8282\u70b9\u3002\u6240\u8c13\u7684\u56de\u5199\u6587\u4ef6\u810f\u9875\u9762\u5373\u56de\u5199\u8be5 inode \u94fe\u8868\u4e0a\u7684\u67d0\u4e9b\u6587\u4ef6\u7684\u810f\u9875\u9762\uff1b \u7cfb\u7edf\u4e2d\u5b58\u5728\u591a\u4e2a\u56de\u5199\u65f6\u673a\u3002\u7b2c\u4e00\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e3b\u52a8\u8c03\u7528\u56de\u5199\u63a5\u53e3\uff1b\u7b2c\u4e8c\uff0c\u7ba1\u7406\u7ebf\u7a0b\u5468\u671f\u6027\u5730\u5524\u9192\u8bbe\u5907\u4e0a\u7684\u56de\u5199\u7ebf\u7a0b\u8fdb\u884c\u56de\u5199\uff1b\u7b2c\u4e09\uff0c\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f/\u5185\u6838\u4efb\u52a1\u53d1\u73b0\u5185\u5b58\u4e0d\u8db3\u65f6\u8981\u56de\u6536\u90e8\u5206\u7f13\u5b58\u9875\u9762\u800c\u4e8b\u5148\u8fdb\u884c\u810f\u9875\u9762\u56de\u5199\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u7edf\u4e00\u7684\u6846\u67b6\u6765\u7ba1\u7406\u8fd9\u4e9b\u56de\u5199\u4efb\u52a1\u975e\u5e38\u6709\u5fc5\u8981\u3002 \u4f18\u52bf\uff0c\u597d\u5904\uff0c\u7279\u70b9\uff0c\u72ec\u7279\u3002\u3002\u3002 \u52a0\u5feb\u6570\u636e\u8bbf\u95ee \u51cf\u5c11IO\u6b21\u6570\uff0c\u63d0\u9ad8\u7cfb\u7edf\u78c1\u76d8IO\u541e\u5410\u91cf \u5f97\u76ca\u4e8e page cache\u7684\u7f13\u5b58\u4ee5\u53ca\u9884\u8bfb\u80fd\u529b\uff0c\u800c\u7a0b\u5e8f\u53c8\u5f80\u5f80\u7b26\u5408\u5c40\u90e8\u6027\u539f\u7406\u3002 \u52a3\u52bf\uff0c\u7f3a\u70b9\uff0c\u4e0d\u8db3\u3002\u3002\u3002 \u6700\u76f4\u63a5\u7684\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u5360\u7528 \u989d\u5916 \u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u7269\u7406\u5185\u5b58\u5728\u6bd4\u8f83\u7d27\u5f20\u7684\u65f6\u5019\u53ef\u80fd\u5bfc\u81f4\u9891\u7e41\u7684 swap \u64cd\u4f5c\uff0c\u6700\u7ec8\u5bfc\u81f4\u7cfb\u7edf\u7684\u78c1\u76d8IO\u8d1f\u8f7d\u4e0a\u5347\u3002\uff08\u8fd8\u662f\u90a3\u4e2a\u89c2\u70b9\uff0c\u5de5\u4e1a4.0\u65f6\u4ee3\uff0c\u591a\u7528\u70b9\u800c\u5185\u5b58\u4f1a\u5e26\u6765\u4eba\u4eec\u7684\u7f8e\u597d\u751f\u6d3b\uff09 \u5bf9\u5e94\u7528\u5c42 \u6ca1\u6709\u63d0\u4f9b \u5f88\u597d\u7684\u7ba1\u7406API\uff0c\u51e0\u4e4e\u662f\u900f\u660e\u7ba1\u7406\u3002\u5e94\u7528\u5c42\u5373\u4f7f\u60f3\u4f18\u5316 page cache\u7684\u4f7f\u7528\u7b56\u7565\u4e5f\u5f88\u96be\u8fdb\u884c\u3002\u56e0\u4e3a\u4e00\u4e9b\u5e94\u7528\u9009\u62e9\u5728\u7528\u6237\u7a7a\u95f4\u5b9e\u73b0\u81ea\u5df1\u7684 page \u7ba1\u7406\uff0c\u800c\u4e0d\u4f7f\u7528 page cache\uff0c\u4f8b\u5982 mysql \u7684 innoDB\u5b58\u50a8\u5f15\u64ce\u4ee5 16KB\u7684\u9875\u8fdb\u884c\u7ba1\u7406\u3002\uff08\u4e8b\u5b9e\u662f\u63d0\u4f9b\u4e86\uff0c\u4f46\u67d0\u4eba\u89c9\u5f97\u6ee1\u8db3\u4e0d\u4e86\u4ed6\u7684\u7f8e\u597d\u751f\u6d3b\uff0c\u770b\u6765\u4eba\u4eec\u7684\u7f8e\u597d\u751f\u6d3b\u662f\u65e5\u76ca\u589e\u957f\u7684\uff09 \u67d0\u4e9b\u573a\u666f\u4e0b \u6bd4 Direct IO\u591a\u4e00\u6b21\u78c1\u76d8IO \u96f6\u62f7\u8d1d \u5386\u53f2\u53d8\u8fc1\uff1a \u200b \u6ca1\u6709\u4efb\u4f55\u4f18\u5316\u6280\u672f\u7684\u6570\u636e\u56db\u6b21\u62f7\u8d1d\u4e0e\u56db\u6b21\u4e0a\u4e0b\u6587\u5207\u6362 DMA\u53c2\u4e0e\u4e0b\u7684\u6570\u636e\u56db\u6b21\u62f7\u8d1d DMA \u4e5f\u6709\u5176\u5c40\u9650\u6027\uff0cDMA \u4ec5\u4ec5\u80fd\u7528\u4e8e\u8bbe\u5907\u4e4b\u95f4\u4ea4\u6362\u6570\u636e\u65f6\u8fdb\u884c\u6570\u636e\u62f7\u8d1d\uff0c\u4f46\u662f\u7cfb\u7edf\u5185\u90e8\u7684\u6570\u636e\u62f7\u8d1d\u8fd8\u9700\u8981 CPU \u8fdb\u884c\uff0c\u4f8b\u5982 CPU \u9700\u8981\u8d1f\u8d23\u5185\u6838\u7a7a\u95f4\u6570\u636e\u4e0e\u7528\u6237\u7a7a\u95f4\u6570\u636e\u4e4b\u95f4\u7684\u62f7\u8d1d\uff08\u5185\u5b58\u5185\u90e8\u7684\u62f7\u8d1d\uff09 \u3002 read buffer == page cache socket buffer == socket \u7f13\u51b2\u533a \u4e0d\u540c\u7684\u96f6\u62f7\u8d1d\u6280\u672f\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f DMA \u6280\u672f\u56de\u987e\uff1aDMA \u8d1f\u8d23\u5185\u5b58\u4e0e\u5176\u4ed6\u7ec4\u4ef6\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\uff0cCPU \u4ec5\u9700\u8d1f\u8d23\u7ba1\u7406\uff0c\u800c\u65e0\u9700\u8d1f\u8d23\u5168\u7a0b\u7684\u6570\u636e\u62f7\u8d1d\uff1b \u4f7f\u7528 page cache \u7684 zero copy\uff1a sendfile\uff1a\u4e00\u6b21\u4ee3\u66ff read/write \u7cfb\u7edf\u8c03\u7528\uff0c\u901a\u8fc7\u4f7f\u7528 DMA \u6280\u672f\u4ee5\u53ca\u4f20\u9012\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5b9e\u73b0\u4e86 zero copy mmap\uff1a\u4ec5\u4ee3\u66ff read \u7cfb\u7edf\u8c03\u7528\uff0c\u5c06\u5185\u6838\u7a7a\u95f4\u5730\u5740\u6620\u5c04\u4e3a\u7528\u6237\u7a7a\u95f4\u5730\u5740\uff0cwrite \u64cd\u4f5c\u76f4\u63a5\u4f5c\u7528\u4e8e\u5185\u6838\u7a7a\u95f4\u3002\u901a\u8fc7 DMA \u6280\u672f\u4ee5\u53ca\u5730\u5740\u6620\u5c04\u6280\u672f\uff0c\u7528\u6237\u7a7a\u95f4\u4e0e\u5185\u6838\u7a7a\u95f4\u65e0\u987b\u6570\u636e\u62f7\u8d1d\uff0c\u5b9e\u73b0\u4e86 zero copy \u4e0d\u4f7f\u7528 page cache \u7684 Direct I/O\uff1a\u8bfb\u5199\u64cd\u4f5c\u76f4\u63a5\u5728\u78c1\u76d8\u4e0a\u8fdb\u884c\uff0c\u4e0d\u4f7f\u7528 page cache \u673a\u5236\uff0c\u901a\u5e38\u7ed3\u5408\u7528\u6237\u7a7a\u95f4\u7684\u7528\u6237\u7f13\u5b58\u4f7f\u7528\u3002\u901a\u8fc7 DMA \u6280\u672f\u76f4\u63a5\u4e0e\u78c1\u76d8/\u7f51\u5361\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\uff0c\u5b9e\u73b0\u4e86 zero copy \u96f6\u62f7\u8d1d \u601d\u60f3 \uff08 \u4e0d\u662f\u4e0d\u8fdb\u884c\u62f7\u8d1d\uff0c\u800c\u662f CPU \u4e0d\u518d\u5168\u7a0b\u8d1f\u8d23\u6570\u636e\u62f7\u8d1d\u65f6\u7684\u642c\u8fd0\u5de5\u4f5c \uff09\u7684\u4e00\u4e2a\u5177\u4f53\u5b9e\u73b0\u3002 \u4e00\u79cd\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u7684\u65b9\u6cd5\uff0c\u5b9e\u73b0\u6587\u4ef6\u78c1\u76d8\u5730\u5740\u548c\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e00\u6bb5\u865a\u62df\u5730\u5740\u7684\u4e00\u4e00\u6620\u5c04\u5173\u7cfb\u3002 \u96f6\u62f7\u8d1d\u7684\u7279\u70b9\u662f CPU \u4e0d\u5168\u7a0b\u8d1f\u8d23\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5199\u5165\u5176\u4ed6\u7ec4\u4ef6\uff0cCPU \u4ec5\u4ec5\u8d77\u5230\u7ba1\u7406\u7684\u4f5c\u7528 \u3002 \u5177\u4f53\u5b9e\u73b0\uff1a sendfile \uff08 \u7528\u6237\u4ece\u78c1\u76d8\u8bfb\u53d6\u4e00\u4e9b\u6587\u4ef6\u6570\u636e\u540e \u4e0d\u9700\u8981\u7ecf\u8fc7\u4efb\u4f55\u8ba1\u7b97\u4e0e\u5904\u7406 \u5c31\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u51fa\u53bb \uff09 mmap \uff0c\u5229\u7528 mmap() \u66ff\u6362 read() \uff0c\u914d\u5408 write() \u8c03\u7528\u7684\u6574\u4e2a\u6d41\u7a0b\u5982\u4e0b\uff1a \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 mmap() \uff0c\u4ece\u7528\u6237\u6001\u9677\u5165\u5185\u6838\u6001\uff0c\u5c06\u5185\u6838\u7f13\u51b2\u533a\u6620\u5c04\u5230\u7528\u6237\u7f13\u5b58\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u786c\u76d8\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff08\u53ef\u89c1\u5176\u4f7f\u7528\u4e86 Page Cache \u673a\u5236\uff09\uff1b mmap() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\uff1b \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 write() \uff0c\u5c1d\u8bd5\u628a\u6587\u4ef6\u6570\u636e\u5199\u5230\u5185\u6838\u91cc\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff0c\u518d\u6b21\u9677\u5165\u5185\u6838\u6001\uff1b CPU \u5c06\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u5957\u63a5\u5b57\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7f51\u5361\u5b8c\u6210\u6570\u636e\u4f20\u8f93\uff1b write() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\u3002 splice \u76f4\u63a5 Direct I/O \uff08\u81ea\u7f13\u5b58\u5e94\u7528\u7a0b\u5e8f\uff0c\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u5c31\u662f\u8fd9\u7c7b\u7684\u4e00\u4e2a\u4ee3\u8868\uff09 \u4e0d\u540c\u7684\u96f6\u62f7\u8d1d\u6280\u672f\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u5e94\u7528 \u573a\u666f \u3002 \u628ammap\u5355\u72ec\u62ff\u51fa\u6765\u8bf4 \u7528\u6237\u7a7a\u95f4mmap--->\u5185\u6838\u7a7a\u95f4mmap--->\u7f3a\u9875\u5f02\u5e38 \u5bf9\u6bd4\uff0c \u4ece\u5185\u6838\u6587\u4ef6\u7cfb\u7edf\u770b\u6587\u4ef6\u8bfb\u5199\u8fc7\u7a0b \u6848\u4f8b kafaka \u4f7f\u7528 mmap \u6765\u5bf9\u63a5\u6536\u5230\u7684\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u4f7f\u7528 sendfile \u4ece\u6301\u4e45\u5316\u4ecb\u8d28\u4e2d\u8bfb\u53d6\u6570\u636e\u7136\u540e\u5bf9\u5916\u53d1\u9001\u662f\u4e00\u5bf9\u5e38\u7528\u7684\u7ec4\u5408\u3002\u4f46\u662f\u6ce8\u610f\uff0c\u4f60\u65e0\u6cd5\u5229\u7528 sendfile \u6765\u6301\u4e45\u5316\u6570\u636e\uff0c\u5229\u7528 mmap \u6765\u5b9e\u73b0 CPU \u5168\u7a0b\u4e0d\u53c2\u4e0e\u6570\u636e\u642c\u8fd0\u7684\u6570\u636e\u62f7\u8d1d\u3002 mysql \u7684\u96f6\u62f7\u8d1d\u6280\u672f \u603b\u800c\u8a00\u4e4b\uff0c\u5e38\u89c4\u6587\u4ef6\u64cd\u4f5c\u9700\u8981\u4ece\u78c1\u76d8\u5230\u9875\u7f13\u5b58\u518d\u5230\u7528\u6237\u4e3b\u5b58\u7684\u4e24\u6b21\u6570\u636e\u62f7\u8d1d\u3002\u800cmmap\u64cd\u63a7\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u4ece \u78c1\u76d8\u5230\u7528\u6237\u4e3b\u5b58 \u7684\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\u8fc7\u7a0b\u3002 \u8bf4\u767d\u4e86\uff0cmmap\u7684\u5173\u952e\u70b9\u662f\u5b9e\u73b0\u4e86\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u7684\u6570\u636e\u76f4\u63a5\u4ea4\u4e92\u800c\u7701\u53bb\u4e86\u4e0d\u540c\u7a7a\u95f4\u6570\u636e\u4e0d\u901a\u7684\u7e41\u7410\u8fc7\u7a0b \u3002 mmap \u4e00\u79cd\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u7684\u65b9\u6cd5\u3002\u5c06\u4e00\u4e2a\u6587\u4ef6\u6216\u8005\u5176\u5b83\u5bf9\u8c61\u6620\u5c04\u5230\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5b9e\u73b0\u6587\u4ef6\u78c1\u76d8\u5730\u5740\u548c\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e00\u6bb5\u865a\u62df\u5730\u5740\u7684\u4e00\u4e00\u5bf9\u5e94\u5173\u7cfb\u3002\u5b9e\u73b0\u8fd9\u6837\u7684\u6620\u5c04\u5173\u7cfb\u540e\uff0c\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u91c7\u7528\u6307\u9488\u7684\u65b9\u5f0f\u8bfb\u5199\u8fd9\u4e00\u6bb5\u5185\u5b58\uff0c\u800cOS\u4f1a\u81ea\u52a8\u56de\u5199\u810f\u9875\u9762\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u78c1\u76d8\u4e0a\uff0c\u5373\u5b8c\u6210\u4e86\u5bf9\u6587\u4ef6\u7684\u64cd\u4f5c\u800c\u4e0d\u5fc5\u518d\u8c03\u7528read\u3001write\u7b49\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002\u76f8\u53cd\uff0c\u5185\u6838\u7a7a\u95f4\u5bf9\u8fd9\u6bb5\u533a\u57df\u7684\u4fee\u6539\u4e5f\u76f4\u63a5\u53cd\u6620\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u4ece\u800c\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u8fdb\u7a0b\u95f4\u7684\u6587\u4ef6\u5171\u4eab\u3002 \u7279\u70b9 mmap \u5411\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684\u5185\u5b58\u8bbf\u95ee\u63a5\u53e3\u662f\u5185\u5b58\u5730\u5740\u8fde\u7eed\u7684\uff0c\u4f46\u662f\u5bf9\u5e94\u7684\u78c1\u76d8\u6587\u4ef6\u7684 block \u53ef\u4ee5\u4e0d\u662f\u5730\u5740\u8fde\u7eed\u7684 mmap \u63d0\u4f9b\u7684\u5185\u5b58\u7a7a\u95f4\u662f\u865a\u62df\u7a7a\u95f4\uff0c\u800c\u4e0d\u662f\u7269\u7406\u7a7a\u95f4\uff0c\u56e0\u6b64\u5b8c\u5168\u53ef\u4ee5\u5206\u914d\u8fdc\u8fdc\u5927\u4e8e\u7269\u7406\u5185\u5b58\u5927\u5c0f\u7684\u865a\u62df\u7a7a\u95f4\uff0c\u598216G\u5185\u5b58\u4e3b\u673a\u53ef\u4ee5\u5206\u914d1000G\u7684mmap\u5185\u5b58\u7a7a\u95f4 mmap \u8d1f\u8d23\u6620\u5c04\u6587\u4ef6\u903b\u8f91\u4e0a\u4e00\u6bb5\u8fde\u7eed\u7684\u6570\u636e\uff08\u7269\u7406\u4e0a\u53ef\u4ee5\u4e0d\u8fde\u7eed\u5b58\u50a8\uff09\u6620\u5c04\u4e3a\u8fde\u7eed\u5185\u5b58\uff0c\u800c\u8fd9\u91cc\u7684\u6587\u4ef6\u53ef\u4ee5\u662f\u78c1\u76d8\u6587\u4ef6\u3001\u9a71\u52a8\u5047\u9020\u51fa\u6765\u7684\u6587\u4ef6\u4ee5\u53ca\u8bbe\u5907 mmap \u7531OS\u8d1f\u8d23\u7ba1\u7406\uff0c\u5bf9\u540c\u4e00\u4e2a\u6587\u4ef6\u5730\u5740\u7684\u6620\u5c04\u5c06\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\uff0cOS\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168\u53ca\u7ebf\u7a0b\u53ef\u89c1\u6027 mmap \u7684\u8bbe\u8ba1\u5f88\u6709\u542f\u53d1\u6027\u3002\u57fa\u4e8e\u78c1\u76d8\u7684\u8bfb\u5199\u5355\u4f4d\u662f block(4KB)\uff0c\u800c\u57fa\u4e8e\u5185\u5b58\u7684\u8bfb\u5199\u5355\u5143\u662f \u5730\u5740 \u3002\u6362\u8a00\u4e4b\uff0cCPU\u8fdb\u884c\u4e00\u6b21\u78c1\u76d8\u8bfb\u5199\u64cd\u4f5c\u6d89\u53ca\u7684\u6570\u636e\u91cf\u81f3\u5c11\u662f4KB\u3002\u4f46\u662f\uff0c\u8fdb\u884c\u4e00\u6b21\u5185\u5b58\u64cd\u4f5c\u6d89\u53ca\u7684\u6570\u636e\u91cf\u662f\u57fa\u4e8e\u5730\u5740\u7684\uff0c\u4e5f\u5c31\u662f\u901a\u5e38\u7684 64bit \u3002 \u6a21\u578b \u5229\u7528 DMA \u6280\u672f\u6765\u53d6\u4ee3 CPU \u6765\u5728\u5185\u5b58\u4e0e\u5176\u4ed6\u7ec4\u4ef6\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u4f8b\u5982\u4ece\u78c1\u76d8\u5230\u5185\u5b58\uff0c\u4ece\u5185\u5b58\u5230\u7f51\u5361\uff1b \u7528\u6237\u7a7a\u95f4\u7684 mmap file \u4f7f\u7528\u865a\u62df\u5185\u5b58\uff0c\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5360\u636e\u7269\u7406\u5185\u5b58\uff0c\u53ea\u6709\u5728\u5185\u6838\u7a7a\u95f4\u7684 kernel buffer cache \u624d\u5360\u636e\u5b9e\u9645\u7684\u7269\u7406\u5185\u5b58\uff1b mmap() \u51fd\u6570\u9700\u8981\u914d\u5408 write() \u7cfb\u7edf\u8c03\u52a8\u8fdb\u884c\u914d\u5408\u64cd\u4f5c\uff0c\u8fd9\u4e0e sendfile() \u51fd\u6570\u6709\u6240\u4e0d\u540c\uff0c\u540e\u8005\u4e00\u6b21\u6027\u4ee3\u66ff\u4e86 read() \u4ee5\u53ca write() \uff1b\u56e0\u6b64 mmap \u4e5f\u81f3\u5c11 \u9700\u8981 4 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff1b mmap \u4ec5\u4ec5\u80fd\u591f\u907f\u514d\u5185\u6838\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u7684\u5168\u7a0b CPU \u8d1f\u8d23\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u4f46\u662f \u5185\u6838\u7a7a\u95f4\u5185\u90e8 \u8fd8\u662f\u9700\u8981\u5168\u7a0b CPU \u8d1f\u8d23\u7684\u6570\u636e\u62f7\u8d1d \u6d41\u7a0b \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 mmap() \uff0c\u4ece\u7528\u6237\u6001\u9677\u5165\u5185\u6838\u6001\uff0c\u5c06\u5185\u6838\u7f13\u51b2\u533a\u6620\u5c04\u5230\u7528\u6237\u7f13\u5b58\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u786c\u76d8\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff08 \u53ef\u89c1\u5176\u4f7f\u7528\u4e86 Page Cache \u673a\u5236 \uff09\uff1b mmap() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\uff1b \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 write() \uff0c\u5c1d\u8bd5\u628a\u6587\u4ef6\u6570\u636e\u5199\u5230\u5185\u6838\u91cc\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff0c\u518d\u6b21\u9677\u5165\u5185\u6838\u6001\uff1b CPU \u5c06\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u5957\u63a5\u5b57\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7f51\u5361\u5b8c\u6210\u6570\u636e\u4f20\u8f93\uff1b write() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\u3002 \u4f18\u52bf \u7b80\u5316\u7528\u6237\u8fdb\u7a0b\u7f16\u7a0b \u57fa\u4e8e\u7f3a\u9875\u5f02\u5e38\u7684\u61d2\u52a0\u8f7d \u6570\u636e\u4e00\u81f4\u6027\u7531OS\u786e\u4fdd \u8bfb\u5199\u6548\u7387\u63d0\u9ad8\uff1a\u907f\u514d\u5185\u6838\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u7684\u6570\u636e\u62f7\u8d1d \u907f\u514d\u53ea\u8bfb\u64cd\u4f5c\u65f6\u7684swap\u64cd\u4f5c \u8282\u7ea6\u5185\u5b58 \u7528\u6237\u7a7a\u95f4\u4e0e\u5185\u6838\u7a7a\u95f4\u5b9e\u9645\u4e0a\u516c\u7528\u540c\u4e00\u4efd\u6570\u636e \u9002\u7528\u573a\u666f\uff0c\u975e\u5e38\u53d7\u9650 \u591a\u4e2a\u7ebf\u7a0b\u4ee5 \u53ea\u8bfb\u7684\u65b9\u5f0f \u540c\u65f6\u8bbf\u95ee\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u662f\u56e0\u4e3a mmap \u673a\u5236\u4e0b\u591a\u7ebf\u7a0b\u5171\u4eab\u4e86\u540c\u4e00\u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u6b64\u8282\u7ea6\u4e86\u5185\u5b58\uff1b mmap \u975e\u5e38\u9002\u5408\u7528\u4e8e \u8fdb\u7a0b\u95f4\u901a\u4fe1 \uff0c\u8fd9\u662f\u56e0\u4e3a\u5bf9\u540c\u4e00\u6587\u4ef6\u5bf9\u5e94\u7684 mmap \u5206\u914d\u7684\u7269\u7406\u5185\u5b58\u5929\u7136\u591a\u7ebf\u7a0b\u5171\u4eab\uff0c\u5e76\u53ef\u4ee5\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u540c\u6b65\u539f\u8bed\uff1b mmap \u867d\u7136\u6bd4 sendfile \u7b49\u673a\u5236\u591a\u4e86\u4e00\u6b21 CPU \u5168\u7a0b\u53c2\u4e0e\u7684\u5185\u5b58\u62f7\u8d1d\uff0c\u4f46\u662f\u7528\u6237\u7a7a\u95f4\u4e0e\u5185\u6838\u7a7a\u95f4\u5e76\u4e0d\u9700\u8981\u6570\u636e\u62f7\u8d1d\uff0c\u56e0\u6b64\u5728\u6b63\u786e\u4f7f\u7528\u60c5\u51b5\u4e0b\u5e76\u4e0d\u6bd4 sendfile \u6548\u7387\u5dee\uff1b \u4e0d\u9002\u5408\u7684\u573a\u666f \u7531\u4e8e mmap \u4f7f\u7528\u65f6 \u5fc5\u987b\u5b9e\u73b0\u6307\u5b9a\u597d \u5185\u5b58\u6620\u5c04\u7684\u5927\u5c0f\uff0c\u56e0\u6b64 mmap \u5e76\u4e0d\u9002\u5408\u53d8\u957f\u6587\u4ef6\uff1b \u5982\u679c \u66f4\u65b0\u9891\u7e41 \uff0cmmap \u907f\u514d\u4e24\u6001\u62f7\u8d1d\u7684\u4f18\u52bf\u5c31\u88ab\u644a\u8fd8\uff0c\u6700\u7ec8\u8fd8\u662f\u843d\u5728\u4e86\u5927\u91cf\u7684\u810f\u9875\u56de\u5199\u53ca\u7531\u6b64\u5f15\u53d1\u7684\u968f\u673a I/O \u4e0a\uff0c\u6240\u4ee5\u5728\u968f\u673a\u5199\u5f88\u591a\u7684\u60c5\u51b5\u4e0b\uff0cmmap \u65b9\u5f0f\u5728\u6548\u7387\u4e0a\u4e0d\u4e00\u5b9a\u4f1a\u6bd4\u5e26\u7f13\u51b2\u533a\u7684\u4e00\u822c\u5199\u5feb\uff1b \u8bfb/\u5199 \u5c0f\u6587\u4ef6 \uff08\u4f8b\u5982 16K \u4ee5\u4e0b\u7684\u6587\u4ef6\uff09\uff0cmmap \u4e0e\u901a\u8fc7 read \u7cfb\u7edf\u8c03\u7528\u76f8\u6bd4\u6709\u7740\u66f4\u9ad8\u7684\u5f00\u9500\u4e0e\u5ef6\u8fdf\uff1b\u540c\u65f6 mmap \u7684 \u5237\u76d8\u7531\u7cfb\u7edf\u5168\u6743\u63a7\u5236 \uff0c\u4f46\u662f\u5728\u5c0f\u6570\u636e\u91cf\u7684\u60c5\u51b5\u4e0b\u7531\u5e94\u7528\u672c\u8eab\u624b\u52a8\u63a7\u5236\u66f4\u597d\uff1b mmap \u53d7\u9650\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u5927\u5c0f\uff1a\u4f8b\u5982\u5728 32-bits \u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u865a\u62df\u5185\u5b58\u603b\u5927\u5c0f\u4e5f\u5c31 2GB\uff0c\u4f46\u7531\u4e8e mmap \u5fc5\u987b\u8981\u5728\u5185\u5b58\u4e2d\u627e\u5230\u4e00\u5757\u8fde\u7eed\u7684\u5730\u5740\u5757\uff0c\u6b64\u65f6\u4f60\u5c31\u65e0\u6cd5\u5bf9 4GB \u5927\u5c0f\u7684\u6587\u4ef6\u5b8c\u5168\u8fdb\u884c mmap\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4f60\u5fc5\u987b\u5206\u591a\u5757\u5206\u522b\u8fdb\u884c mmap\uff0c\u4f46\u662f\u6b64\u65f6\u5730\u5740\u5185\u5b58\u5730\u5740\u5df2\u7ecf\u4e0d\u518d\u8fde\u7eed\uff0c\u4f7f\u7528 mmap \u7684\u610f\u4e49\u5927\u6253\u6298\u6263\uff0c\u800c\u4e14\u5f15\u5165\u4e86\u989d\u5916\u7684\u590d\u6742\u6027\uff1b \u53c2\u8003 \u8ba4\u771f\u5206\u6790mmap: \u662f\u4ec0\u4e48 \u4e3a\u4ec0\u4e48 \u600e\u4e48\u7528 Linux\u4e2d mmap() \u51fd\u6570\u7684\u5185\u5b58\u6620\u5c04\u95ee\u9898\u7406\u89e3\uff1f When should I use mmap for file access Linux IO\u539f\u7406\u548cZero-copy\u6280\u672f\u5168\u9762\u63ed\u79d8 Go \u7684IO \u5b83\u7684 io \u548c bufio \u662f\u8fdb\u7a0b\u4e2d\uff08\u4e5f\u53ef\u4ee5\u8bf4\u662f \u7528\u6237\u6001 \uff09\u7684\u7f13\u51b2\u3002 Go \u548c IO\u7684\u4e0d\u89e3\u4e4b\u7f18 Go \u662f\u4e00\u79cd\u9ad8\u6027\u80fd\u7684\u7f16\u8bd1\u578b\u8bed\u8a00\uff0c\u5929\u7136\u652f\u6301\u9ad8\u5e76\u53d1\uff0c\u7528\u6237\u7ea7\u522b\u5c01\u88c5\u534f\u7a0b\uff0c\u53f7\u79f0\u652f\u6301\u767e\u4e07\u7684\u534f\u7a0b\u5e76\u53d1\uff0c\u8fd9\u4e2a\u91cf\u7ea7\u4e0d\u662f\u7ebf\u7a0b\u53ef\u6bd4\u7684\u3002 \u90a3Go\u652f\u6301\u5982\u6b64\u9ad8\u5e76\u53d1\u7684\u79d8\u8bc0\u5728\u4e8e\uff1f \u6267\u884c\u4f53\u8c03\u5ea6\u5f97\u5f53 \u3002CPU\u4e0d\u505c\u7684\u5728\u4e0d\u540c\u6267\u884c\u4f53\uff08goroutine\uff09\u4e4b\u95f4\u53cd\u590d\u6a2a\u8df3\u3002CPU\u4e00\u76f4\u5728\u88c5\u586b\u548c\u8fd0\u884c\u4e0d\u540c\u6267\u884c\u4f53\u7684\u6307\u4ee4\uff0cG1 \u4e0d\u884c\u5c31\u641eG2\uff0c\u4e00\u523b\u90fd\u4e0d\u80fd\u505c\uff0c\u8fd9\u6837\u624d\u80fd\u4f7f\u5f97\u5927\u91cf\u7684\u6267\u884c\u4f53\u9f50\u5934\u5e76\u8fdb\uff0c\u7cfb\u7edf\u624d\u80fd\u5b8c\u6210\u5982\u6b64\u9ad8\u5e76\u53d1\u7684\u541e\u5410\u3002 \u90a3Go\u9002\u5408CPU\u5bc6\u96c6\u578b\u7684\u7a0b\u5e8f\uff0c\u8fd8\u662fIO\u5bc6\u96c6\u578b\u7684\u7a0b\u5e8f\u5462\uff1f IO\u5bc6\u96c6\u578b\u3002 \u9996\u5148\uff0c\u53cd\u63a8\u903b\u8f91\uff0cCPU\u5bc6\u96c6\u578b\u5c31\u610f\u5473\u7740\u6bcf\u4e2a\u6267\u884c\u4f53\u90fd\u662f\u6025\u9700CPU\u7684\uff0cG1\u90fd\u5403\u4e0d\u9971\uff0c\u5207\u5230G2\u53bb\u5e72\u561b\uff0c\u6240\u4ee5CPU\u5bc6\u96c6\u578b\u7684\u7a0b\u5e8f\u6700\u597d\u7684\u60c5\u51b5\u5c31\u662f\u4e0d\u8c03\u5ea6\uff0c\u7ed1\u6838\u90fd\u6765\u4e0d\u53ca\u5462\u3002\u60f3\u8981\u63d0\u9ad8\u8fd9\u79cd\u7a0b\u5e8f\u7684\u6027\u80fd\uff0c\u5c31\u662f\u52a0\u94b1\uff0c\u4e70\u6838\u3002 IO\u8bbe\u5907\u548cCPU\u662f\u4e0d\u540c\u7684\u72ec\u7acb\u8bbe\u5907\u3002\u8fd9\u4e24\u8005\u4e4b\u95f4\u7684\u5904\u7406\u53ef\u4ee5\u662f\u5e76\u884c\u8fd0\u884c\u7684\u3002Go\u7a0b\u5e8f\u7684\u534f\u7a0b\u8c03\u5ea6\u53ef\u4ee5\u5f88\u597d\u7684\u5229\u7528\u8fd9\u4e2a\u5173\u7cfb\u3002\u8ba9CPU\u6267\u884c\u7a0b\u5e8f\u6307\u4ee4\uff0c\u53ea\u8d1f\u8d23\u53d1\u9001IO\uff0c\u4e00\u65e6IO\u88ab\u8bbe\u5907\u63a5\u6536\uff0cCPU\u4e0d\u7b49\u5f85\u5b8c\u6210\uff0c\u5c31\u53ef\u4ee5\u5904\u7406\u5176\u4ed6\u7684\u6307\u4ee4\uff0cIO\u7684\u5b8c\u6210\u4ee5\u5f02\u6b65\u4e8b\u4ef6\u7684\u5f62\u5f0f\u89e6\u53d1\u3002\u8fd9\u6837\uff0cIO\u8bbe\u5907\u7684\u5904\u7406\u8fc7\u7a0b\u548cCPU\u7684\u6267\u884c\u5c31\u5e76\u884c\u8d77\u6765\u4e86\u3002 \u4efb\u4f55IO\u90fd\u9002\u914dGo\u4e48\uff1f Go \u8bed\u8a00\u7ea7\u522b\u628a \u7f51\u7edcIO\u505a\u4e86\u5f02\u6b65\u5316 \uff0c\u4f46\u662f\u6587\u4ef6IO\u8fd8\u662f\u540c\u6b65\u7684\u8c03\u7528 \u7f51\u7edcfd\u53ef\u4ee5\u7528epoll\u6c60\u6765\u7ba1\u7406\u4e8b\u4ef6\uff0c\u5b9e\u73b0\u5f02\u6b65IO \u6587\u4ef6fd\u4e0d\u80fd\u7528epoll\u6c60\u6765\u7ba1\u7406\u4e8b\u4ef6\uff0c\u53ea\u80fd\u540c\u6b65IO \u6587\u4ef6\u60f3\u8981\u5b9e\u73b0\u5f02\u6b65IO\uff0c\u5f53\u524dLinux\u4e0b\u6709\u79cd\u65b9\u5f0f\uff1a AIO: \u4f46Go\u6ca1\u6709\u5c01\u88c5\u5b9e\u73b0 io_uring: \u5185\u6838\u7248\u672c\u8981\u6c42\u9ad8 Go\u7684IO\u957f\u4ec0\u4e48\u6837\u5b50 IO\u63a5\u53e3\u63cf\u8ff0 io/io.go \u4e0d\u6d89\u53ca\u5177\u4f53\u7684IO\u5b9e\u73b0\uff0c\u53ea\u6709 \u8bed\u4e49\u63a5\u53e3 ```go type Reader interface { Read(p []byte) (n int, err error) } type Writer interface { Write(p []byte) (n int, err error) } ``` \u6309\u7167\u63a5\u53e3\u7684\u5b9a\u4e49\u7ef4\u5ea6\uff0c\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a3\u5927\u7c7b\uff1a \u57fa\u7840\u7c7b\u578b Reader\u3001Writer\u3001Closer\u3002\u3002\u3002\u7b49\uff0c\u63cf\u8ff0\u4e86\u6700\u539f\u59cb\u7684Go\u7684IO\u7684\u6837\u5b50\u3002\u5982\u679c\u4f60\u5199\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u8981\u5b9e\u73b0\u8fd9\u4e9b\u63a5\u53e3\uff0c\u5343\u4e07\u8981\u628a\u6807\u51c6\u5e93\u91cc\u7684\u6ce8\u91ca\u8bfb\u4e09\u904d\u3002 \u7ec4\u5408\u7c7b\u578b \u5f80\u5f80\u628a\u6700\u57fa\u672c\u7684\u63a5\u53e3\u7ec4\u5408\u8d77\u6765\uff0c\u4f7f\u7528Go\u7684embeding\u8bed\u6cd5\u7cd6\uff0c\u6bd4\u5982\uff1aReaderCloser\u3001WriteCloser\u7b49 \u8fdb\u9636\u7c7b\u578b \u57fa\u4e8e\u57fa\u7840\u63a5\u53e3\uff0c\u52a0\u4e0a\u4e00\u4e9b\u6709\u8da3\u7684\u5b9e\u73b0\u3002\u6bd4\u5982\uff1aTeeReader\u3001LimitReader\u3001MultiReader IO \u901a\u7528\u51fd\u6570 io\u5e93\u8fd8\u6709\u4e00\u4e9b\u57fa\u4e8e\u4ee5\u4e0a\u63a5\u53e3\u7684\u51fd\u6570\uff0c Copy CopyN CopyBuffer io/ioutil \u987e\u540d\u601d\u4e49\uff0c\u8fd9\u662f\u4e00\u4e2a\u5de5\u5177\u7c7b\u578b\u7684\u5e93\uff0cutil\u561b \u5565\u90fd\u8981\u6709\uff0c\u76f8\u5f53\u4e8e\u5e73\u65f6\u7684\u5feb\u6377\u952e\u3002 \u8fd9\u5c31\u662f\u4e2a\u5de5\u5177\u5e93\uff0c\u5e94\u4ed8\u4e00\u4e9b\u7b80\u5355\u7684\u573a\u666f\uff1a ReadFile\u3001WriteFile\u3001ReadDir... IO \u7684\u59ff\u52bf\u591a\u79cd\u591a\u6837 \u54c8\u54c8\uff0c\u8fd9\u4f4d\u535a\u4e3b\u7684\u7406\u89e3\u5f88\u7279\u522b\uff0cGo \u6807\u51c6io\u5e93\u5b9a\u4e49\u4e86\u57fa\u7840\u7684\u8bed\u4e49\u63a5\u53e3\uff0c\u90a3\u5177\u4f53\u5b9e\u73b0\u5462\uff1f \u5b57\u8282\u6570\u7ec4\u53ef\u4ee5\u662f Reader / Writer \uff1f \u5185\u5b58\u7ed3\u6784\u4f53\u53ef\u4ee5\u662f Reader \u5417\uff1f \u6587\u4ef6\u53ef\u4ee5\u662f Reader / Writer \u5417\uff1f \u5b57\u7b26\u4e32\u53ef\u4ee5\u662f Reader \uff1f IO \u80fd\u805a\u5408\u6765\u63d0\u9ad8\u6548\u7387\u5417\uff1f \u90fd\u53ef\u4ee5 \uff01Go\u5e2e\u6211\u4eec\u505a\u597d\u4e86\u4e00\u5207\uff01 io\u5e93\u7684\u62d3\u6251 IO\u884c\u4e3a\u90fd\u662f\u4ee5io\u5e93\u4e3a\u4e2d\u5fc3\u53d1\u6563\u7684\u3002 io \u548c \u5b57\u8282\u7684\u6545\u4e8b\uff1a bytes \u5e93 \u4e00\u53e5\u8bdd\uff0c\u5185\u5b58\u5757\u53ef\u4ee5\u4f5c\u4e3a\u8bfb\u5199\u7684\u6570\u636e\u6d41\u3002 bytes.Reader \u53ef\u4ee5\u628a[]byte\u8f6c\u6362\u6210Reader bytes.Buffer\u53ef\u4ee5\u628a[]byte\u8f6c\u6362\u6210Reader\u3001Writer go buffer := make([]byte, 1024) readerFromBytes := bytes.NewReader(buffer) n, err := io.Copy(ioutil.Discard, readerFromBytes) // n == 1024, err == nil fmt.Printf(\"n=%v,err=%v\\n\",n, err) io\u548c\u5b57\u7b26\u4e32\u7684\u6545\u4e8b\uff1astrings\u5e93 strings.Reader\u80fd\u591f\u628a\u5b57\u7b26\u4e32\u8f6c\u6362\u6210Reader, \u8fd9\u4e2a\u4e5f\u7279\u522b\u6709\u610f\u601d\uff0c\u76f4\u63a5\u80fd\u628a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u8bfb\u6e90\u3002 go data := \"hello world\" readerFromBytes := strings.NewReader(data) n, err := io.Copy(ioutil.Discard, readerFromBytes) fmt.Printf(\"n=%v,err=%v\\n\",n, err) io\u548c\u7f51\u7edc\u7684\u6545\u4e8b\uff1anet\u5e93 \u7f51\u7edc\u53ef\u4ee5\u4f5c\u4e3a\u8bfb\u5199\u6e90\uff0c\u62bd\u8c61\u6210Reader\u3001Writer\u7684\u5f62\u5f0f\u3002 \u670d\u52a1\u7aef\uff1a ```go func handleConn(conn net.Conn) { defer conn.Close() buf := make([]byte, 4096) conn.Read(buf) conn.Write([]byte(\"pong: \")) conn.Write(buf) } func main() { server, err := net.Listen(\"tcp\", \":9999\") if err != nil { log.Fatalf(\"err:%v\", err) } for { c, err := server.Accept() if err != nil { log.Fatalf(\"err:%v\", err) } go handleConn(c) } } ``` \u8bf4\u660e\uff1a net.Listen \u521b\u5efa\u4e00\u4e2a\u76d1\u542c\u5957\u63a5\u5b57\uff0c\u5728Go\u91cc\u9762\u5c01\u88c5\u6210\u4e86 net.Listener \u7c7b\u578b Accept \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a net.Conn\uff0c\u4ee3\u8868\u4e00\u6761\u7f51\u7edc\u8fde\u63a5\uff0cnet.Conn \u5373\u662fReader\uff0c\u53c8\u662fWriter\uff0c\u5230\u4e86\u4e4b\u540e\u5404\u81ea\u5904\u7406\u5373\u53ef \u5ba2\u6237\u7aef\uff1a go func main() { conn, err := net.Dial(\"tcp\", \":9999\") if err != nil { panic(err) } conn.Write([]byte(\"hello world\\n\")) io.Copy(os.Stdout, conn) } \u8bf4\u660e\uff1a net.Dail \u4f20\u5165\u670d\u52a1\u5668\u7aef\u5730\u5740\u548c\u7f51\u7edc\u534f\u8bae\u7c7b\u578b\uff0c\u5373\u53ef\u8fd4\u56de\u4e00\u6761\u548c\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u8fd4\u56de\u7684\u7ed3\u6784\u4e3a net.Conn net.Conn\u65e2\u53ef\u4f5c\u4e3a\u8bfb\u7aef\uff0c\u4e5f\u53ef\u4e3a\u5199\u7aef \u4ee5\u4e0a\u65e0\u8bba\u662fnet.Listener\uff0c\u8fd8\u662fnet.Conn \u90fd\u662f\u57fa\u4e8e\u7cfb\u7edf\u8c03\u7528 socket \u4e4b\u4e0a\u7684\u4e00\u5c42\u5c01\u88c5\u3002\u5e95\u5c42\u4f7f\u7528\u7684\u662f\u7c7b\u4f3c\u7684\u7cfb\u7edf\u8c03\u7528\uff1a syscall.Socket syscall.Connect syscall.Listen syscall.GetsocketInt Go \u9488\u5bf9\u7f51\u7edcfd\u90fd\u4f1a\u505a\u54ea\u4e9b\u5c01\u88c5\u5462\uff1f \u521b\u5efa\u8fd8\u662f\u7528 socket \u8c03\u7528\u521b\u5efa\u7684 fd\uff0c\u521b\u5efa\u51fa\u6765\u5c31\u4f1a\u7acb\u9a6c\u8bbe\u7f6e\u4e3a nonblock \u6a21\u5f0f\uff0cGo\u7684\u7f51\u7edcfd\u5929\u7136\u8981\u4f7f\u7528IO\u591a\u8def\u590d\u7528\u7684\u65b9\u5f0f\u6765\u8d70IO \u628a socket fd \u4e22\u5230 epoll \u6c60\u91cc\uff08\u901a\u8fc7poll.runtime_pollOpen \u628a socket \u5957\u63a5\u5b57\u52a0\u5230epoll\u6c60\u91cc\uff0c\u5e95\u5c42\u8c03\u7528\u7684\u8fd8\u662fepollctl\uff09\uff0c\u76d1\u542c\u4e8b\u4ef6 \u5c01\u88c5\u597d\u8bfb\u5199\u4e8b\u4ef6\u5230\u6765\u7684\u51fd\u6570\u56de\u8c03 io\u548c\u6587\u4ef6\u7684\u6545\u4e8b\uff1a os\u5e93 \u6587\u4ef6IO\uff0c\u8fd9\u4e2a\u662f\u6211\u4eec\u6700\u5e38\u89c1\u7684IO\uff0c\u6587\u4ef6\u53ef\u4ee5\u4f5c\u4e3a\u8bfb\u7aef\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5199\u7aef\u3002 // \u5982\u4e0b\uff0c\u628a test.data \u7684\u6570\u636e\u8bfb\u51fa\u6765\u4e22\u5230\u5783\u573e\u6876 fd, err := os.OpenFile(\"test.data\", os.O_RDWR, 0) if err != nil { panic(err) } io.Copy(ioutil.Discard, fd) \u8fd9\u91cc\u8fd4\u56de\u4e86\u4e00\u4e2aFile\u7c7b\u578b\uff0c\u4e0d\u96be\u60f3\u8c61\u8fd9\u4e2a\u662f\u57fa\u4e8e\u6587\u4ef6fd\u7684\u4e00\u5c42\u5c01\u88c5\u3002\u8fd9\u91cc\u9762\u505a\u4e86\u4ec0\u4e48\u5462\uff1f \u8c03\u7528\u7cfb\u7edf\u8c03\u7528 syscall.Open \u62ff\u5230\u6587\u4ef6\u7684fd\uff0c\u987a\u4fbf\u8bbe\u7f6e\u4e86\u5783\u573e\u56de\u6536\u65f6\u5019\u7684\u6790\u6784\u51fd\u6570 stdin\u3001stdout\u3001stderr Go\u628a\u8fd9\u4e09\u4e2a\u4e5f\u90fd\u62bd\u8c61\u6210\u4e86\u8bfb\u5199\u6e90\uff0c\u8fd9\u4e09\u4e2a\u7c7b\u578b\u7684\u53d8\u91cf\u5176\u5b9e\u5c31\u662fFile\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u5b9a\u4e49\u5728\u6e90\u7801 src/os/file.go\u4e2d ```go var ( Stdin = NewFile(uintptr(syscall.Stdin), \"/dev/stdin\") Stdout = NewFile(uintptr(syscall.Stdout), \"/dev/stdout\") Stderr = NewFile(uintptr(syscall.Stderr), \"/dev/stderr\") ) ``` \u6807\u51c6\u8f93\u5165\u5c31\u53ef\u4ee5\u548c\u65b9\u4fbf\u7684\u4f5c\u4e3a\u8bfb\u7aef\uff08 Reader \uff09\uff0c\u6807\u51c6\u8f93\u51fa\u53ef\u4ee5\u4f5c\u4e3a\u5199\u7aef\uff08 Writer \uff09 eg\uff1a \u7528\u4e00\u884c\u4ee3\u7801\u5b9e\u73b0\u4e00\u4e2a\u6700\u7b80\u5355\u7684 echo \u56de\u663e\u7684\u7a0b\u5e8f go func main() { // \u4e00\u884c\u4ee3\u7801\u5b9e\u73b0\u56de\u663e io.Copy(os.Stdout, os.Stdin) } \u7f13\u5b58io\u7684\u6545\u4e8b\uff1a bufio\u5e93 Reader/Writer \u53ef\u4ee5\u662f\u7f13\u51b2 IO \u7684\u6570\u636e\u6d41 Go\u7f13\u51b2IO\u662f\u5728 \u5e95\u5c42IO \u4e4b\u4e0a\u7684\u4e00\u5c42buffer \u5f62\u8c61\u63cf\u8ff0\u7684\u8bdd\uff0c\u53ef\u4ee5\u8bf4\u662f \u7528\u6237\u5185\u5b58\u7a7a\u95f4\u7684page cache \u5728 c \u8bed\u8a00\uff0c\u6709\u4eba\u80af\u5b9a\u7528\u8fc7 fopen \u6253\u5f00\u7684\u6587\u4ef6\uff08\u6240\u8c13\u7684\u6807\u51c6IO\uff09\uff1a C FILE * fopen ( const char * filename, const char * mode ); C \u8bed\u8a00\u7684\u7f13\u51b2IO\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a \u5168\u7f13\u51b2\uff1a \u53ea\u6709\u586b\u6ee1 buffer\uff0c\u624d\u4f1a\u771f\u6b63\u7684\u8c03\u7528\u5e95\u5c42IO \u884c\u7f13\u51b2\uff1a\u4e0d\u7528\u7b49\u586b\u6ee1buffer\uff0c\u9047\u5230\u6362\u884c\u7b26\uff0c\u5c31\u4f1a\u628aIO\u4e0b\u53d1\u4e0b\u53bb \u4e0d\u7f13\u51b2\uff1a bypass\u7684\u6a21\u5f0f\uff0c\u6bcf\u6b21\u90fd\u662f\u76f4\u63a5\u6389\u5e95\u5c42IO \u56db\u79cd\u65b9\u5f0f\uff0c\u5c06\u6570\u636e\u5199\u5165\u6587\u4ef6 os\u5305 f.Write([]byte) go var f *os.File var wireteString = \"\u4f60\u597d,tcy\" var d1 = []byte(wireteString) f, err3 := os.Create(\"./output.txt\") //\u521b\u5efa\u6587\u4ef6 n2, err3 := f.Write(d1) //\u5199\u5165\u6587\u4ef6(\u5b57\u8282\u6570\u7ec4) os\u65b9\u5f0f io\u5305\u7684io.WriteString(f, wireteString) go var wireteString = \"\u4f60\u597d,tcy\" n, err1 := io.WriteString(f, wireteString) //\u5199\u5165\u6587\u4ef6(\u5b57\u7b26\u4e32),io\u65b9\u5f0f,n\u4e3a\u51e0\u4e2a\u5b57\u8282 f.Sync() //Sync\u9012\u4ea4\u6587\u4ef6\u7684\u5f53\u524d\u5185\u5bb9\u8fdb\u884c\u7a33\u5b9a\u7684\u5b58\u50a8\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u8868\u793a\u5c06\u6587\u4ef6\u7cfb\u7edf\u7684\u6700\u8fd1\u5199\u5165\u7684\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u62f7\u8d1d\u5237\u65b0\u5230\u786c\u76d8\u4e2d\u7a33\u5b9a\u4fdd\u5b58 ioutil\u5305\u7684ioutil.WriteFile ```go var st = []byte(wireteString) err2 := ioutil.WriteFile(\"./output.txt\", st, 0666) //\u5199\u5165\u6587\u4ef6(\u5b57\u8282\u6570\u7ec4),\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u5c06\u6309\u7ed9\u51fa\u7684\u6743\u9650\u521b\u5efa\u6587\u4ef6\uff0c\u5426\u5219\u5728\u5199\u5165\u6570\u636e\u4e4b\u524d\u6e05\u7a7a\u6587\u4ef6\u3002 ``` bufio\u5305\u4e2d\u7684bufio.NewWriter(f) var f *os.File w := bufio.NewWriter(f) //\u521b\u5efa\u65b0\u7684 Writer \u5bf9\u8c61,NewReader\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u9ed8\u8ba4\u5927\u5c0f\u7f13\u51b2\u3001\u4ecer\u8bfb\u53d6\u7684*Reader n4, err3 := w.WriteString(\"\u4f60\u597d,tcy\") fmt.Printf(\"\u5199\u5165 %d \u4e2a\u5b57\u8282n\", n4) w.Flush() //Flush\u65b9\u6cd5\u5c06\u7f13\u51b2\u4e2d\u7684\u6570\u636e\u5199\u5165\u4e0b\u5c42\u7684io.Writer\u63a5\u53e3\u3002 f.Close() https://zhuanlan.zhihu.com/p/35277219","title":"Go \u7684IO"},{"location":"Operating%20System/#go-io","text":"","title":"Go \u7684IO"},{"location":"Operating%20System/#_1","text":"\u5185\u6838\u4e2d\u7684\u7f13\u51b2 \u65e0\u8bba\u8fdb\u7a0b\u662f\u5426\u63d0\u4f9b\u7f13\u51b2\uff0c\u5185\u6838\u90fd\u662f\u63d0\u4f9b\u7f13\u51b2\u7684\uff0c\u7cfb\u7edf\u5bf9\u78c1\u76d8\u7684\u8bfb\u5199\u90fd\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u7f13\u51b2\uff08page/buffer cache\uff09\uff0c\u5c06\u6570\u636e\u5199\u5165\u5230\u9875/\u5757\u7f13\u51b2\u8fdb\u884c\u6392\u961f\uff0c\u5f53\u9875/\u5757\u7f13\u51b2\u8fbe\u5230\u4e00\u5b9a\u7684\u91cf\u65f6\uff0c\u624d\u80fd\u628a\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002 \u8fdb\u7a0b\u4e2d\u7684\u7f13\u51b2 \u662f\u6307\u5bf9\u8f93\u5165\u8f93\u51fa\u6d41\u8fdb\u884c\u4e86\u6539\u8fdb\uff0c\u63d0\u4f9b\u4e86\u6d41\u7f13\u51b2\u3002\u5f53\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u5411\u78c1\u76d8\u5199\u6570\u636e\u65f6\uff0c\u5148\u628a\u6570\u636e\u5199\u5165\u7f13\u51b2\u533a\uff0c\u5f53\u8fbe\u5230\u67d0\u4e2a\u6761\u4ef6\u540e\uff0c\u5982\u6d41\u7f13\u51b2\u6ee1\u4e86\uff0c\u6216\u8005\u5237\u65b0\u6d41\u7f13\u51b2\uff0c\u8fd9\u65f6\u5019\u624d\u4f1a\u628a\u6570\u636e\u4e00\u6b21\u9001\u5f80\u5185\u6838\u63d0\u4f9b\u7684\u9875/\u5757\u7f13\u51b2\u533a\u4e2d\uff0c\u518d\u7ecf\u9875/\u5757\u5316\u91cd\u5199\u5165\u78c1\u76d8\u3002","title":"\u9996\u8981\u95ee\u9898\uff0c\u5185\u6838\u4e2d\u7684\u7f13\u51b2\u548c\u8fdb\u7a0b\u4e2d\u7684\u7f13\u51b2"},{"location":"Operating%20System/#operating-system-linuxio","text":"\u5f15\u8a00 \u64cd\u4f5c\u7cfb\u7edf\u9996\u5148\u662f\u4e00\u4e2a\u7cfb\u7edf\uff0c\u4e00\u822c\u7531\u4e0d\u540c\u7684\u6a21\u5757\u7ec4\u6210\uff0c\u5f80\u5f80\u4e3b\u8981\u529f\u80fd\u662fxxx\u7684 \u589e\u5220\u6539\u67e5 \u529f\u80fd\u3002\u64cd\u4f5c\u7cfb\u7edf\u4e3b\u8981\u662f\u7ba1\u7406\u786c\u4ef6\u548c\u63d0\u4f9b\u7ed9\u6211\u4eec\u4e00\u4e2a\u8212\u9002\u7684\u5f00\u53d1\u73af\u5883\u7684\u4f5c\u7528\u3002 \u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a \u5b50\u7cfb\u7edf \uff08VFS\u7b97\u4e00\u4e2a\uff09\uff0c\u5404\u4e2a\u5b50\u7cfb\u7edf\u53c8\u6709\u591a\u4e2a \u6a21\u5757 \u3002 \u4e3a\u4ec0\u4e48\u5904\u7406\u5668\u8bbe\u6709\u4e24\u79cd\u6a21\u5f0f\uff1f \u5185\u6838\u6001\u548c\u7528\u6237\u6001\uff0c \u5b89\u5168\u7b2c\u4e00 \u3002 \u865a\u62df\u5185\u5b58\u3002\u5176\u5b9e\u672c\u8d28\u4e0a\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u5c06\u7a0b\u5e8f\u5e38\u7528\u7684\u6570\u636e\u653e\u5230\u5185\u5b58\u91cc\u52a0\u901f\u8bbf\u95ee\uff0c\u4e0d\u5e38\u7528\u7684\u6570\u636e\u653e\u5728\u78c1\u76d8\u4e0a\u3002 \u8fd9\u4e00\u5207\u5bf9\u7528\u6237\u7a0b\u5e8f\u6765\u8bf4\u5b8c\u5168\u662f\u900f\u660e\u7684\uff0c\u7528\u6237\u7a0b\u5e8f\u53ef\u4ee5\u5047\u88c5\u6240\u6709\u6570\u636e\u90fd\u5728\u5185\u5b58\u91cc\uff0c\u7136\u540e\u901a\u8fc7\u865a\u62df\u5185\u5b58\u5730\u5740\u53bb\u8bbf\u95ee\u6570\u636e\u3002\u5728\u8fd9\u80cc\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u5728\u4e3b\u5b58\u548c\u78c1\u76d8\u4e4b\u95f4\u8fdb\u884c\u4ea4\u6362\u3002 \u64cd\u4f5c\u7cfb\u7edf\u5bf9\u5185\u5b58\u7684\u7ba1\u7406\u673a \u7a81\u7136\u60f3\u5230\u4e00\u4e2a\u54f2\u5b66\u95ee\u9898\uff0c\u8ddf\u751f\u6d3b\u662f\u76f8\u5173\u7684\u3002\u50cf\u6211\u4eec\u5e73\u65f6\u751f\u6d3b\u4e00\u6837\uff0c\u603b\u662f\u5c3d\u53ef\u80fd\u7684\u628a\u6bcf\u4e2a\u4e1c\u897f\u7528\u5c3d \u7528\u597d \u7528\u5230\u5b83\u7684\u6700\u5927\u6781\u9650\u3002\u540c\u7406\uff0c Go \u8bed\u8a00\u7684\u5185\u5b58\u7ba1\u7406\u662f\u53c2\u8003 tcmalloc \u5b9e\u73b0\u7684\uff0c\u5b83\u5176\u5b9e\u5c31\u662f\u5229\u7528\u597d\u4e86 OS \u7ba1\u7406\u5185\u5b58\u7684\u8fd9\u4e9b\u7279\u70b9\uff0c\u6765\u6700\u5927\u5316\u5185\u5b58\u5206\u914d\u6027\u80fd\u7684\u3002 Go \u8bed\u8a00\u662f\u5982\u4f55\u5229\u7528\u5e95\u5c42\u7684\u8fd9\u4e9b\u7279\u6027\u6765\u4f18\u5316\u5185\u5b58\u7684\uff1f \u5185\u5b58\u5206\u914d\u5927\u591a\u65f6\u5019\u90fd\u662f \u5728\u7528\u6237\u6001 \u5b8c\u6210\u7684\uff0c\u4e0d\u9700\u8981\u9891\u7e41\u8fdb\u5165\u5185\u6838\u6001\u3002 \u6bcf\u4e2a P \u90fd\u6709\u72ec\u7acb\u7684 span cache\uff0c\u591a\u4e2a CPU \u4e0d\u4f1a\u5e76\u53d1\u8bfb\u5199\u540c\u4e00\u5757\u5185\u5b58\uff0c\u8fdb\u800c\u51cf\u5c11 CPU L1 cache \u7684 cacheline \u51fa\u73b0 dirty \u60c5\u51b5\uff0c\u589e\u5927 cpu cache \u547d\u4e2d\u7387\u3002 \u5185\u5b58\u788e\u7247\u7684\u95ee\u9898\uff0cGo \u662f\u81ea\u5df1\u5728\u7528\u6237\u6001\u7ba1\u7406\u7684\uff0c\u5728 OS \u5c42\u9762\u770b\u662f\u6ca1\u6709\u788e\u7247\u7684\uff0c\u4f7f\u5f97\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u5bf9\u788e\u7247\u7684\u7ba1\u7406\u538b\u529b\u4e5f\u4f1a\u964d\u4f4e\u3002 mcache \u7684\u5b58\u5728\u4f7f\u5f97\u5185\u5b58\u5206\u914d\u4e0d\u9700\u8981\u52a0\u9501\u3002 Linux\u4e2dVFS ---> \u6587\u4ef6IO\u7cfb\u7edf \u200b \u5982\u4e0a\u56fe\u6240\u793a\uff0cpage cache\u7684\u672c\u8d28\u662f\u7531 Linux \u5185\u6838\u7ba1\u7406\u7684\u5185\u5b58\u533a\u57df\u3002\u6211\u4eec\u901a\u8fc7 mmap \u4ee5\u53ca buffered IO \u5c06\u6587\u4ef6\u8bfb\u53d6\u5230\u5185\u5b58\u7a7a\u95f4\u3002\u5b9e\u9645\u4e0a\uff0c\u90fd\u662f\u8bfb\u53d6\u5230 page cache\u4e2d\u3002 page cache \u9664\u4e86 Direct IO\uff0c\u4e0e\u78c1\u76d8\u76f8\u5173\u7684\u6587\u4ef6\u8bfb\u5199\u90fd\u6709\u4f7f\u7528\u5230 page cache\u6280\u672f kernel 2.6\u4ee5\u540e\uff08\u5f15\u5165\u4e86\u865a\u62df\u5185\u5b58\uff09\uff0cpage cache \u9762\u5411\u6587\u4ef6 \u6587\u4ef6I/O \uff08\u7cfb\u7edfI/O\uff09\u64cd\u4f5c\u53ea\u548cpage cache\u4ea4\u4e92 \u7528\u5728\u6240\u6709 \u4ee5\u6587\u4ef6\u4e3a\u5355\u5143 \u7684\u573a\u666f\u4e2d\uff0c\u6bd4\u5982\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf address_space \u4f5c\u4e3a\u6587\u4ef6\u7cfb\u7edf\u548c\u9875\u7f13\u5b58\u7684\u4e2d\u95f4\u9002\u914d\u5668\uff0c\u7528\u6765\u6307\u793a\u4e00\u4e2a\u6587\u4ef6\u5728page cache\u4e2d\u5df2\u7ecf\u7f13\u5b58\u4e86\u7684\u7269\u7406\u9875 \u5982\u4f55\u67e5\u770bOS\u7684 page cache? \u901a\u8fc7\u8bfb\u53d6 /proc/meminfo \u6587\u4ef6\uff0c\u80fd\u591f\u5b9e\u65f6\u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u60c5\u51b5\uff1a shell $ cat /proc/meminfo ... Buffers: 1224 kB Cached: 111472 kB SwapCached: 36364 kB Active: 6224232 kB Inactive: 979432 kB Active(anon): 6173036 kB Inactive(anon): 927932 kB Active(file): 51196 kB Inactive(file): 51500 kB ... Shmem: 10000 kB ... SReclaimable: 43532 kB ... \u6839\u636e\u4e0a\u9762\u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u7b80\u5355\u5f97\u51fa\u8fd9\u6837\u7684\u516c\u5f0f\uff1a page cache = buffers + cached + swap = active + inactive + share + swap \u4e3a\u4ec0\u4e48 swap \u548c buffers \u4e5f\u662f page cache\u7684\u4e00\u90e8\u5206\uff1f \u56e0\u4e3a\u5f53\u533f\u540d\u9875 Inactive(anon)\u4ee5\u53ca Active(anon) \u5148\u88ab\u4ea4\u6362\u5230\u78c1\u76d8\uff08out\uff09\u540e\uff0c\u7136\u540e\u518d\u52a0\u8f7d\u56de\uff08in\uff09\u5185\u5b58\u4e2d\uff0c\u7531\u4e8e\u8bfb\u5165\u5230\u5185\u5b58\u540e\u539f\u6765\u5730 swap file \u8fd8\u5728\uff0c\u6240\u4ee5 swap cached \u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f File-backed page\uff0c\u5373\u5c5e\u4e8e page cache\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a page \u548c page cache page \u662f\u5185\u6838\u5185\u5b58\u7ba1\u7406\u5206\u914d\u7684\u57fa\u672c\u5355\u4f4d\uff084KB\uff09 page cache \u7531\u591a\u4e2apage\u6784\u6210\uff084KB\u7684\u6574\u6570\u500d\uff09 \u6ce8\u610f \uff1a\u5e76\u4e0d\u662f\u6240\u6709 page \u90fd\u88ab\u7ec4\u7ec7\u6210\u4e3a page cache Linux \u7cfb\u7edf\u4e0a\u4f9b\u7528\u6237\u53ef\u8bbf\u95ee\u7684\u5185\u5b58\u5206\u4e3a\u4e24\u4e2a\u7c7b\u578b\uff1a File-backed pages: \u6587\u4ef6\u5907\u4efd\u9875\uff0c\u4e5f\u5c31\u662fpage cache\u4e2d\u7684 page\uff0c\u5bf9\u5e94\u4e8e\u78c1\u76d8\u4e0a\u7684\u82e5\u5e72\u6570\u636e\u5757\uff1b\u5bf9\u4e8e\u8fd9\u4e9b\u9875\u6700\u5927\u7684\u95ee\u9898\u662f\u810f\u9875\u56de\u76d8 Anonymous pages: \u533f\u540d\u9875\u4e0d\u5bf9\u5e94\u78c1\u76d8\u4e0a\u7684\u4efb\u4f55\u78c1\u76d8\u6570\u636e\u5757\uff0c\u4ed6\u4eec\u662f\u8fdb\u7a0b\u7684\u8fd0\u884c\u5185\u5b58\u7a7a\u95f4\uff0c\u6bd4\u5982\u65b9\u6cd5\u6808\u3001\u5c40\u90e8\u53d8\u91cf\u7b49\u5c5e\u6027 \u4e24\u79cd\u7c7b\u578b\u5728 swap \u673a\u5236\u4e0b\u7684\u6027\u80fd\u6bd4\u8f83\uff1a File-backed pages\u7684\u5185\u5b58\u56de\u6536\u4ee3\u4ef7\u8f83\u4f4e\u3002page cache \u901a\u5e38\u5bf9\u5e94\u4e8e\u4e00\u4e2a\u6587\u4ef6\u4e0a\u7684\u82e5\u5e72\u987a\u5e8f\u5757\uff0c \u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7\u987a\u5e8fIO\u7684\u65b9\u5f0f\u843d\u76d8\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c page cache \u4e0a\u6ca1\u6709\u8fdb\u884c\u5199\u64cd\u4f5c\uff08\u5373\u6ca1\u6709\u810f\u9875\uff09\uff0c\u751a\u81f3\u4e0d\u4f1a\u5c06page cache \u56de\u76d8\uff0c\u56e0\u4e3a\u6570\u636e\u7684\u5185\u5bb9\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7\u518d\u6b21\u8bfb\u53d6\u78c1\u76d8\u6587\u4ef6\u5f97\u5230\u3002 page cache \u7684\u4e3b\u8981\u96be\u70b9\u5728\u4e8e\u810f\u9875\u56de\u76d8\uff0c\u600e\u4e48\u4e2a\u96be\u6cd5\u5462\uff1f Anonymous pages \u7684\u5185\u5b58\u4f1a\u540e\u4ee3\u4ef7\u8f83\u9ad8\u3002\u56e0\u4e3a\u8fd9\u79cdpages \u901a\u5e38\u968f\u673a\u5730\u5199\u5165\u6301\u4e45\u5316\u4ea4\u6362\u8bbe\u5907\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u65e0\u8bba\u662f\u5426\u6709\u5199\u64cd\u4f5c\uff0c\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u4e0d\u4e22\u5931\uff0cAnonymous pages\u5728swap\u65f6\u5fc5\u987b\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002 swap \u4e0e \u7f3a\u9875\u4e2d\u65ad swap \u673a\u5236 \u6307\u5730\u662f\u5f53\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\uff0c\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08MMU\uff09\u9700\u8981\u63d0\u4f9b \u8c03\u5ea6\u7b97\u6cd5 \u6765\u56de\u6536\u76f8\u5173\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u5c06\u6e05\u7406\u51fa\u6765\u5730\u5185\u5b58\u7a7a\u95f4\u7ed9\u5f53\u524d\u5185\u5b58\u7533\u8bf7\u65b9\u3002 swap \u5b58\u5728\u5730\u672c\u8d28\u539f\u56e0\u662f Linux \u7cfb\u7edf\u63d0\u4f9b\u4e86\u865a\u62df\u5185\u5b58\u7ba1\u7406\u673a\u5236\u3002\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u8ba4\u4e3a\u81ea\u5df1\u72ec\u5360\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u6b64\u6240\u6709\u8fdb\u7a0b\u5730\u5185\u5b58\u7a7a\u95f4\u4e4b\u548c\u8fdc\u8fdc\u5927\u4e8e\u7269\u7406\u5185\u5b58\u3002\u6240\u6709\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u4e4b\u548c\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u7684\u90e8\u5206\u5c31\u9700\u8981\u4ea4\u6362\u5230\u78c1\u76d8\u4e0a\u3002 OS\u4ee5 page \u4e3a\u5355\u4f4d\u7ba1\u7406\u5185\u5b58\uff0c\u5f53\u8fdb\u7a0b\u53d1\u73b0\u9700\u8981\u8bbf\u95ee\u7684\u6570\u636e\u4e0d\u5728\u5185\u5b58\u65f6\uff0cOS\u53ef\u80fd\u4f1a\u5c06\u6570\u636e\u4ee5\u9875\u7684\u65b9\u5f0f\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u4e0a\u8ff0\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u7f3a\u9875\u4e2d\u65ad\u3002\u5f53OS\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u5c06 page \u518d\u6b21\u8bfb\u5230\u5185\u5b58\u4e2d\u3002 \u4f46\u4e3b\u5185\u5b58\u7684\u7a7a\u95f4\u65f6\u6709\u9650\u7684\uff0c\u5f53\u4e3b\u5185\u5b58\u4e2d\u4e0d\u5305\u542b\u53ef\u4ee5\u4f7f\u7528\u7684\u7a7a\u95f4\u65f6\uff0cOS\u4f1a\u9009\u62e9\u5408\u9002\u7684\u7269\u7406\u5185\u5b58\u9010\u9875\u9a71\u9010\u56de\u78c1\u76d8\uff0c\u4e3a\u65b0\u7684\u5185\u5b58\u9875\u8ba9\u51fa\u4f4d\u7f6e\uff0c\u9009\u62e9\u5f85\u9a71\u9010\u9875\u7684\u8fc7\u7a0b\u5728OS\u4e2d\u53eb\u505a\u9875\u9762\u66ff\u6362\uff08page replacement\uff09,\u66ff\u6362\u64cd\u4f5c\u53c8\u4f1a\u89e6\u53d1 swap \u673a\u5236\u3002 \u5982\u679c\u7269\u7406\u5185\u5b58\u8db3\u591f\u5927\uff0c\u90a3\u4e48\u53ef\u80fd\u4e0d\u9700\u8981 swap \u673a\u5236\uff0c\u4f46\u662f swap \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8fd8\u662f\u6709\u4e00\u5b9a\u4f18\u52bf\uff1a\u5bf9\u4e8e\u6709\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\u51e0\u7387\u7684\u5e94\u7528\u7a0b\u5e8f\uff08\u8fdb\u7a0b\uff09, swap\u4ea4\u6362\u5206\u533a\u66f4\u662f\u91cd\u8981\uff0c\u8fd9\u53ef\u4ee5\u786e\u4fdd\u5185\u5b58\u6cc4\u6f0f\u4e0d\u81f3\u4e8e\u5bfc\u81f4\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\uff0c\u6700\u7ec8\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\u3002\u4f46\u5185\u5b58\u6cc4\u6f0f\u4f1a\u5f15\u8d77\u9891\u7e41\u7684 swap\uff0c\u6b64\u65f6\u4f1a\u975e\u5e38\u5f71\u54cdOS\u7684\u6027\u80fd\u3002 Linux \u901a\u8fc7\u4e00\u4e2a swappiness \u53c2\u6570\u6765\u63a7\u5236 swap \u673a\u5236\uff1a\u8fd9\u4e2a\u53c2\u6570\u53ef\u4e3a 0~100\uff0c\u63a7\u5236\u7cfb\u7edfswap\u7684\u4f18\u5148\u7ea7\u3002 \u9ad8\u6570\u503c\uff0c\u8f83\u9ad8\u9891\u7387\u7684swap\uff0c\u8fdb\u7a0b\u4e0d\u6d3b\u8dc3\u65f6\u5c06\u5176\u8f6c\u6362\u51fa\u7269\u7406\u5185\u5b58 \u4f4e\u6570\u503c\uff0c\u8f83\u4f4e\u9891\u7387\u7684swap\uff0c\u8fd9\u53ef\u4ee5\u786e\u4fdd\u4ea4\u4e92\u5f0f\u4e0d\u56e0\u4e3a\u5185\u5b58\u7a7a\u95f4\u9891\u7e41\u5730\u4ea4\u6362\u5230\u78c1\u76d8\u800c\u63d0\u9ad8\u54cd\u5e94\u5ef6\u8fdf\u3002 page cache \u548c buffer cache shell ~ free -m total used free shared buffers cached Mem: 128956 96440 32515 0 5368 39900 -/+ buffers/cache: 51172 77784 Swap: 16002 0 16001 \u5176\u4e2d\uff0ccached \u8868\u793a\u5f53\u524d\u7684\u9875\u7f13\u5b58\uff08page cache\uff09\u5360\u7528\u91cf\uff0c\u7528\u4e8e\u7f13\u5b58\u6587\u4ef6\u7684\u9875\u6570\u636e\uff1b\u9875\u662f\u903b\u8f91\u4e0a\u7684\u6982\u5ff5\uff0c\u56e0\u6b64page cache \u662f\u4e0e\u6587\u4ef6\u7cfb\u7edf\u540c\u7ea7\u7684 buffers \u8868\u793a\u5f53\u524d\u7684\u5757\u7f13\u5b58\uff08buffer cache\uff09\u5360\u7528\u91cf\uff0c\u7528\u4e8e\u7f13\u5b58\u5757\u8bbe\u5907\u7684\u5757\u6570\u636e\uff1b\u5757\u662f\u7269\u7406\u4e0a\u7684\u6982\u5ff5\uff0c\u56e0\u6b64buffer cache\u662f\u4e0e\u5757\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u540c\u7ea7\u7684\u3002 page cache \u548c buffer cache\u7684\u5171\u540c\u76ee\u7684\u90fd\u662f\u52a0\u901f\u6570\u636eIO\u3002\u5199\u6570\u636e\u65f6\uff0c\u9996\u5148\u5199\u5230\u7f13\u5b58\uff0c\u5c06\u5199\u5165\u7684\u9875\u6807\u8bb0\u4e3a dirty\uff0c\u7136\u540e\u5411\u5916\u90e8\u5b58\u50a8 flush\uff0c\u4e5f\u5c31\u662f\u7f13\u5b58\u5199\u673a\u5236\u4e2d\u7684 write-back\uff08\u53e6\u4e00\u79cd\u662f write-through\uff0cLinux\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u91c7\u7528\uff09\uff1b\u8bfb\u6570\u636e\u65f6\uff0c\u9996\u5148\u8bfb\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u547d\u4e2d\uff0c\u518d\u53bb\u5916\u90e8\u5b58\u50a8\u8bfb\u53d6\uff0c\u5e76\u4e14\u5c06\u8bfb\u53d6\u6765\u7684\u6570\u636e\u9875\u52a0\u5165\u7f13\u5b58\u3002OS \u603b\u662f\u79ef\u6781\u5730 \u5c06\u6240\u6709\u7a7a\u95f2\u5185\u5b58\u90fd\u7528\u505a page cache\u548c buffer cache\uff0c\u5f53\u5185\u5b58\u4e0d\u591f\u7528\u65f6\uff0c\u4e5f\u4f1a\u7528LRU\u7b49\u7b97\u6cd5\u6dd8\u6c70\u7f13\u5b58\u9875\u3002 \u5728Linux 2.4 \u5185\u6838\u4e4b\u524d\uff0cpage cache \u548c buffer cache\u662f\u5b8c\u5168\u5206\u79bb\u7684\u3002\u4f46\u662f\uff0c\u5757\u8bbe\u5907\u5927\u591a\u662f\u78c1\u76d8\uff0c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u53c8\u5927\u591a\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u6765\u7ec4\u7ec7\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5bfc\u81f4\u5f88\u591a\u6570\u636e\u88ab\u7f13\u5b58\u4e86\u4e24\u6b21\uff0c\u6d6a\u8d39\u5185\u5b58\u3002\u6240\u4ee5\uff0c \u57282.4\u7248\u672c\u4e4b\u540e\uff0c\u4e24\u5757\u7f13\u5b58\u8fd1\u4f3c\u878d\u5408\u5728\u4e86\u4e00\u8d77\uff0c\u5982\u679c\u4e00\u4e2a\u6587\u4ef6\u7684\u9875\u52a0\u8f7d\u5230\u4e86 page cache\uff0c\u90a3\u4e48\u540c\u65f6 buffer cache\u53ea\u9700\u8981\u7ef4\u62a4\u5757\u6307\u5411\u9875\u7684\u6307\u9488\u5c31\u53ef\u4ee5\u4e86\u3002 \u53ea\u6709\u90a3\u4e48\u6ca1\u6709\u7528\u6587\u4ef6\u8868\u793a\u7684\u5757\uff0c\u6216\u8005\u7ed5\u8fc7\u4e86OS\u76f4\u63a5\u64cd\u4f5c\u7684\u5757\uff08\u5982dd\u547d\u4ee4\uff09\uff0c\u624d\u4f1a\u771f\u6b63\u653e\u5230 buffer cache\u4e2d\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u73b0\u5728\u63d0\u8d77 page cache\uff0c\u57fa\u672c\u4e0a\u90fd\u540c\u65f6\u6307 page cache \u548c buffer cache \u4e24\u8005\u3002 \u4e0b\u56fe\u8fd1\u4f3c\u5730\u7ed9\u51fa 32\u4f4d Linux\u7cfb\u7edf\u4e2d\u53ef\u80fd\u5730\u4e00\u79cd page cache\u7ed3\u6784\uff1a block size = 1KB page size = 4KB page cache\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u90fd\u662f\u4e00\u68f5 \u57fa\u6570\u6811 \uff08radix tree,\u672c\u8d28\u4e0a\u662f\u591a\u5dee\u641c\u7d22\u6811\uff09\uff0c\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u9875\u3002\u6839\u636e\u6587\u4ef6\u5185\u7684\u504f\u79fb\u91cf\u5c31\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u5230\u6240\u5728\u7684\u9875\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 page cache\u4e0e\u9884\u8bfb OS\u4e3a\u57fa\u4e8epage cache\u7684\u8bfb\u7f13\u5b58\u673a\u5236\u63d0\u4f9b\u9884\u8bfb\u673a\u5236\uff08PAGE_READAHEAD\uff09,eg: \u7528\u6237\u7ebf\u7a0b\u4ec5\u4ec5\u8bf7\u6c42\u8bfb\u53d6\u78c1\u76d8\u4e0a\u6587\u4ef6A\u7684offset\u4e3a0-3KB\u8303\u56f4\u5185\u7684\u6570\u636e\uff0c\u7531\u4e8e\u78c1\u76d8\u7684\u57fa\u672c\u8bfb\u5199\u5355\u4f4d\u4e3a block = 4KB\uff0c\u4e8e\u662fOS\u81f3\u5c11\u4f1a\u8bfb0-4KB\u7684\u5185\u5bb9\uff0c\u8fd9\u6070\u597d\u53ef\u4ee5\u5728\u4e00\u4e2apage\u4e2d\u88c5\u4e0b\u3002 \u4f46\u662fOS\u5904\u4e8e \u5c40\u90e8\u6027\u539f\u7406 \u4f1a\u9009\u62e9\u5c06\u78c1\u76d8\u5757 offset[4KB,8KB)\u3001[8KB,12KB)\u3001[12KB,16KB)\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4e8e\u662f\u989d\u5916\u5728\u5185\u5b58\u4e2d\u7533\u8bf7\u4e863\u4e2apage\u3002\u5982\u4e0b\u5982\u56fe\u6240\u793aOS\u7684\u9884\u8bfb\u673a\u5236\uff1a page cache\u4e0e\u6587\u4ef6\u6301\u4e45\u5316\u7684\u4e00\u81f4\u6027 \u73b0\u4ee3 Linux \u7684page cache\u6b63\u5982\u5176\u540d\uff0c\u662f\u5bf9\u78c1\u76d8\u4e0a\u7684 page \u7684\u5185\u5b58\u7f13\u5b58\uff0c\u540c\u65f6\u53ef\u4ee5\u7528\u4e8e\u8bfb/\u5199\u64cd\u4f5c\u3002 \u4efb\u4f55\u7cfb\u7edf\u5f15\u5165\u7f13\u5b58\uff0c\u5c31\u4f1a\u5f15\u53d1\u4e00\u81f4\u6027\u95ee\u9898 \uff1a\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4e0e\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5982\u6700\u5e38\u89c1\u540e\u7aef\u67b6\u6784\u4e2d\u7684redis\u7f13\u5b58\u4e0emysql\u6570\u636e\u5e93\u5c31\u5b58\u5728\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002 Linux \u63d0\u4f9b\u591a\u79cd\u673a\u5236\u6765\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f46\u65e0\u8bba\u662f\u5355\u673a\u4e0a\u7684\u5185\u5b58\u4e0e\u78c1\u76d8\u4e00\u81f4\u6027\uff0c\u8fd8\u662f\u5206\u5e03\u5f0f\u7ec4\u4ef6\u4e2d\u8282\u70b91\u4e0e\u8282\u70b92\u30013\u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u7406\u89e3\u7684\u5173\u952e\u662f trade-off\uff1a\u541e\u5410\u91cf\u4e0e\u6570\u636e\u4e00\u81f4\u6027\u4fdd\u8bc1\u662f\u4e00\u5bf9\u77db\u76fe\u3002 \u9996\u5148\uff0c\u9700\u8981\u6211\u4eec\u7406\u89e3\u4e00\u4e0b\u6587\u4ef6\u7684\u6570\u636e\uff0c\u6587\u4ef6 = \u5143\u6570\u636e+\u6570\u636e\u3002 \u5143\u6570\u636e=\u6587\u4ef6\u5927\u5c0f+\u521b\u5efa\u65f6\u95f4+\u8bbf\u95ee\u65f6\u95f4+\u5c5e\u4e3b\u5c5e\u7ec4\u7b49\u4fe1\u606f Linux \u91c7\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u5b9e\u73b0\u6587\u4ef6\u4e00\u81f4\u6027\uff1a Write Through(\u5199\u7a7f)\uff1a\u5411\u7528\u6237\u5c42\u63d0\u4f9b\u7279\u5b9a\u63a5\u53e3\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4e3b\u52a8\u8c03\u7528\u63a5\u53e3\u6765\u4fdd\u8bc1\u6587\u4ef6\u4e00\u81f4\u6027\uff1b \u4ee5\u727a\u7272\u7cfb\u7edfIO\u541e\u5410\u91cf\u4e3a\u4ee3\u4ef7\uff0c\u5411\u4e0a\u5c42\u5e94\u7528\u786e\u4fdd\u4e00\u65e6\u5199\u5165\uff0c\u6570\u636e\u5c31\u5df2\u7ecf\u843d\u76d8\uff0c\u4e0d\u4f1a\u4e22\u5931\u3002 Write Back(\u5199\u56de)\uff1a\u7cfb\u7edf\u4e2d\u5b58\u5728\u5b9a\u671f\u4efb\u52a1\uff08\u8868\u73b0\u5f62\u5f0f\u4e3a\u5185\u6838\u7ebf\u7a0b\uff09\uff0c\u5468\u671f\u6027\u5730\u540c\u6b65\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6587\u4ef6\u810f\u6570\u636e\u5757\uff0c\u8fd9\u5c31\u662f\u9ed8\u8ba4\u7684Linux\u4e00\u81f4\u6027\u65b9\u6848\uff1b \u5728\u7cfb\u7edf\u53d1\u751f\u5b95\u673a\u7684\u60c5\u51b5\u4e0b\u65e0\u6cd5\u786e\u4fdd\u6570\u636e\u5df2\u7ecf\u843d\u76d8\uff0c\u56e0\u6b64\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002\u4e0d\u8fc7\uff0c\u5728\u7a0b\u5e8f\u6302\u4e86\uff0c\u5982\u88ab kill -9, OS\u4f1a\u786e\u4fddpage cache \u4e2d\u7684\u6570\u636e\u843d\u76d8\u3002 \u4e24\u79cd\u65b9\u6cd5\u90fd\u4f9d\u8d56\u7cfb\u7edf\u8c03\u7528\uff0c\u4e3b\u8981\u5206\u4e3a\u4e09\u79cd\u7cfb\u7edf\u8c03\u7528\uff0c\u53ef\u4ee5\u5206\u522b\u7531\u7528\u6237\u8fdb\u7a0b\u4e0e\u5185\u6838\u8fdb\u7a0b\u53d1\u8d77\uff1a fsync(int fd)\uff0c\u5c06fd \u4ee3\u8868\u7684 \u6587\u4ef6\u7684 \u810f\u6570\u636e\u548c\u810f\u5143\u6570\u636e\u5168\u90e8\u5237\u65b0\u5230\u78c1\u76d8\u4e2d fdatasync(int fd)\uff0c\u5c06 fd \u4ee3\u8868\u7684\u6587\u4ef6\u7684\u810f\u6570\u636e\u5237\u65b0\u81f3\u78c1\u76d8\uff0c\u540c\u65f6\u5bf9\u5fc5\u8981\u7684\uff08\u6587\u4ef6\u5927\u5c0f\uff0c\u800c\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u7b49\u4e0d\u5c5e\u4e8e\u5fc5\u8981\u4fe1\u606f\uff09\u5143\u6570\u636e\u5237\u65b0\u81f3\u78c1\u76d8\u4e2d\u3002 sync()\uff0c\u5bf9 \u7cfb\u7edf\u4e2d\u6240\u6709\u7684 \u810f\u7684\u6587\u4ef6\u6570\u636e\u3001\u5143\u6570\u636e\u90fd\u5237\u65b0\u81f3\u78c1\u76d8\u4e2d \u63cf\u8ff0\u4e00\u4e0b\u5185\u6838\u7ebf\u7a0b\u7684\u76f8\u5173\u7279\u6027\uff1a \u521b\u5efa\u7684\u9488\u5bf9 \u56de\u5199\u4efb\u52a1 \u7684\u5185\u6838\u7ebf\u7a0b\u6570\u7531\u7cfb\u7edf\u4e2d\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u51b3\u5b9a\uff0c\u4e3a\u6bcf\u4e2a\u5b58\u50a8\u8bbe\u5907\u521b\u5efa\u5355\u72ec\u7684\u5237\u65b0\u7ebf\u7a0b\uff1b \u5173\u4e8e \u591a\u7ebf\u7a0b\u7684\u67b6\u6784 \u95ee\u9898\uff0cLinux\u5185\u6838\u91c7\u53d6\u4e86 Lighthttp \u7684\u505a\u6cd5\u3002\u5373\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e00\u4e2a\u7ba1\u7406\u7ebf\u7a0b\u548c\u591a\u4e2a\u5237\u65b0\u7ebf\u7a0b\uff08\u6bcf\u4e2a\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u5bf9\u5e94\u4e00\u4e2a\u5237\u65b0\u7ebf\u7a0b\uff09\u3002\u7ba1\u7406\u7ebf\u7a0b\u76d1\u63a7\u8bbe\u5907\u4e0a\u7684\u810f\u9875\u9762\u60c5\u51b5\uff0c\u82e5\u8bbe\u5907\u4e00\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u4ea7\u751f\u810f\u9875\u9762\uff0c\u5c31\u9500\u6bc1\u8bbe\u5907\u4e0a\u7684\u5237\u65b0\u7ebf\u7a0b\uff1b\u82e5\u76d1\u6d4b\u5230\u8bbe\u5907\u4e0a\u6709\u810f\u9875\u9762\u9700\u8981\u56de\u5199\u4e14\u5c1a\u672a\u4e3a\u8be5\u8bbe\u5907\u521b\u5efa\u5237\u65b0\u7ebf\u7a0b\uff0c\u90a3\u4e48\u521b\u5efa\u5237\u65b0\u7ebf\u7a0b\u5904\u7406\u810f\u9875\u9762\u56de\u5199\u3002\u800c\u5237\u65b0\u7ebf\u7a0b\u7684\u4efb\u52a1\u8f83\u4e3a\u5355\u8c03\uff0c\u53ea\u8d1f\u8d23\u5c06\u8bbe\u5907\u4e2d\u7684\u810f\u9875\u9762\u56de\u5199\u81f3\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u4e2d\u3002 \u5237\u65b0\u7ebf\u7a0b\u5237\u65b0\u8bbe\u5907\u4e0a\u810f\u9875\u9762\u5927\u81f4\u8bbe\u8ba1\u5982\u4e0b\uff1a \u6bcf\u4e2a\u8bbe\u5907\u4fdd\u5b58\u810f\u6587\u4ef6\u94fe\u8868\uff0c\u4fdd\u5b58\u7684\u662f\u8be5\u8bbe\u5907\u4e0a\u5b58\u50a8\u7684\u810f\u6587\u4ef6\u7684inode\u8282\u70b9\u3002\u6240\u8c13\u7684\u56de\u5199\u6587\u4ef6\u810f\u9875\u9762\u5373\u56de\u5199\u8be5 inode \u94fe\u8868\u4e0a\u7684\u67d0\u4e9b\u6587\u4ef6\u7684\u810f\u9875\u9762\uff1b \u7cfb\u7edf\u4e2d\u5b58\u5728\u591a\u4e2a\u56de\u5199\u65f6\u673a\u3002\u7b2c\u4e00\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e3b\u52a8\u8c03\u7528\u56de\u5199\u63a5\u53e3\uff1b\u7b2c\u4e8c\uff0c\u7ba1\u7406\u7ebf\u7a0b\u5468\u671f\u6027\u5730\u5524\u9192\u8bbe\u5907\u4e0a\u7684\u56de\u5199\u7ebf\u7a0b\u8fdb\u884c\u56de\u5199\uff1b\u7b2c\u4e09\uff0c\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f/\u5185\u6838\u4efb\u52a1\u53d1\u73b0\u5185\u5b58\u4e0d\u8db3\u65f6\u8981\u56de\u6536\u90e8\u5206\u7f13\u5b58\u9875\u9762\u800c\u4e8b\u5148\u8fdb\u884c\u810f\u9875\u9762\u56de\u5199\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u7edf\u4e00\u7684\u6846\u67b6\u6765\u7ba1\u7406\u8fd9\u4e9b\u56de\u5199\u4efb\u52a1\u975e\u5e38\u6709\u5fc5\u8981\u3002 \u4f18\u52bf\uff0c\u597d\u5904\uff0c\u7279\u70b9\uff0c\u72ec\u7279\u3002\u3002\u3002 \u52a0\u5feb\u6570\u636e\u8bbf\u95ee \u51cf\u5c11IO\u6b21\u6570\uff0c\u63d0\u9ad8\u7cfb\u7edf\u78c1\u76d8IO\u541e\u5410\u91cf \u5f97\u76ca\u4e8e page cache\u7684\u7f13\u5b58\u4ee5\u53ca\u9884\u8bfb\u80fd\u529b\uff0c\u800c\u7a0b\u5e8f\u53c8\u5f80\u5f80\u7b26\u5408\u5c40\u90e8\u6027\u539f\u7406\u3002 \u52a3\u52bf\uff0c\u7f3a\u70b9\uff0c\u4e0d\u8db3\u3002\u3002\u3002 \u6700\u76f4\u63a5\u7684\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u5360\u7528 \u989d\u5916 \u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u7269\u7406\u5185\u5b58\u5728\u6bd4\u8f83\u7d27\u5f20\u7684\u65f6\u5019\u53ef\u80fd\u5bfc\u81f4\u9891\u7e41\u7684 swap \u64cd\u4f5c\uff0c\u6700\u7ec8\u5bfc\u81f4\u7cfb\u7edf\u7684\u78c1\u76d8IO\u8d1f\u8f7d\u4e0a\u5347\u3002\uff08\u8fd8\u662f\u90a3\u4e2a\u89c2\u70b9\uff0c\u5de5\u4e1a4.0\u65f6\u4ee3\uff0c\u591a\u7528\u70b9\u800c\u5185\u5b58\u4f1a\u5e26\u6765\u4eba\u4eec\u7684\u7f8e\u597d\u751f\u6d3b\uff09 \u5bf9\u5e94\u7528\u5c42 \u6ca1\u6709\u63d0\u4f9b \u5f88\u597d\u7684\u7ba1\u7406API\uff0c\u51e0\u4e4e\u662f\u900f\u660e\u7ba1\u7406\u3002\u5e94\u7528\u5c42\u5373\u4f7f\u60f3\u4f18\u5316 page cache\u7684\u4f7f\u7528\u7b56\u7565\u4e5f\u5f88\u96be\u8fdb\u884c\u3002\u56e0\u4e3a\u4e00\u4e9b\u5e94\u7528\u9009\u62e9\u5728\u7528\u6237\u7a7a\u95f4\u5b9e\u73b0\u81ea\u5df1\u7684 page \u7ba1\u7406\uff0c\u800c\u4e0d\u4f7f\u7528 page cache\uff0c\u4f8b\u5982 mysql \u7684 innoDB\u5b58\u50a8\u5f15\u64ce\u4ee5 16KB\u7684\u9875\u8fdb\u884c\u7ba1\u7406\u3002\uff08\u4e8b\u5b9e\u662f\u63d0\u4f9b\u4e86\uff0c\u4f46\u67d0\u4eba\u89c9\u5f97\u6ee1\u8db3\u4e0d\u4e86\u4ed6\u7684\u7f8e\u597d\u751f\u6d3b\uff0c\u770b\u6765\u4eba\u4eec\u7684\u7f8e\u597d\u751f\u6d3b\u662f\u65e5\u76ca\u589e\u957f\u7684\uff09 \u67d0\u4e9b\u573a\u666f\u4e0b \u6bd4 Direct IO\u591a\u4e00\u6b21\u78c1\u76d8IO \u96f6\u62f7\u8d1d \u5386\u53f2\u53d8\u8fc1\uff1a \u200b \u6ca1\u6709\u4efb\u4f55\u4f18\u5316\u6280\u672f\u7684\u6570\u636e\u56db\u6b21\u62f7\u8d1d\u4e0e\u56db\u6b21\u4e0a\u4e0b\u6587\u5207\u6362 DMA\u53c2\u4e0e\u4e0b\u7684\u6570\u636e\u56db\u6b21\u62f7\u8d1d DMA \u4e5f\u6709\u5176\u5c40\u9650\u6027\uff0cDMA \u4ec5\u4ec5\u80fd\u7528\u4e8e\u8bbe\u5907\u4e4b\u95f4\u4ea4\u6362\u6570\u636e\u65f6\u8fdb\u884c\u6570\u636e\u62f7\u8d1d\uff0c\u4f46\u662f\u7cfb\u7edf\u5185\u90e8\u7684\u6570\u636e\u62f7\u8d1d\u8fd8\u9700\u8981 CPU \u8fdb\u884c\uff0c\u4f8b\u5982 CPU \u9700\u8981\u8d1f\u8d23\u5185\u6838\u7a7a\u95f4\u6570\u636e\u4e0e\u7528\u6237\u7a7a\u95f4\u6570\u636e\u4e4b\u95f4\u7684\u62f7\u8d1d\uff08\u5185\u5b58\u5185\u90e8\u7684\u62f7\u8d1d\uff09 \u3002 read buffer == page cache socket buffer == socket \u7f13\u51b2\u533a \u4e0d\u540c\u7684\u96f6\u62f7\u8d1d\u6280\u672f\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f DMA \u6280\u672f\u56de\u987e\uff1aDMA \u8d1f\u8d23\u5185\u5b58\u4e0e\u5176\u4ed6\u7ec4\u4ef6\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\uff0cCPU \u4ec5\u9700\u8d1f\u8d23\u7ba1\u7406\uff0c\u800c\u65e0\u9700\u8d1f\u8d23\u5168\u7a0b\u7684\u6570\u636e\u62f7\u8d1d\uff1b \u4f7f\u7528 page cache \u7684 zero copy\uff1a sendfile\uff1a\u4e00\u6b21\u4ee3\u66ff read/write \u7cfb\u7edf\u8c03\u7528\uff0c\u901a\u8fc7\u4f7f\u7528 DMA \u6280\u672f\u4ee5\u53ca\u4f20\u9012\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5b9e\u73b0\u4e86 zero copy mmap\uff1a\u4ec5\u4ee3\u66ff read \u7cfb\u7edf\u8c03\u7528\uff0c\u5c06\u5185\u6838\u7a7a\u95f4\u5730\u5740\u6620\u5c04\u4e3a\u7528\u6237\u7a7a\u95f4\u5730\u5740\uff0cwrite \u64cd\u4f5c\u76f4\u63a5\u4f5c\u7528\u4e8e\u5185\u6838\u7a7a\u95f4\u3002\u901a\u8fc7 DMA \u6280\u672f\u4ee5\u53ca\u5730\u5740\u6620\u5c04\u6280\u672f\uff0c\u7528\u6237\u7a7a\u95f4\u4e0e\u5185\u6838\u7a7a\u95f4\u65e0\u987b\u6570\u636e\u62f7\u8d1d\uff0c\u5b9e\u73b0\u4e86 zero copy \u4e0d\u4f7f\u7528 page cache \u7684 Direct I/O\uff1a\u8bfb\u5199\u64cd\u4f5c\u76f4\u63a5\u5728\u78c1\u76d8\u4e0a\u8fdb\u884c\uff0c\u4e0d\u4f7f\u7528 page cache \u673a\u5236\uff0c\u901a\u5e38\u7ed3\u5408\u7528\u6237\u7a7a\u95f4\u7684\u7528\u6237\u7f13\u5b58\u4f7f\u7528\u3002\u901a\u8fc7 DMA \u6280\u672f\u76f4\u63a5\u4e0e\u78c1\u76d8/\u7f51\u5361\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\uff0c\u5b9e\u73b0\u4e86 zero copy \u96f6\u62f7\u8d1d \u601d\u60f3 \uff08 \u4e0d\u662f\u4e0d\u8fdb\u884c\u62f7\u8d1d\uff0c\u800c\u662f CPU \u4e0d\u518d\u5168\u7a0b\u8d1f\u8d23\u6570\u636e\u62f7\u8d1d\u65f6\u7684\u642c\u8fd0\u5de5\u4f5c \uff09\u7684\u4e00\u4e2a\u5177\u4f53\u5b9e\u73b0\u3002 \u4e00\u79cd\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u7684\u65b9\u6cd5\uff0c\u5b9e\u73b0\u6587\u4ef6\u78c1\u76d8\u5730\u5740\u548c\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e00\u6bb5\u865a\u62df\u5730\u5740\u7684\u4e00\u4e00\u6620\u5c04\u5173\u7cfb\u3002 \u96f6\u62f7\u8d1d\u7684\u7279\u70b9\u662f CPU \u4e0d\u5168\u7a0b\u8d1f\u8d23\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5199\u5165\u5176\u4ed6\u7ec4\u4ef6\uff0cCPU \u4ec5\u4ec5\u8d77\u5230\u7ba1\u7406\u7684\u4f5c\u7528 \u3002 \u5177\u4f53\u5b9e\u73b0\uff1a sendfile \uff08 \u7528\u6237\u4ece\u78c1\u76d8\u8bfb\u53d6\u4e00\u4e9b\u6587\u4ef6\u6570\u636e\u540e \u4e0d\u9700\u8981\u7ecf\u8fc7\u4efb\u4f55\u8ba1\u7b97\u4e0e\u5904\u7406 \u5c31\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u51fa\u53bb \uff09 mmap \uff0c\u5229\u7528 mmap() \u66ff\u6362 read() \uff0c\u914d\u5408 write() \u8c03\u7528\u7684\u6574\u4e2a\u6d41\u7a0b\u5982\u4e0b\uff1a \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 mmap() \uff0c\u4ece\u7528\u6237\u6001\u9677\u5165\u5185\u6838\u6001\uff0c\u5c06\u5185\u6838\u7f13\u51b2\u533a\u6620\u5c04\u5230\u7528\u6237\u7f13\u5b58\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u786c\u76d8\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff08\u53ef\u89c1\u5176\u4f7f\u7528\u4e86 Page Cache \u673a\u5236\uff09\uff1b mmap() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\uff1b \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 write() \uff0c\u5c1d\u8bd5\u628a\u6587\u4ef6\u6570\u636e\u5199\u5230\u5185\u6838\u91cc\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff0c\u518d\u6b21\u9677\u5165\u5185\u6838\u6001\uff1b CPU \u5c06\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u5957\u63a5\u5b57\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7f51\u5361\u5b8c\u6210\u6570\u636e\u4f20\u8f93\uff1b write() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\u3002 splice \u76f4\u63a5 Direct I/O \uff08\u81ea\u7f13\u5b58\u5e94\u7528\u7a0b\u5e8f\uff0c\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u5c31\u662f\u8fd9\u7c7b\u7684\u4e00\u4e2a\u4ee3\u8868\uff09 \u4e0d\u540c\u7684\u96f6\u62f7\u8d1d\u6280\u672f\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u5e94\u7528 \u573a\u666f \u3002 \u628ammap\u5355\u72ec\u62ff\u51fa\u6765\u8bf4 \u7528\u6237\u7a7a\u95f4mmap--->\u5185\u6838\u7a7a\u95f4mmap--->\u7f3a\u9875\u5f02\u5e38 \u5bf9\u6bd4\uff0c \u4ece\u5185\u6838\u6587\u4ef6\u7cfb\u7edf\u770b\u6587\u4ef6\u8bfb\u5199\u8fc7\u7a0b \u6848\u4f8b kafaka \u4f7f\u7528 mmap \u6765\u5bf9\u63a5\u6536\u5230\u7684\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u4f7f\u7528 sendfile \u4ece\u6301\u4e45\u5316\u4ecb\u8d28\u4e2d\u8bfb\u53d6\u6570\u636e\u7136\u540e\u5bf9\u5916\u53d1\u9001\u662f\u4e00\u5bf9\u5e38\u7528\u7684\u7ec4\u5408\u3002\u4f46\u662f\u6ce8\u610f\uff0c\u4f60\u65e0\u6cd5\u5229\u7528 sendfile \u6765\u6301\u4e45\u5316\u6570\u636e\uff0c\u5229\u7528 mmap \u6765\u5b9e\u73b0 CPU \u5168\u7a0b\u4e0d\u53c2\u4e0e\u6570\u636e\u642c\u8fd0\u7684\u6570\u636e\u62f7\u8d1d\u3002 mysql \u7684\u96f6\u62f7\u8d1d\u6280\u672f \u603b\u800c\u8a00\u4e4b\uff0c\u5e38\u89c4\u6587\u4ef6\u64cd\u4f5c\u9700\u8981\u4ece\u78c1\u76d8\u5230\u9875\u7f13\u5b58\u518d\u5230\u7528\u6237\u4e3b\u5b58\u7684\u4e24\u6b21\u6570\u636e\u62f7\u8d1d\u3002\u800cmmap\u64cd\u63a7\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u4ece \u78c1\u76d8\u5230\u7528\u6237\u4e3b\u5b58 \u7684\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\u8fc7\u7a0b\u3002 \u8bf4\u767d\u4e86\uff0cmmap\u7684\u5173\u952e\u70b9\u662f\u5b9e\u73b0\u4e86\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u7684\u6570\u636e\u76f4\u63a5\u4ea4\u4e92\u800c\u7701\u53bb\u4e86\u4e0d\u540c\u7a7a\u95f4\u6570\u636e\u4e0d\u901a\u7684\u7e41\u7410\u8fc7\u7a0b \u3002 mmap \u4e00\u79cd\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u7684\u65b9\u6cd5\u3002\u5c06\u4e00\u4e2a\u6587\u4ef6\u6216\u8005\u5176\u5b83\u5bf9\u8c61\u6620\u5c04\u5230\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5b9e\u73b0\u6587\u4ef6\u78c1\u76d8\u5730\u5740\u548c\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e00\u6bb5\u865a\u62df\u5730\u5740\u7684\u4e00\u4e00\u5bf9\u5e94\u5173\u7cfb\u3002\u5b9e\u73b0\u8fd9\u6837\u7684\u6620\u5c04\u5173\u7cfb\u540e\uff0c\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u91c7\u7528\u6307\u9488\u7684\u65b9\u5f0f\u8bfb\u5199\u8fd9\u4e00\u6bb5\u5185\u5b58\uff0c\u800cOS\u4f1a\u81ea\u52a8\u56de\u5199\u810f\u9875\u9762\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u78c1\u76d8\u4e0a\uff0c\u5373\u5b8c\u6210\u4e86\u5bf9\u6587\u4ef6\u7684\u64cd\u4f5c\u800c\u4e0d\u5fc5\u518d\u8c03\u7528read\u3001write\u7b49\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002\u76f8\u53cd\uff0c\u5185\u6838\u7a7a\u95f4\u5bf9\u8fd9\u6bb5\u533a\u57df\u7684\u4fee\u6539\u4e5f\u76f4\u63a5\u53cd\u6620\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u4ece\u800c\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u8fdb\u7a0b\u95f4\u7684\u6587\u4ef6\u5171\u4eab\u3002 \u7279\u70b9 mmap \u5411\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684\u5185\u5b58\u8bbf\u95ee\u63a5\u53e3\u662f\u5185\u5b58\u5730\u5740\u8fde\u7eed\u7684\uff0c\u4f46\u662f\u5bf9\u5e94\u7684\u78c1\u76d8\u6587\u4ef6\u7684 block \u53ef\u4ee5\u4e0d\u662f\u5730\u5740\u8fde\u7eed\u7684 mmap \u63d0\u4f9b\u7684\u5185\u5b58\u7a7a\u95f4\u662f\u865a\u62df\u7a7a\u95f4\uff0c\u800c\u4e0d\u662f\u7269\u7406\u7a7a\u95f4\uff0c\u56e0\u6b64\u5b8c\u5168\u53ef\u4ee5\u5206\u914d\u8fdc\u8fdc\u5927\u4e8e\u7269\u7406\u5185\u5b58\u5927\u5c0f\u7684\u865a\u62df\u7a7a\u95f4\uff0c\u598216G\u5185\u5b58\u4e3b\u673a\u53ef\u4ee5\u5206\u914d1000G\u7684mmap\u5185\u5b58\u7a7a\u95f4 mmap \u8d1f\u8d23\u6620\u5c04\u6587\u4ef6\u903b\u8f91\u4e0a\u4e00\u6bb5\u8fde\u7eed\u7684\u6570\u636e\uff08\u7269\u7406\u4e0a\u53ef\u4ee5\u4e0d\u8fde\u7eed\u5b58\u50a8\uff09\u6620\u5c04\u4e3a\u8fde\u7eed\u5185\u5b58\uff0c\u800c\u8fd9\u91cc\u7684\u6587\u4ef6\u53ef\u4ee5\u662f\u78c1\u76d8\u6587\u4ef6\u3001\u9a71\u52a8\u5047\u9020\u51fa\u6765\u7684\u6587\u4ef6\u4ee5\u53ca\u8bbe\u5907 mmap \u7531OS\u8d1f\u8d23\u7ba1\u7406\uff0c\u5bf9\u540c\u4e00\u4e2a\u6587\u4ef6\u5730\u5740\u7684\u6620\u5c04\u5c06\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\uff0cOS\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168\u53ca\u7ebf\u7a0b\u53ef\u89c1\u6027 mmap \u7684\u8bbe\u8ba1\u5f88\u6709\u542f\u53d1\u6027\u3002\u57fa\u4e8e\u78c1\u76d8\u7684\u8bfb\u5199\u5355\u4f4d\u662f block(4KB)\uff0c\u800c\u57fa\u4e8e\u5185\u5b58\u7684\u8bfb\u5199\u5355\u5143\u662f \u5730\u5740 \u3002\u6362\u8a00\u4e4b\uff0cCPU\u8fdb\u884c\u4e00\u6b21\u78c1\u76d8\u8bfb\u5199\u64cd\u4f5c\u6d89\u53ca\u7684\u6570\u636e\u91cf\u81f3\u5c11\u662f4KB\u3002\u4f46\u662f\uff0c\u8fdb\u884c\u4e00\u6b21\u5185\u5b58\u64cd\u4f5c\u6d89\u53ca\u7684\u6570\u636e\u91cf\u662f\u57fa\u4e8e\u5730\u5740\u7684\uff0c\u4e5f\u5c31\u662f\u901a\u5e38\u7684 64bit \u3002 \u6a21\u578b \u5229\u7528 DMA \u6280\u672f\u6765\u53d6\u4ee3 CPU \u6765\u5728\u5185\u5b58\u4e0e\u5176\u4ed6\u7ec4\u4ef6\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u4f8b\u5982\u4ece\u78c1\u76d8\u5230\u5185\u5b58\uff0c\u4ece\u5185\u5b58\u5230\u7f51\u5361\uff1b \u7528\u6237\u7a7a\u95f4\u7684 mmap file \u4f7f\u7528\u865a\u62df\u5185\u5b58\uff0c\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5360\u636e\u7269\u7406\u5185\u5b58\uff0c\u53ea\u6709\u5728\u5185\u6838\u7a7a\u95f4\u7684 kernel buffer cache \u624d\u5360\u636e\u5b9e\u9645\u7684\u7269\u7406\u5185\u5b58\uff1b mmap() \u51fd\u6570\u9700\u8981\u914d\u5408 write() \u7cfb\u7edf\u8c03\u52a8\u8fdb\u884c\u914d\u5408\u64cd\u4f5c\uff0c\u8fd9\u4e0e sendfile() \u51fd\u6570\u6709\u6240\u4e0d\u540c\uff0c\u540e\u8005\u4e00\u6b21\u6027\u4ee3\u66ff\u4e86 read() \u4ee5\u53ca write() \uff1b\u56e0\u6b64 mmap \u4e5f\u81f3\u5c11 \u9700\u8981 4 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff1b mmap \u4ec5\u4ec5\u80fd\u591f\u907f\u514d\u5185\u6838\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u7684\u5168\u7a0b CPU \u8d1f\u8d23\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u4f46\u662f \u5185\u6838\u7a7a\u95f4\u5185\u90e8 \u8fd8\u662f\u9700\u8981\u5168\u7a0b CPU \u8d1f\u8d23\u7684\u6570\u636e\u62f7\u8d1d \u6d41\u7a0b \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 mmap() \uff0c\u4ece\u7528\u6237\u6001\u9677\u5165\u5185\u6838\u6001\uff0c\u5c06\u5185\u6838\u7f13\u51b2\u533a\u6620\u5c04\u5230\u7528\u6237\u7f13\u5b58\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u786c\u76d8\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff08 \u53ef\u89c1\u5176\u4f7f\u7528\u4e86 Page Cache \u673a\u5236 \uff09\uff1b mmap() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\uff1b \u7528\u6237\u8fdb\u7a0b\u8c03\u7528 write() \uff0c\u5c1d\u8bd5\u628a\u6587\u4ef6\u6570\u636e\u5199\u5230\u5185\u6838\u91cc\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff0c\u518d\u6b21\u9677\u5165\u5185\u6838\u6001\uff1b CPU \u5c06\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7684\u5957\u63a5\u5b57\u7f13\u51b2\u533a\uff1b DMA \u63a7\u5236\u5668\u5c06\u6570\u636e\u4ece\u5957\u63a5\u5b57\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7f51\u5361\u5b8c\u6210\u6570\u636e\u4f20\u8f93\uff1b write() \u8fd4\u56de\uff0c\u4e0a\u4e0b\u6587\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\u3002 \u4f18\u52bf \u7b80\u5316\u7528\u6237\u8fdb\u7a0b\u7f16\u7a0b \u57fa\u4e8e\u7f3a\u9875\u5f02\u5e38\u7684\u61d2\u52a0\u8f7d \u6570\u636e\u4e00\u81f4\u6027\u7531OS\u786e\u4fdd \u8bfb\u5199\u6548\u7387\u63d0\u9ad8\uff1a\u907f\u514d\u5185\u6838\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u7684\u6570\u636e\u62f7\u8d1d \u907f\u514d\u53ea\u8bfb\u64cd\u4f5c\u65f6\u7684swap\u64cd\u4f5c \u8282\u7ea6\u5185\u5b58 \u7528\u6237\u7a7a\u95f4\u4e0e\u5185\u6838\u7a7a\u95f4\u5b9e\u9645\u4e0a\u516c\u7528\u540c\u4e00\u4efd\u6570\u636e \u9002\u7528\u573a\u666f\uff0c\u975e\u5e38\u53d7\u9650 \u591a\u4e2a\u7ebf\u7a0b\u4ee5 \u53ea\u8bfb\u7684\u65b9\u5f0f \u540c\u65f6\u8bbf\u95ee\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u662f\u56e0\u4e3a mmap \u673a\u5236\u4e0b\u591a\u7ebf\u7a0b\u5171\u4eab\u4e86\u540c\u4e00\u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u6b64\u8282\u7ea6\u4e86\u5185\u5b58\uff1b mmap \u975e\u5e38\u9002\u5408\u7528\u4e8e \u8fdb\u7a0b\u95f4\u901a\u4fe1 \uff0c\u8fd9\u662f\u56e0\u4e3a\u5bf9\u540c\u4e00\u6587\u4ef6\u5bf9\u5e94\u7684 mmap \u5206\u914d\u7684\u7269\u7406\u5185\u5b58\u5929\u7136\u591a\u7ebf\u7a0b\u5171\u4eab\uff0c\u5e76\u53ef\u4ee5\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u540c\u6b65\u539f\u8bed\uff1b mmap \u867d\u7136\u6bd4 sendfile \u7b49\u673a\u5236\u591a\u4e86\u4e00\u6b21 CPU \u5168\u7a0b\u53c2\u4e0e\u7684\u5185\u5b58\u62f7\u8d1d\uff0c\u4f46\u662f\u7528\u6237\u7a7a\u95f4\u4e0e\u5185\u6838\u7a7a\u95f4\u5e76\u4e0d\u9700\u8981\u6570\u636e\u62f7\u8d1d\uff0c\u56e0\u6b64\u5728\u6b63\u786e\u4f7f\u7528\u60c5\u51b5\u4e0b\u5e76\u4e0d\u6bd4 sendfile \u6548\u7387\u5dee\uff1b \u4e0d\u9002\u5408\u7684\u573a\u666f \u7531\u4e8e mmap \u4f7f\u7528\u65f6 \u5fc5\u987b\u5b9e\u73b0\u6307\u5b9a\u597d \u5185\u5b58\u6620\u5c04\u7684\u5927\u5c0f\uff0c\u56e0\u6b64 mmap \u5e76\u4e0d\u9002\u5408\u53d8\u957f\u6587\u4ef6\uff1b \u5982\u679c \u66f4\u65b0\u9891\u7e41 \uff0cmmap \u907f\u514d\u4e24\u6001\u62f7\u8d1d\u7684\u4f18\u52bf\u5c31\u88ab\u644a\u8fd8\uff0c\u6700\u7ec8\u8fd8\u662f\u843d\u5728\u4e86\u5927\u91cf\u7684\u810f\u9875\u56de\u5199\u53ca\u7531\u6b64\u5f15\u53d1\u7684\u968f\u673a I/O \u4e0a\uff0c\u6240\u4ee5\u5728\u968f\u673a\u5199\u5f88\u591a\u7684\u60c5\u51b5\u4e0b\uff0cmmap \u65b9\u5f0f\u5728\u6548\u7387\u4e0a\u4e0d\u4e00\u5b9a\u4f1a\u6bd4\u5e26\u7f13\u51b2\u533a\u7684\u4e00\u822c\u5199\u5feb\uff1b \u8bfb/\u5199 \u5c0f\u6587\u4ef6 \uff08\u4f8b\u5982 16K \u4ee5\u4e0b\u7684\u6587\u4ef6\uff09\uff0cmmap \u4e0e\u901a\u8fc7 read \u7cfb\u7edf\u8c03\u7528\u76f8\u6bd4\u6709\u7740\u66f4\u9ad8\u7684\u5f00\u9500\u4e0e\u5ef6\u8fdf\uff1b\u540c\u65f6 mmap \u7684 \u5237\u76d8\u7531\u7cfb\u7edf\u5168\u6743\u63a7\u5236 \uff0c\u4f46\u662f\u5728\u5c0f\u6570\u636e\u91cf\u7684\u60c5\u51b5\u4e0b\u7531\u5e94\u7528\u672c\u8eab\u624b\u52a8\u63a7\u5236\u66f4\u597d\uff1b mmap \u53d7\u9650\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u5927\u5c0f\uff1a\u4f8b\u5982\u5728 32-bits \u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u865a\u62df\u5185\u5b58\u603b\u5927\u5c0f\u4e5f\u5c31 2GB\uff0c\u4f46\u7531\u4e8e mmap \u5fc5\u987b\u8981\u5728\u5185\u5b58\u4e2d\u627e\u5230\u4e00\u5757\u8fde\u7eed\u7684\u5730\u5740\u5757\uff0c\u6b64\u65f6\u4f60\u5c31\u65e0\u6cd5\u5bf9 4GB \u5927\u5c0f\u7684\u6587\u4ef6\u5b8c\u5168\u8fdb\u884c mmap\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4f60\u5fc5\u987b\u5206\u591a\u5757\u5206\u522b\u8fdb\u884c mmap\uff0c\u4f46\u662f\u6b64\u65f6\u5730\u5740\u5185\u5b58\u5730\u5740\u5df2\u7ecf\u4e0d\u518d\u8fde\u7eed\uff0c\u4f7f\u7528 mmap \u7684\u610f\u4e49\u5927\u6253\u6298\u6263\uff0c\u800c\u4e14\u5f15\u5165\u4e86\u989d\u5916\u7684\u590d\u6742\u6027\uff1b \u53c2\u8003 \u8ba4\u771f\u5206\u6790mmap: \u662f\u4ec0\u4e48 \u4e3a\u4ec0\u4e48 \u600e\u4e48\u7528 Linux\u4e2d mmap() \u51fd\u6570\u7684\u5185\u5b58\u6620\u5c04\u95ee\u9898\u7406\u89e3\uff1f When should I use mmap for file access Linux IO\u539f\u7406\u548cZero-copy\u6280\u672f\u5168\u9762\u63ed\u79d8","title":"Operating System --- linux\u7684\u6587\u4ef6I/O\u7cfb\u7edf"},{"location":"Operating%20System/#go-io_1","text":"\u5b83\u7684 io \u548c bufio \u662f\u8fdb\u7a0b\u4e2d\uff08\u4e5f\u53ef\u4ee5\u8bf4\u662f \u7528\u6237\u6001 \uff09\u7684\u7f13\u51b2\u3002","title":"Go \u7684IO"},{"location":"Operating%20System/#go-io_2","text":"Go \u662f\u4e00\u79cd\u9ad8\u6027\u80fd\u7684\u7f16\u8bd1\u578b\u8bed\u8a00\uff0c\u5929\u7136\u652f\u6301\u9ad8\u5e76\u53d1\uff0c\u7528\u6237\u7ea7\u522b\u5c01\u88c5\u534f\u7a0b\uff0c\u53f7\u79f0\u652f\u6301\u767e\u4e07\u7684\u534f\u7a0b\u5e76\u53d1\uff0c\u8fd9\u4e2a\u91cf\u7ea7\u4e0d\u662f\u7ebf\u7a0b\u53ef\u6bd4\u7684\u3002 \u90a3Go\u652f\u6301\u5982\u6b64\u9ad8\u5e76\u53d1\u7684\u79d8\u8bc0\u5728\u4e8e\uff1f \u6267\u884c\u4f53\u8c03\u5ea6\u5f97\u5f53 \u3002CPU\u4e0d\u505c\u7684\u5728\u4e0d\u540c\u6267\u884c\u4f53\uff08goroutine\uff09\u4e4b\u95f4\u53cd\u590d\u6a2a\u8df3\u3002CPU\u4e00\u76f4\u5728\u88c5\u586b\u548c\u8fd0\u884c\u4e0d\u540c\u6267\u884c\u4f53\u7684\u6307\u4ee4\uff0cG1 \u4e0d\u884c\u5c31\u641eG2\uff0c\u4e00\u523b\u90fd\u4e0d\u80fd\u505c\uff0c\u8fd9\u6837\u624d\u80fd\u4f7f\u5f97\u5927\u91cf\u7684\u6267\u884c\u4f53\u9f50\u5934\u5e76\u8fdb\uff0c\u7cfb\u7edf\u624d\u80fd\u5b8c\u6210\u5982\u6b64\u9ad8\u5e76\u53d1\u7684\u541e\u5410\u3002 \u90a3Go\u9002\u5408CPU\u5bc6\u96c6\u578b\u7684\u7a0b\u5e8f\uff0c\u8fd8\u662fIO\u5bc6\u96c6\u578b\u7684\u7a0b\u5e8f\u5462\uff1f IO\u5bc6\u96c6\u578b\u3002 \u9996\u5148\uff0c\u53cd\u63a8\u903b\u8f91\uff0cCPU\u5bc6\u96c6\u578b\u5c31\u610f\u5473\u7740\u6bcf\u4e2a\u6267\u884c\u4f53\u90fd\u662f\u6025\u9700CPU\u7684\uff0cG1\u90fd\u5403\u4e0d\u9971\uff0c\u5207\u5230G2\u53bb\u5e72\u561b\uff0c\u6240\u4ee5CPU\u5bc6\u96c6\u578b\u7684\u7a0b\u5e8f\u6700\u597d\u7684\u60c5\u51b5\u5c31\u662f\u4e0d\u8c03\u5ea6\uff0c\u7ed1\u6838\u90fd\u6765\u4e0d\u53ca\u5462\u3002\u60f3\u8981\u63d0\u9ad8\u8fd9\u79cd\u7a0b\u5e8f\u7684\u6027\u80fd\uff0c\u5c31\u662f\u52a0\u94b1\uff0c\u4e70\u6838\u3002 IO\u8bbe\u5907\u548cCPU\u662f\u4e0d\u540c\u7684\u72ec\u7acb\u8bbe\u5907\u3002\u8fd9\u4e24\u8005\u4e4b\u95f4\u7684\u5904\u7406\u53ef\u4ee5\u662f\u5e76\u884c\u8fd0\u884c\u7684\u3002Go\u7a0b\u5e8f\u7684\u534f\u7a0b\u8c03\u5ea6\u53ef\u4ee5\u5f88\u597d\u7684\u5229\u7528\u8fd9\u4e2a\u5173\u7cfb\u3002\u8ba9CPU\u6267\u884c\u7a0b\u5e8f\u6307\u4ee4\uff0c\u53ea\u8d1f\u8d23\u53d1\u9001IO\uff0c\u4e00\u65e6IO\u88ab\u8bbe\u5907\u63a5\u6536\uff0cCPU\u4e0d\u7b49\u5f85\u5b8c\u6210\uff0c\u5c31\u53ef\u4ee5\u5904\u7406\u5176\u4ed6\u7684\u6307\u4ee4\uff0cIO\u7684\u5b8c\u6210\u4ee5\u5f02\u6b65\u4e8b\u4ef6\u7684\u5f62\u5f0f\u89e6\u53d1\u3002\u8fd9\u6837\uff0cIO\u8bbe\u5907\u7684\u5904\u7406\u8fc7\u7a0b\u548cCPU\u7684\u6267\u884c\u5c31\u5e76\u884c\u8d77\u6765\u4e86\u3002 \u4efb\u4f55IO\u90fd\u9002\u914dGo\u4e48\uff1f Go \u8bed\u8a00\u7ea7\u522b\u628a \u7f51\u7edcIO\u505a\u4e86\u5f02\u6b65\u5316 \uff0c\u4f46\u662f\u6587\u4ef6IO\u8fd8\u662f\u540c\u6b65\u7684\u8c03\u7528 \u7f51\u7edcfd\u53ef\u4ee5\u7528epoll\u6c60\u6765\u7ba1\u7406\u4e8b\u4ef6\uff0c\u5b9e\u73b0\u5f02\u6b65IO \u6587\u4ef6fd\u4e0d\u80fd\u7528epoll\u6c60\u6765\u7ba1\u7406\u4e8b\u4ef6\uff0c\u53ea\u80fd\u540c\u6b65IO \u6587\u4ef6\u60f3\u8981\u5b9e\u73b0\u5f02\u6b65IO\uff0c\u5f53\u524dLinux\u4e0b\u6709\u79cd\u65b9\u5f0f\uff1a AIO: \u4f46Go\u6ca1\u6709\u5c01\u88c5\u5b9e\u73b0 io_uring: \u5185\u6838\u7248\u672c\u8981\u6c42\u9ad8","title":"Go \u548c IO\u7684\u4e0d\u89e3\u4e4b\u7f18"},{"location":"Operating%20System/#goio","text":"IO\u63a5\u53e3\u63cf\u8ff0 io/io.go \u4e0d\u6d89\u53ca\u5177\u4f53\u7684IO\u5b9e\u73b0\uff0c\u53ea\u6709 \u8bed\u4e49\u63a5\u53e3 ```go type Reader interface { Read(p []byte) (n int, err error) } type Writer interface { Write(p []byte) (n int, err error) } ``` \u6309\u7167\u63a5\u53e3\u7684\u5b9a\u4e49\u7ef4\u5ea6\uff0c\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a3\u5927\u7c7b\uff1a \u57fa\u7840\u7c7b\u578b Reader\u3001Writer\u3001Closer\u3002\u3002\u3002\u7b49\uff0c\u63cf\u8ff0\u4e86\u6700\u539f\u59cb\u7684Go\u7684IO\u7684\u6837\u5b50\u3002\u5982\u679c\u4f60\u5199\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u8981\u5b9e\u73b0\u8fd9\u4e9b\u63a5\u53e3\uff0c\u5343\u4e07\u8981\u628a\u6807\u51c6\u5e93\u91cc\u7684\u6ce8\u91ca\u8bfb\u4e09\u904d\u3002 \u7ec4\u5408\u7c7b\u578b \u5f80\u5f80\u628a\u6700\u57fa\u672c\u7684\u63a5\u53e3\u7ec4\u5408\u8d77\u6765\uff0c\u4f7f\u7528Go\u7684embeding\u8bed\u6cd5\u7cd6\uff0c\u6bd4\u5982\uff1aReaderCloser\u3001WriteCloser\u7b49 \u8fdb\u9636\u7c7b\u578b \u57fa\u4e8e\u57fa\u7840\u63a5\u53e3\uff0c\u52a0\u4e0a\u4e00\u4e9b\u6709\u8da3\u7684\u5b9e\u73b0\u3002\u6bd4\u5982\uff1aTeeReader\u3001LimitReader\u3001MultiReader IO \u901a\u7528\u51fd\u6570 io\u5e93\u8fd8\u6709\u4e00\u4e9b\u57fa\u4e8e\u4ee5\u4e0a\u63a5\u53e3\u7684\u51fd\u6570\uff0c Copy CopyN CopyBuffer io/ioutil \u987e\u540d\u601d\u4e49\uff0c\u8fd9\u662f\u4e00\u4e2a\u5de5\u5177\u7c7b\u578b\u7684\u5e93\uff0cutil\u561b \u5565\u90fd\u8981\u6709\uff0c\u76f8\u5f53\u4e8e\u5e73\u65f6\u7684\u5feb\u6377\u952e\u3002 \u8fd9\u5c31\u662f\u4e2a\u5de5\u5177\u5e93\uff0c\u5e94\u4ed8\u4e00\u4e9b\u7b80\u5355\u7684\u573a\u666f\uff1a ReadFile\u3001WriteFile\u3001ReadDir...","title":"Go\u7684IO\u957f\u4ec0\u4e48\u6837\u5b50"},{"location":"Operating%20System/#io","text":"\u54c8\u54c8\uff0c\u8fd9\u4f4d\u535a\u4e3b\u7684\u7406\u89e3\u5f88\u7279\u522b\uff0cGo \u6807\u51c6io\u5e93\u5b9a\u4e49\u4e86\u57fa\u7840\u7684\u8bed\u4e49\u63a5\u53e3\uff0c\u90a3\u5177\u4f53\u5b9e\u73b0\u5462\uff1f \u5b57\u8282\u6570\u7ec4\u53ef\u4ee5\u662f Reader / Writer \uff1f \u5185\u5b58\u7ed3\u6784\u4f53\u53ef\u4ee5\u662f Reader \u5417\uff1f \u6587\u4ef6\u53ef\u4ee5\u662f Reader / Writer \u5417\uff1f \u5b57\u7b26\u4e32\u53ef\u4ee5\u662f Reader \uff1f IO \u80fd\u805a\u5408\u6765\u63d0\u9ad8\u6548\u7387\u5417\uff1f \u90fd\u53ef\u4ee5 \uff01Go\u5e2e\u6211\u4eec\u505a\u597d\u4e86\u4e00\u5207\uff01 io\u5e93\u7684\u62d3\u6251 IO\u884c\u4e3a\u90fd\u662f\u4ee5io\u5e93\u4e3a\u4e2d\u5fc3\u53d1\u6563\u7684\u3002 io \u548c \u5b57\u8282\u7684\u6545\u4e8b\uff1a bytes \u5e93 \u4e00\u53e5\u8bdd\uff0c\u5185\u5b58\u5757\u53ef\u4ee5\u4f5c\u4e3a\u8bfb\u5199\u7684\u6570\u636e\u6d41\u3002 bytes.Reader \u53ef\u4ee5\u628a[]byte\u8f6c\u6362\u6210Reader bytes.Buffer\u53ef\u4ee5\u628a[]byte\u8f6c\u6362\u6210Reader\u3001Writer go buffer := make([]byte, 1024) readerFromBytes := bytes.NewReader(buffer) n, err := io.Copy(ioutil.Discard, readerFromBytes) // n == 1024, err == nil fmt.Printf(\"n=%v,err=%v\\n\",n, err) io\u548c\u5b57\u7b26\u4e32\u7684\u6545\u4e8b\uff1astrings\u5e93 strings.Reader\u80fd\u591f\u628a\u5b57\u7b26\u4e32\u8f6c\u6362\u6210Reader, \u8fd9\u4e2a\u4e5f\u7279\u522b\u6709\u610f\u601d\uff0c\u76f4\u63a5\u80fd\u628a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u8bfb\u6e90\u3002 go data := \"hello world\" readerFromBytes := strings.NewReader(data) n, err := io.Copy(ioutil.Discard, readerFromBytes) fmt.Printf(\"n=%v,err=%v\\n\",n, err) io\u548c\u7f51\u7edc\u7684\u6545\u4e8b\uff1anet\u5e93 \u7f51\u7edc\u53ef\u4ee5\u4f5c\u4e3a\u8bfb\u5199\u6e90\uff0c\u62bd\u8c61\u6210Reader\u3001Writer\u7684\u5f62\u5f0f\u3002 \u670d\u52a1\u7aef\uff1a ```go func handleConn(conn net.Conn) { defer conn.Close() buf := make([]byte, 4096) conn.Read(buf) conn.Write([]byte(\"pong: \")) conn.Write(buf) } func main() { server, err := net.Listen(\"tcp\", \":9999\") if err != nil { log.Fatalf(\"err:%v\", err) } for { c, err := server.Accept() if err != nil { log.Fatalf(\"err:%v\", err) } go handleConn(c) } } ``` \u8bf4\u660e\uff1a net.Listen \u521b\u5efa\u4e00\u4e2a\u76d1\u542c\u5957\u63a5\u5b57\uff0c\u5728Go\u91cc\u9762\u5c01\u88c5\u6210\u4e86 net.Listener \u7c7b\u578b Accept \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a net.Conn\uff0c\u4ee3\u8868\u4e00\u6761\u7f51\u7edc\u8fde\u63a5\uff0cnet.Conn \u5373\u662fReader\uff0c\u53c8\u662fWriter\uff0c\u5230\u4e86\u4e4b\u540e\u5404\u81ea\u5904\u7406\u5373\u53ef \u5ba2\u6237\u7aef\uff1a go func main() { conn, err := net.Dial(\"tcp\", \":9999\") if err != nil { panic(err) } conn.Write([]byte(\"hello world\\n\")) io.Copy(os.Stdout, conn) } \u8bf4\u660e\uff1a net.Dail \u4f20\u5165\u670d\u52a1\u5668\u7aef\u5730\u5740\u548c\u7f51\u7edc\u534f\u8bae\u7c7b\u578b\uff0c\u5373\u53ef\u8fd4\u56de\u4e00\u6761\u548c\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u8fd4\u56de\u7684\u7ed3\u6784\u4e3a net.Conn net.Conn\u65e2\u53ef\u4f5c\u4e3a\u8bfb\u7aef\uff0c\u4e5f\u53ef\u4e3a\u5199\u7aef \u4ee5\u4e0a\u65e0\u8bba\u662fnet.Listener\uff0c\u8fd8\u662fnet.Conn \u90fd\u662f\u57fa\u4e8e\u7cfb\u7edf\u8c03\u7528 socket \u4e4b\u4e0a\u7684\u4e00\u5c42\u5c01\u88c5\u3002\u5e95\u5c42\u4f7f\u7528\u7684\u662f\u7c7b\u4f3c\u7684\u7cfb\u7edf\u8c03\u7528\uff1a syscall.Socket syscall.Connect syscall.Listen syscall.GetsocketInt Go \u9488\u5bf9\u7f51\u7edcfd\u90fd\u4f1a\u505a\u54ea\u4e9b\u5c01\u88c5\u5462\uff1f \u521b\u5efa\u8fd8\u662f\u7528 socket \u8c03\u7528\u521b\u5efa\u7684 fd\uff0c\u521b\u5efa\u51fa\u6765\u5c31\u4f1a\u7acb\u9a6c\u8bbe\u7f6e\u4e3a nonblock \u6a21\u5f0f\uff0cGo\u7684\u7f51\u7edcfd\u5929\u7136\u8981\u4f7f\u7528IO\u591a\u8def\u590d\u7528\u7684\u65b9\u5f0f\u6765\u8d70IO \u628a socket fd \u4e22\u5230 epoll \u6c60\u91cc\uff08\u901a\u8fc7poll.runtime_pollOpen \u628a socket \u5957\u63a5\u5b57\u52a0\u5230epoll\u6c60\u91cc\uff0c\u5e95\u5c42\u8c03\u7528\u7684\u8fd8\u662fepollctl\uff09\uff0c\u76d1\u542c\u4e8b\u4ef6 \u5c01\u88c5\u597d\u8bfb\u5199\u4e8b\u4ef6\u5230\u6765\u7684\u51fd\u6570\u56de\u8c03 io\u548c\u6587\u4ef6\u7684\u6545\u4e8b\uff1a os\u5e93 \u6587\u4ef6IO\uff0c\u8fd9\u4e2a\u662f\u6211\u4eec\u6700\u5e38\u89c1\u7684IO\uff0c\u6587\u4ef6\u53ef\u4ee5\u4f5c\u4e3a\u8bfb\u7aef\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5199\u7aef\u3002 // \u5982\u4e0b\uff0c\u628a test.data \u7684\u6570\u636e\u8bfb\u51fa\u6765\u4e22\u5230\u5783\u573e\u6876 fd, err := os.OpenFile(\"test.data\", os.O_RDWR, 0) if err != nil { panic(err) } io.Copy(ioutil.Discard, fd) \u8fd9\u91cc\u8fd4\u56de\u4e86\u4e00\u4e2aFile\u7c7b\u578b\uff0c\u4e0d\u96be\u60f3\u8c61\u8fd9\u4e2a\u662f\u57fa\u4e8e\u6587\u4ef6fd\u7684\u4e00\u5c42\u5c01\u88c5\u3002\u8fd9\u91cc\u9762\u505a\u4e86\u4ec0\u4e48\u5462\uff1f \u8c03\u7528\u7cfb\u7edf\u8c03\u7528 syscall.Open \u62ff\u5230\u6587\u4ef6\u7684fd\uff0c\u987a\u4fbf\u8bbe\u7f6e\u4e86\u5783\u573e\u56de\u6536\u65f6\u5019\u7684\u6790\u6784\u51fd\u6570 stdin\u3001stdout\u3001stderr Go\u628a\u8fd9\u4e09\u4e2a\u4e5f\u90fd\u62bd\u8c61\u6210\u4e86\u8bfb\u5199\u6e90\uff0c\u8fd9\u4e09\u4e2a\u7c7b\u578b\u7684\u53d8\u91cf\u5176\u5b9e\u5c31\u662fFile\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u5b9a\u4e49\u5728\u6e90\u7801 src/os/file.go\u4e2d ```go var ( Stdin = NewFile(uintptr(syscall.Stdin), \"/dev/stdin\") Stdout = NewFile(uintptr(syscall.Stdout), \"/dev/stdout\") Stderr = NewFile(uintptr(syscall.Stderr), \"/dev/stderr\") ) ``` \u6807\u51c6\u8f93\u5165\u5c31\u53ef\u4ee5\u548c\u65b9\u4fbf\u7684\u4f5c\u4e3a\u8bfb\u7aef\uff08 Reader \uff09\uff0c\u6807\u51c6\u8f93\u51fa\u53ef\u4ee5\u4f5c\u4e3a\u5199\u7aef\uff08 Writer \uff09 eg\uff1a \u7528\u4e00\u884c\u4ee3\u7801\u5b9e\u73b0\u4e00\u4e2a\u6700\u7b80\u5355\u7684 echo \u56de\u663e\u7684\u7a0b\u5e8f go func main() { // \u4e00\u884c\u4ee3\u7801\u5b9e\u73b0\u56de\u663e io.Copy(os.Stdout, os.Stdin) } \u7f13\u5b58io\u7684\u6545\u4e8b\uff1a bufio\u5e93 Reader/Writer \u53ef\u4ee5\u662f\u7f13\u51b2 IO \u7684\u6570\u636e\u6d41 Go\u7f13\u51b2IO\u662f\u5728 \u5e95\u5c42IO \u4e4b\u4e0a\u7684\u4e00\u5c42buffer \u5f62\u8c61\u63cf\u8ff0\u7684\u8bdd\uff0c\u53ef\u4ee5\u8bf4\u662f \u7528\u6237\u5185\u5b58\u7a7a\u95f4\u7684page cache \u5728 c \u8bed\u8a00\uff0c\u6709\u4eba\u80af\u5b9a\u7528\u8fc7 fopen \u6253\u5f00\u7684\u6587\u4ef6\uff08\u6240\u8c13\u7684\u6807\u51c6IO\uff09\uff1a C FILE * fopen ( const char * filename, const char * mode ); C \u8bed\u8a00\u7684\u7f13\u51b2IO\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a \u5168\u7f13\u51b2\uff1a \u53ea\u6709\u586b\u6ee1 buffer\uff0c\u624d\u4f1a\u771f\u6b63\u7684\u8c03\u7528\u5e95\u5c42IO \u884c\u7f13\u51b2\uff1a\u4e0d\u7528\u7b49\u586b\u6ee1buffer\uff0c\u9047\u5230\u6362\u884c\u7b26\uff0c\u5c31\u4f1a\u628aIO\u4e0b\u53d1\u4e0b\u53bb \u4e0d\u7f13\u51b2\uff1a bypass\u7684\u6a21\u5f0f\uff0c\u6bcf\u6b21\u90fd\u662f\u76f4\u63a5\u6389\u5e95\u5c42IO \u56db\u79cd\u65b9\u5f0f\uff0c\u5c06\u6570\u636e\u5199\u5165\u6587\u4ef6 os\u5305 f.Write([]byte) go var f *os.File var wireteString = \"\u4f60\u597d,tcy\" var d1 = []byte(wireteString) f, err3 := os.Create(\"./output.txt\") //\u521b\u5efa\u6587\u4ef6 n2, err3 := f.Write(d1) //\u5199\u5165\u6587\u4ef6(\u5b57\u8282\u6570\u7ec4) os\u65b9\u5f0f io\u5305\u7684io.WriteString(f, wireteString) go var wireteString = \"\u4f60\u597d,tcy\" n, err1 := io.WriteString(f, wireteString) //\u5199\u5165\u6587\u4ef6(\u5b57\u7b26\u4e32),io\u65b9\u5f0f,n\u4e3a\u51e0\u4e2a\u5b57\u8282 f.Sync() //Sync\u9012\u4ea4\u6587\u4ef6\u7684\u5f53\u524d\u5185\u5bb9\u8fdb\u884c\u7a33\u5b9a\u7684\u5b58\u50a8\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u8868\u793a\u5c06\u6587\u4ef6\u7cfb\u7edf\u7684\u6700\u8fd1\u5199\u5165\u7684\u6570\u636e\u5728\u5185\u5b58\u4e2d\u7684\u62f7\u8d1d\u5237\u65b0\u5230\u786c\u76d8\u4e2d\u7a33\u5b9a\u4fdd\u5b58 ioutil\u5305\u7684ioutil.WriteFile ```go var st = []byte(wireteString) err2 := ioutil.WriteFile(\"./output.txt\", st, 0666) //\u5199\u5165\u6587\u4ef6(\u5b57\u8282\u6570\u7ec4),\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u5c06\u6309\u7ed9\u51fa\u7684\u6743\u9650\u521b\u5efa\u6587\u4ef6\uff0c\u5426\u5219\u5728\u5199\u5165\u6570\u636e\u4e4b\u524d\u6e05\u7a7a\u6587\u4ef6\u3002 ``` bufio\u5305\u4e2d\u7684bufio.NewWriter(f) var f *os.File w := bufio.NewWriter(f) //\u521b\u5efa\u65b0\u7684 Writer \u5bf9\u8c61,NewReader\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u9ed8\u8ba4\u5927\u5c0f\u7f13\u51b2\u3001\u4ecer\u8bfb\u53d6\u7684*Reader n4, err3 := w.WriteString(\"\u4f60\u597d,tcy\") fmt.Printf(\"\u5199\u5165 %d \u4e2a\u5b57\u8282n\", n4) w.Flush() //Flush\u65b9\u6cd5\u5c06\u7f13\u51b2\u4e2d\u7684\u6570\u636e\u5199\u5165\u4e0b\u5c42\u7684io.Writer\u63a5\u53e3\u3002 f.Close() https://zhuanlan.zhihu.com/p/35277219","title":"IO \u7684\u59ff\u52bf\u591a\u79cd\u591a\u6837"},{"location":"about/","text":"hello world \u65b0\u5e74\u5feb\u4e50\uff0c\u5566\u5566\u5566\uff01","title":"about"},{"location":"about/#hello-world","text":"","title":"hello world"},{"location":"about/#_1","text":"","title":"\u65b0\u5e74\u5feb\u4e50\uff0c\u5566\u5566\u5566\uff01"},{"location":"docker/","text":"\u4e00\u3001docker\u5165\u95e8 1\u3001docker\u7684\u5b89\u88c5\u53ca\u5165\u95e8\u793a\u4f8b \u73af\u5883\u51c6\u5907\uff1adocker\u9700\u8981\u5b89\u88c5\u5728centos7 64\u4f4d\u7cfb\u7edf\u4e0a\uff1bdocker\u8981\u6c42\u7cfb\u7edf\u5185\u6838\u57283.10\u4ee5\u4e0a \u67e5\u770b\u7cfb\u7edf\u5185\u6838\uff1a shell uname -r \u5b89\u88c5\u547d\u4ee4\uff1a shell yum -y install docker-io \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u542f\u52a8\u547d\u4ee4 sh service docker start \u5b89\u88c5nginx\u4f53\u9a8c sh docker run -p 80:80 -d nginx 2\u3001docker\u7684\u7406\u8bba\u6982\u5ff5 \u4ec0\u4e48\u662fdocker: \u9cb8\u9c7c\u901a\u8fc7\u8eab\u4e0a\u7684\u96c6\u88c5\u7bb1\uff08Container\uff09\u6765\u5c06\u4e0d\u540c\u79cd\u7c7b\u7684\u8d27\u7269\u8fdb\u884c\u9694\u79bb\uff1b\u800c\u4e0d\u662f\u901a\u8fc7\u751f\u51fa\u5f88\u591a\u5c0f\u9cb8\u9c7c\uff08Guest OS\uff09\u6765\u627f\u8fd0\u4e0d\u540c\u79cd\u7c7b\u7684\u8d27\u7269\u3002Docker\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5e94\u7528\u5bb9\u5668\u5f15\u64ce\uff0c\u57fa\u4e8eGo\u8bed\u8a00 \u5e76\u9075\u5faaApache2.0\u534f\u8bae\u5f00\u6e90\u3002Docker\u53ef\u4ee5\u8ba9\u5f00\u53d1\u8005\u6253\u5305\u4ed6\u4eec\u7684\u5e94\u7528\u4ee5\u53ca\u4f9d\u8d56\u5305\u5230\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u3001\u53ef\u79fb\u690d\u7684\u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u53d1\u5e03\u5230\u4efb\u4f55\u6d41\u884c\u7684Linux\u673a\u5668\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u865a\u62df\u5316\u3002\u5bb9\u5668\u65f6\u5b8c\u5168\u4f7f\u7528\u4f7f\u7528\u6c99\u7bb1\u673a\u5236\uff0c\u76f8\u4e92\u4e4b\u95f4\u4e0d\u4f1a\u6709\u4efb\u4f55\u63a5\u53e3\uff08\u7c7b\u4f3ciPhone\u7684app\uff09\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5bb9\u5668\u6027\u80fd\u5f00\u9500\u6781\u4f4e\u3002 \u7269\u7406\u673a\u3001\u865a\u62df\u673a\u3001docker\u7684\u5f62\u8c61\u5bf9\u6bd4 \u8fd9\u662f\u7269\u7406\u673a\uff1a\u4e00\u680b\u697c\u4e00\u6237\u4eba\u5bb6\u3001\u72ec\u7acb\u57fa\u5730\u3001\u72ec\u7acb\u82b1\u56ed\u3002 \u8fd9\u662f\u865a\u62df\u673a\uff1a\u4e00\u680b\u697c\u5305\u542b\u591a\u5957\u623f\u5b50\uff0c\u4e00\u5957\u623f\u4e00\u6237\u4eba\u5bb6\uff0c\u5171\u4eab\u57fa\u5730\u3001\u5171\u4eab\u82b1\u56ed\uff0c\u72ec\u7acb\u536b\u751f\u95f4\u3001\u53a8\u623f\u3001\u5e26\u5bbd \u8fd9\u662fdokcer\u5bb9\u5668\uff1a\u4e00\u5957\u623f\u9694\u79bb\u6210\u591a\u4e2a\u5c0f\u7a7a\u95f4\u4fd7\u79f0\u80f6\u56ca\u516c\u5bd3\uff0c\u6bcf\u4e2a\u8f83\u5b6c\u4f4f\u4e00\u4e2a\u79df\u5ba2\uff0c\u5171\u4eab\u5730\u57fa\u3001\u82b1\u56ed\u3001\u536b\u751f\u95f4\u3001\u53a8\u623f\u3001\u5e26\u5bbd\u7b49 docker\u548c\u865a\u62df\u673a\u7684\u5bf9\u6bd4 docker \u865a\u62df\u673a \u8fd0\u884c\u73af\u5883 docker\u6784\u5efa\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u6240\u4ee5docker\u751a\u81f3\u53ef\u4ee5\u5728\u865a\u62df\u673a\u4e0a\u8fd0\u884c \u865a\u62df\u5316\u6280\u672f\u4f9d\u8d56\u7269\u7406CPU\u548c\u5185\u5b58\uff0c\u662f\u786c\u4ef6\u7ea7\u522b\u7684 \u9694\u79bb\u6027 docker\u5c5e\u4e8e\u8fdb\u7a0b\u4e4b\u95f4\u7684\u9694\u79bb \u865a\u62df\u673a\u53ef\u4ee5\u5b9e\u73b0\u7cfb\u7edf\u7ea7\u522b\u9694\u79bb \u5b89\u5168\u6027 Docker\u7684\u79df\u6237root\u548c\u5bbf\u4e3b\u673aroot\u7b49\u540c\uff0c\u4e00\u65e6\u5bb9\u5668\u5185\u7684\u7528\u6237\u4ece\u666e\u901a\u7528\u6237\u6743\u9650\u63d0\u5347\u4e3aroot\u6743\u9650\uff0c\u4ed6\u5c31\u76f4\u63a5\u5177\u5907\u4e86\u5bbf\u4e3b\u673a\u7684root\u6743\u9650\uff0c\u8fdb\u800c\u53ef\u8fdb\u884c\u65e0\u9650\u5236\u7684\u64cd\u4f5c\u3002\u6545\uff1adocker\u7684\u5b89\u5168\u6027\u4e5f\u66f4\u5f31 \u865a\u62df\u673a\u79df\u6237root\u6743\u9650\u548c\u5bbf\u4e3b\u673a\u7684root\u865a\u62df\u673a\u6743\u9650\u662f\u5206\u79bb\u7684\uff0c\u5e76\u4e14\u865a\u62df\u673a\u5229\u7528\u786c\u4ef6\u9694\u79bb\uff1a\u5982Intel\u7684VT-d\u548cVT-x\u7684ring-1\u786c\u4ef6\u9694\u79bb\u6280\u672f\uff0c\u8fd9\u79cd\u9694\u79bb\u6280\u672f\u53ef\u4ee5\u9632\u6b62\u865a\u62df\u673a\u7a81\u7834\u548c\u5f7c\u6b64\u4ea4\u4e92\u3002 \u865a\u62df\u673a\u7684\u5b89\u5168\u6027\u9ad8 \u53ef\u7ba1\u7406\u6027 docker\u7684\u96c6\u4e2d\u5316\u7ba1\u7406\u5de5\u5177\u8fd8\u4e0d\u7b97\u6210\u719f \u5404\u79cd\u865a\u62df\u5316\u6280\u672f\u90fd\u6709\u6210\u719f\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u4f8b\u5982VMware vCenter\u63d0\u4f9b\u5b8c\u5907\u7684\u865a\u62df\u673a\u7ba1\u7406\u80fd\u529b\u3002 \u5feb\u901f\u521b\u5efa\u3001\u5220\u9664 Docker\u5bb9\u5668\u521b\u5efa\u662f\u79d2\u7ea7\u522b\u7684\uff0cDocker\u7684\u5feb\u901f\u8fed\u4ee3\u6027\uff0c\u51b3\u5b9a\u4e86\u65e0\u8bba\u662f\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u90e8\u7f72\u90fd\u53ef\u4ee5\u8282\u7ea6\u5927\u91cf\u65f6\u95f4\u3002 \u865a\u62df\u5316\u521b\u5efa\u65f6\u5206\u949f\u7ea7\u522b\u7684 \u4ea4\u4ed8\u3001\u90e8\u7f72 Docker\u5728Dockerfile\u4e2d\u8bb0\u5f55\u4e86\u5bb9\u5668\u6784\u5efa\u8fc7\u7a0b\uff0c\u53ef\u5728\u96c6\u7fa4\u4e2d\u5b9e\u73b0\u5feb\u901f\u5206\u53d1\u548c\u5feb\u901f\u90e8\u7f72\uff1b \u865a\u62df\u673a\u53ef\u4ee5\u901a\u8fc7\u955c\u50cf\u5b9e\u73b0\u73af\u5883\u4ea4\u4e92\u7684\u4e00\u81f4\u6027\uff0c\u4f46\u955c\u50cf\u5206\u53d1\u65e0\u6cd5\u4f53\u7cfb\u5316\uff1b docker\u7684\u67b6\u6784\u539f\u7406 server daemon: docker server\u662f\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5b83\u53ef\u4ee5\u90e8\u7f72\u8fdc\u7a0b\u4e5f\u53ef\u4ee5\u90e8\u7f72\u672c\u5730\u3002\u5b83\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u7f51\u7edcnetwork\u548c\u78c1\u76d8data volumes REST API: \u5b9e\u73b0client\u548cserver\u95f4\u901a\u4fe1\u4ea4\u4e92\u534f\u8bae CLI(command line interface): docker client, \u5b83\u5305\u62ec\u4e24\u90e8\u5206\u5bb9\u5668\u548c\u955c\u50cf\uff0c1\u4e2a\u955c\u50cf\u53ef\u4ee5\u521b\u5efaN\u4e2a\u5bb9\u5668 Image: \u4e00\u4e2a\u53ea\u8bfb\u7684\u955c\u50cf\u6a21\u677f\u3002\u53ef\u4ee5\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u955c\u50cf\u4e5f\u53ef\u4ee5\u4ece\u7f51\u7ad9\u4e0a\u4e0b\u8f7d\u955c\u50cf\u4f9b\u81ea\u5df1\u4f7f\u7528\u3002 Container: \u7531docker client\u901a\u8fc7\u955c\u50cf\u521b\u5efa\u7684\u5b9e\u4f8b\uff0c\u7528\u6237\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u5e94\u7528\uff0c\u4e00\u65e6\u521b\u5efa\u540e\u5c31\u53ef\u4ee5\u770b\u505a\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6bcf\u4e2a\u5e94\u7528\u8fd0\u884c\u5728\u9694\u79bb\u7684\u5bb9\u5668\u4e2d\uff0c\u4eab\u7528\u72ec\u81ea\u7684\u6743\u9650\u3001\u7528\u6237\u3001\u7f51\u7edc\u3002 Registry: \u955c\u50cf\u4ed3\u5e93\uff0c\u7528\u6765\u5b58\u50a8\u548c\u7ba1\u7406image\u955c\u50cf\uff0c\u76ee\u524d\u4e3b\u6d41\u7684\u4ed3\u5e93\u6709Docker hub\u3001\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u3001\u4e5f\u53ef\u4ee5\u81ea\u5df1\u521b\u5efa\u4ed3\u5e93\u6765\u7ba1\u7406\u3002 \u8bf4\u660e\uff1a docker client \u901a\u8fc73\u4e2a\u547d\u4ee4\uff0c\u5148\u5230docker daemon pull\u62c9\u53d6images\uff0c\u5982\u679c\u670d\u52a1\u5668\u7aef\u6ca1\u6709\uff0c\u5148\u5230\u4ed3\u5e93\u62c9\u53d6\uff0c\uff08\u5982\u679c\u4ed3\u5e93\u6ca1\u6709\uff0c\u4f60\u53ef\u4ee5build\u81ea\u5efaimages\uff09;\u6700\u540e\u901a\u8fc7run\u547d\u4ee4\u521b\u5efa\u5bb9\u5668 \u4e8c\u3001\u955c\u50cf\u7ba1\u7406 1\u3001\u4ec0\u4e48\u662f\u955c\u50cf \u4e00\u4e2a\u53ea\u8bfb\u7684\u6a21\u677f\uff0c\u5c31\u662f\u4e00\u4e2adockerfile\uff0c\u53ef\u4ee5\u5728\u955c\u50cf\u4ed3\u5e93\u4e0a\u4f20\u6216\u8005\u4e0b\u8f7d \u5148\u6709\u955c\u50cf\uff0c\u540e\u6709\u5bb9\u5668\uff1b\u5e76\u4e14\u4e00\u4e2a\u955c\u50cf\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u5bb9\u5668 docker\u5bb9\u5668\u6700\u5927\u7684\u7279\u70b9\uff1a\u5206\u5c42\u7ed3\u6784 \u6700\u5e95\u5c42\u662f\u4e00\u4e2abase\u5c42\uff0c\u4e5f\u5373\u662f\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5c42\u3002\u5b83\u8fd8\u4f1a\u4ecebase\u5c42\u4e00\u5c42\u5c42\u7684\u53e0\u52a0\u751f\u6210\uff08\u4ec0\u4e48\u662f\u5c42\u5c42\u53e0\u52a0\uff1f \u4f8b\u5982\uff0c\u5b89\u88c5\u4e00\u4e2a\u8f6f\u4ef6\uff0c\u4ed6\u5c31\u4f1a\u5728base\u5c42\u7684\u57fa\u7840\u4e0a\u8ffd\u52a0\u4e00\u5c42\u3002\u5b83\u7684\u597d\u5904\u5c31\u662f\u8d44\u6e90\u5171\u4eab\uff09\u3002 2\u3001\u955c\u50cf\u76f8\u5173\u547d\u4ee4 \u67e5\u770bdocker\u672c\u5730\u7684\u955c\u50cf sh docker images \u641c\u7d22\u4e00\u4e2a\u955c\u50cf sh docker search mysql INDEX: \u4ed3\u5e93\u5730\u5740 NAME: \u4ed3\u5e93+\u540d\u79f0 STARS: \u7528\u6237\u7684\u559c\u6b22\u7a0b\u5ea6 OFFICIAL: \u662f\u5426\u5b98\u65b9\uff0c\u5982\u679c\u4e3aOK\u7684\u8bdd\u4ee3\u8868\u5b98\u65b9\uff0c\u53ef\u4fe1\u5ea6\u9ad8\uff0c\u653e\u5fc3\u4f7f\u7528; AUTOMATED: \u662f\u5426\u4e3a\u516c\u5f00\u7684dockerfile\u811a\u672c\u5236\u6210\u7684\uff1f\u4e5f\u5373\u662f\u8bf4dockerfile\u662f\u5426\u63d0\u4f9b\u3002 \u4e0b\u8f7d\u4e00\u4e2a\u955c\u50cf sh docker pull mysql:5.7 \u4e0b\u8f7d\u5b8c\u540e\uff0c\u67e5\u770b\u662f\u5426\u5728\u672c\u5730docker images \u5220\u9664docker\u955c\u50cf sh docker rmi [imageID] # \u5982\u679c\u8981\u5220\u9664\u5168\u90e8\u955c\u50cf docker rmi $(docker images -q) \u52a0\u901f\u5668\u7684\u914d\u7f6e sh #centos\u7684\u963f\u91cc\u52a0\u901f\u5668\u547d\u4ee4 mkdir -p /etc/docker tee /etc/docker/daemon.json <<-'EOF' { \"registry-mirrors\": [\"https://uqxmqcrw.mirror.aliyuncs.com\"] } EOF systemctl daemon-reload systemctl restart docker 3\u3001dockerfile \u6982\u5ff5 dockefile\u662f\u4e00\u4e2a\u6587\u672c\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5b83\u53ef\u4ee5\u5feb\u901f\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u955c\u50cf\uff0c\u6587\u672c\u5185\u5bb9\u5305\u542b\u4e86\u82e5\u5e72\u7684\u547d\u4ee4\u884c\uff0c\u5e76\u652f\u6301#\u4f5c\u4e3a\u6ce8\u91ca\u884c\uff0c\u6587\u672c\u683c\u5f0f\u5305\u542b\u57fa\u7840\u955c\u50cfFROM\uff0c\u7ef4\u62a4\u8005MAINTAINER\uff0c\u64cd\u4f5c\u6307\u4ee4ADD\uff0c\u5bb9\u5668\u542f\u52a8\u540e\u6307\u4ee4\u7b49\u5171\u8ba14\u90e8\u5206 dockerfile \u6587\u4ef6\u793a\u4f8b ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER tang #3.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD eureka-server-0.0.1-SNAPSHOT.jar /app/service/eureka/data/app.jar #\u544a\u8bc9docker\u5bb9\u5668\u66b4\u9732\u7aef\u53e3\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7-p \u505a\u7aef\u53e3\u6620\u5c04 EXPOSE 8761 #5.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/eureka/data/app.jar\"] ``` \u6784\u5efadocker\u955c\u50cf ```sh #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-jackly/eureka-server:1.0.0 . ``` \u67e5\u770b\u548c\u8fd0\u884c\u955c\u50cf\u5bb9\u5668 ```sh #\u67e5\u770b\u672c\u5730\u955c\u50cf docker images #\u542f\u52a8\u955c\u50cf docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:1.0.0 ``` \u4e09\u3001\u955c\u50cf\u4ed3\u5e93\u7ba1\u7406 1\u3001\u5efa\u8bbedockerhub\u5b98\u65b9\u4ed3\u5e93 \u4ec0\u4e48\u662f\u955c\u50cf\u4ed3\u5e93 \u5c31\u662f\u5b58\u653e\u955c\u50cf\u7684\u5730\u65b9 \u63a8\u9001\u955c\u50cf\u5230dockerhub(\u9700\u7ffb\u5899) ```sh \u2460\u3001\u767b\u5f55 https://hub.docker.com/\uff0c\u521b\u5efa\u4e00\u4e2aeureka-server\u4ed3\u5e93 \u2461\u3001\u672c\u5730linux\u767b\u5f55docker\u5b98\u65b9\uff0c docker login \u2462\u3001\u6539\u955c\u50cf\u7684\u540d\uff0c\uff08\u4e3a\u4ec0\u4e48\u8981\u6539\uff1f\u56e0\u4e3adocker\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\u662f\u4ee5 \u7528\u6237\u540d \u6765\u547d\u540d\u4ed3\u5e93\u7684\uff09 docker tag registry-jackly/eureka-server:1.0.0 jacklydocker/eureka-server:1.0.0 \u2463\u3001\u63a8\u9001\u955c\u50cf\u5230\u5b98\u65b9\u4ed3\u5e93 docker push jacklydocker/eureka-server:1.0.0 \u2464\u3001\u62c9\u53d6\u4e0a\u4f20\u7684\u955c\u50cf \u5148\u5220\u9664\u65e7\u955c\u50cf:docker rmi jacklydocker/eureka-server:1.0.0 \u62c9\u53d6\u955c\u50cf\uff1adocker pull jacklydocker/eureka-server:1.0.0 \u521b\u5efa\u5bb9\u5668\uff1adocker run -d -p 8761:8761 --name=eureka docker.io/jacklydocker/eureka-server:1.0.0 ``` 2\u3001\u5efa\u8bbe\u963f\u91cc\u4e91docker\u4ed3\u5e93 \u63a8\u9001\u955c\u50cf\u5230\u963f\u91cc\u4e91\u4ed3\u5e93 ```sh \u2460\u3001\u767b\u5f55\u963f\u91cc\u4e91\uff0c\u5148\u521b\u5efa\u547d\u540d\u7a7a\u95f4\uff0c\u5e76\u5efa\u4e2a\u955c\u50cf\u4ed3\u5e93 \u2461\u3001\u672c\u5730linux\u767b\u5f55\u767b\u5f55\u963f\u91cc\u4e91Docker Registry\uff0c docker login --username=\u4f60\u7684\u7528\u6237\u540d registry.cn-shenzhen.aliyuncs.com \u2462\u3001\u6539\u955c\u50cf\u7684\u540d\uff0c\uff08\u4e3a\u4ec0\u4e48\u8981\u6539\uff1f\u56e0\u4e3aaliyun docker\u955c\u50cf\u4ed3\u5e93\u662f\u4ee5 \u7528\u6237\u540d \u6765\u547d\u540d\u4ed3\u5e93\u7684\uff09 docker tag 58acc264425c registry.cn-shenzhen.aliyuncs.com/jackly/eureka-server:1.0.0 \u2463\u3001\u63a8\u9001\u955c\u50cf\u5230\u963f\u91cc\u4e91\u4ed3\u5e93 docker push registry.cn-shenzhen.aliyuncs.com/jackly/eureka-server:1.0.0 \u2464\u3001\u62c9\u53d6\u4e0a\u4f20\u7684\u955c\u50cf docker pull registry.cn-shenzhen.aliyuncs.com/jackly/eureka-server:1.0.0 ``` 3\u3001\u5efa\u8bbe\u672c\u5730\u4ed3\u5e93 \u4e3a\u4ec0\u4e48\u9700\u8981\u642d\u5efa\u672c\u5730\u4ed3\u5e93 \u8282\u7ea6\u5e26\u5bbd\uff1a\u56e0\u4e3a\u5982\u679c\u7528docker\u6216\u8005\u963f\u91cc\u4e91\u5b98\u65b9\u7684\u4ed3\u5e93\u8d70\u7684\u4e92\u8054\u7f51 \u6d6a\u8d39\u5e26\u5bbd\uff0c\u800c\u4e14\u6162\u3002 \u63d0\u4f9b\u8d44\u6e90\u5229\u7528\u548c\u5b89\u5168\uff1a\u56e0\u4e3a\u516c\u53f8\u5185\u90e8\u7684\u955c\u50cf\uff0c\u63a8\u9001\u5230\u672c\u5730\u4ed3\u5e93\uff0c\u66f4\u65b9\u4fbf\u516c\u53f8\u5185\u90e8\u4eba\u7528\uff0c\u800c\u4e14\u5b89\u5168\u6027\u9ad8 \u521b\u5efa\u4ed3\u5e93\u5bb9\u5668 sh #\u67e5\u627e\u5b98\u65b9\u4ed3\u5e93 docker search registry #\u62c9\u53d6\u4ed3\u5e93\u955c\u50cf docker pull registry #\u8fd0\u884c\u4ed3\u5e93\u5bb9\u5668 docker run -d -p 5000:5000 \\ --restart=always \\ --privileged=true \\ --name=registry-local-jackly \\ -v /date/volume/registry:/var/lib/registry \\ registry \u63a8\u9001\u955c\u50cf\u5230\u672c\u5730\u79c1\u6709\u4ed3\u5e93 sh \u2460\u3001\u6539\u955c\u50cf\u7684\u540d docker tag 58acc264425c reg.qxbdocker.com:5000/eureka-server:1.0.0 \u2461\u3001\u63a8\u9001\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93(\u6ce8\u610f\uff1a\u8bb0\u5f97\u6539\u672c\u5730hosts\uff1a127.0.0.1 reg.qxbdocker.com) docker push reg.qxbdocker.com:5000/eureka-server:1.0.0 \u2462\u3001\u67e5\u770b\u642d\u5efa\u4ed3\u5e93\u7684\u4fe1\u606f \u67e5\u770b\u4ed3\u5e93\u7684\u955c\u50cf\uff1a curl -X GET http://127.0.0.1:5000/v2/_catalog \u4ed3\u5e93\u67d0\u4e2a\u955c\u50cf\u7684\u7248\u672c\u4fe1\u606f\uff1a curl -X GET http://127.0.0.1:5000/v2/eureka-server/tags/list \u2464\u3001\u62c9\u53d6\u4e0a\u4f20\u7684\u955c\u50cf #\u5148\u5220\u9664\u672c\u5730\u955c\u50cf docker rmi reg.qxbdocker.com:5000/eureka-server:1.0.0 #\u5728\u62c9\u53d6\u4ed3\u5e93\u4e2d\u7684\u955c\u50cf docker pull reg.qxbdocker.com:5000/eureka-server:1.0.0 \u56db\u3001\u5bb9\u5668\u7ba1\u7406 1\u3001\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u5b9e\u8df5 \u4ec0\u4e48\u662f\u5bb9\u5668 \u5bb9\u5668\u7c7b\u4f3c\u4e8e\u80f6\u56ca\u516c\u5bd3\uff0c\u5b83\u662f\u4e00\u4e2a\u7cbe\u7b80\u7248\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e00\u822c\u5bb9\u5668\u4e2d\u53ea\u8fd0\u884c\u4e00\u4e2a\u5e94\u7528\uff08\u4f8b\u5982\uff1aeureka-server\u955c\u50cf\uff09\u3002 \u5982\u4f55\u521b\u5efa\u5bb9\u5668 \u901a\u8fc7\u955c\u50cf\u521b\u5efa\u5bb9\u5668\uff0c\u901a\u8fc7docker run\u547d\u4ee4\u521b\u5efa\u3002 \u5bb9\u5668\u7684\u4f5c\u7528 \u5bb9\u5668\u8d77\u5230\u4e86\u9694\u79bb\u7684\u4f5c\u7528\uff0c\u72ec\u4eab\u7a7a\u95f4\u3001\u7f51\u7edc\u7b49\u7b49\u3002 doker\u547d\u4ee4 sh docker run --help -d, --detach=false \u6307\u5b9a\u5bb9\u5668\u8fd0\u884c\u4e8e\u524d\u53f0\u8fd8\u662f\u540e\u53f0\uff0c\u9ed8\u8ba4\u4e3afalse -i, --interactive=false \u6253\u5f00STDIN\uff0c\u7528\u4e8e\u63a7\u5236\u53f0\u4ea4\u4e92 -t, --tty=false \u5206\u914dtty\u8bbe\u5907\uff0c\u8be5\u53ef\u4ee5\u652f\u6301\u7ec8\u7aef\u767b\u5f55\uff0c\u9ed8\u8ba4\u4e3afalse -u, --user=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u7528\u6237 -a, --attach=[] \u767b\u5f55\u5bb9\u5668\uff08\u5fc5\u987b\u662f\u4ee5docker run -d\u542f\u52a8\u7684\u5bb9\u5668\uff09 -w, --workdir=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55 -c, --cpu-shares=0 \u8bbe\u7f6e\u5bb9\u5668CPU\u6743\u91cd\uff0c\u5728CPU\u5171\u4eab\u573a\u666f\u4f7f\u7528 -e, --env=[] \u6307\u5b9a\u73af\u5883\u53d8\u91cf\uff0c\u5bb9\u5668\u4e2d\u53ef\u4ee5\u4f7f\u7528\u8be5\u73af\u5883\u53d8\u91cf -m, --memory=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u5185\u5b58\u4e0a\u9650 -P, --publish-all=false \u6307\u5b9a\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3 -p, --publish=[] \u6307\u5b9a\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3 -h, --hostname=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u4e3b\u673a\u540d -v, --volume=[] \u7ed9\u5bb9\u5668\u6302\u8f7d\u5b58\u50a8\u5377\uff0c\u6302\u8f7d\u5230\u5bb9\u5668\u7684\u67d0\u4e2a\u76ee\u5f55 --volumes-from=[] \u7ed9\u5bb9\u5668\u6302\u8f7d\u5176\u4ed6\u5bb9\u5668\u4e0a\u7684\u5377\uff0c\u6302\u8f7d\u5230\u5bb9\u5668\u7684\u67d0\u4e2a\u76ee\u5f55 --cap-add=[] \u6dfb\u52a0\u6743\u9650\uff0c\u6743\u9650\u6e05\u5355\u8be6\u89c1:http://linux.die.net/man/7/capabilities --cap-drop=[] \u5220\u9664\u6743\u9650\uff0c\u6743\u9650\u6e05\u5355\u8be6\u89c1:http://linux.die.net/man/7/capabilities --cidfile=\"\" \u8fd0\u884c\u5bb9\u5668\u540e\uff0c\u5728\u6307\u5b9a\u6587\u4ef6\u4e2d\u5199\u5165\u5bb9\u5668PID\u503c\uff0c\u4e00\u79cd\u5178\u578b\u7684\u76d1\u63a7\u7cfb\u7edf\u7528\u6cd5 --cpuset=\"\" \u8bbe\u7f6e\u5bb9\u5668\u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9bCPU\uff0c\u6b64\u53c2\u6570\u53ef\u4ee5\u7528\u6765\u5bb9\u5668\u72ec\u5360CPU --device=[] \u6dfb\u52a0\u4e3b\u673a\u8bbe\u5907\u7ed9\u5bb9\u5668\uff0c\u76f8\u5f53\u4e8e\u8bbe\u5907\u76f4\u901a --dns=[] \u6307\u5b9a\u5bb9\u5668\u7684dns\u670d\u52a1\u5668 --dns-search=[] \u6307\u5b9a\u5bb9\u5668\u7684dns\u641c\u7d22\u57df\u540d\uff0c\u5199\u5165\u5230\u5bb9\u5668\u7684/etc/resolv.conf\u6587\u4ef6 --entrypoint=\"\" \u8986\u76d6image\u7684\u5165\u53e3\u70b9 --env-file=[] \u6307\u5b9a\u73af\u5883\u53d8\u91cf\u6587\u4ef6\uff0c\u6587\u4ef6\u683c\u5f0f\u4e3a\u6bcf\u884c\u4e00\u4e2a\u73af\u5883\u53d8\u91cf --expose=[] \u6307\u5b9a\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3\uff0c\u5373\u4fee\u6539\u955c\u50cf\u7684\u66b4\u9732\u7aef\u53e3 --link=[] \u6307\u5b9a\u5bb9\u5668\u95f4\u7684\u5173\u8054\uff0c\u4f7f\u7528\u5176\u4ed6\u5bb9\u5668\u7684IP\u3001env\u7b49\u4fe1\u606f --lxc-conf=[] \u6307\u5b9a\u5bb9\u5668\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u6709\u5728\u6307\u5b9a--exec-driver=lxc\u65f6\u4f7f\u7528 --name=\"\" \u6307\u5b9a\u5bb9\u5668\u540d\u5b57\uff0c\u540e\u7eed\u53ef\u4ee5\u901a\u8fc7\u540d\u5b57\u8fdb\u884c\u5bb9\u5668\u7ba1\u7406\uff0clinks\u7279\u6027\u9700\u8981\u4f7f\u7528\u540d\u5b57 --net=\"bridge\" \u5bb9\u5668\u7f51\u7edc\u8bbe\u7f6e: bridge \u4f7f\u7528docker daemon\u6307\u5b9a\u7684\u7f51\u6865 host //\u5bb9\u5668\u4f7f\u7528\u4e3b\u673a\u7684\u7f51\u7edc container:NAME_or_ID >//\u4f7f\u7528\u5176\u4ed6\u5bb9\u5668\u7684\u7f51\u8def\uff0c\u5171\u4eabIP\u548cPORT\u7b49\u7f51\u7edc\u8d44\u6e90 none \u5bb9\u5668\u4f7f\u7528\u81ea\u5df1\u7684\u7f51\u7edc\uff08\u7c7b\u4f3c--net=bridge\uff09\uff0c\u4f46\u662f\u4e0d\u8fdb\u884c\u914d\u7f6e --privileged=false \u6307\u5b9a\u5bb9\u5668\u662f\u5426\u4e3a\u7279\u6743\u5bb9\u5668\uff0c\u7279\u6743\u5bb9\u5668\u62e5\u6709\u6240\u6709\u7684capabilities --restart=\"no\" \u6307\u5b9a\u5bb9\u5668\u505c\u6b62\u540e\u7684\u91cd\u542f\u7b56\u7565: no\uff1a\u5bb9\u5668\u9000\u51fa\u65f6\u4e0d\u91cd\u542f on-failure\uff1a\u5bb9\u5668\u6545\u969c\u9000\u51fa\uff08\u8fd4\u56de\u503c\u975e\u96f6\uff09\u65f6\u91cd\u542f always\uff1a\u5bb9\u5668\u9000\u51fa\u65f6\u603b\u662f\u91cd\u542f --rm=false \u6307\u5b9a\u5bb9\u5668\u505c\u6b62\u540e\u81ea\u52a8\u5220\u9664\u5bb9\u5668(\u4e0d\u652f\u6301\u4ee5docker run -d\u542f\u52a8\u7684\u5bb9\u5668) --sig-proxy=true \u8bbe\u7f6e\u7531\u4ee3\u7406\u63a5\u53d7\u5e76\u5904\u7406\u4fe1\u53f7\uff0c\u4f46\u662fSIGCHLD\u3001SIGSTOP\u548cSIGKILL\u4e0d\u80fd\u88ab\u4ee3\u7406 docker\u521b\u5efa\u793a\u4f8b sh docker run -d -p 5000:5000 \\ --restart=always \\ --privileged=true \\ --name=registry-local-jackly \\ -v /date/volume/registry:/var/lib/registry \\ registry docker \u5e38\u7528\u547d\u4ee4 sh #\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668 docker ps #\u67e5\u770b\u6240\u6709\u7684\u5bb9\u5668(\u5305\u62ec\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668) docker ps -a #\u505c\u6b62\u5bb9\u5668 docker stop \u5bb9\u5668ID #\u5f3a\u5236\u505c\u6b62\u5bb9\u5668 docker kill \u5bb9\u5668ID #\u542f\u52a8\u5bb9\u5668 docker start \u5bb9\u5668ID #\u91cd\u542f\u5bb9\u5668 docker restart \u5bb9\u5668ID #\u5220\u9664\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668 docker rm \u5bb9\u5668ID #\u5220\u9664\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u5f3a\u5236\u5220\u9664 docker rm -f \u5bb9\u5668ID 2\u3001\u5982\u4f55\u8fdb\u5165\u5bb9\u5668\u5185\u90e8 \u8fdb\u5165\u5bb9\u5668\u7684\u65b9\u5f0f \u67094\u79cd\u65b9\u5f0f\u80fd\u8fdb\u5165\u5bb9\u5668\uff0c\u5206\u522b\u662fexec\u3001docker attach\u3001ssh\u3001nsenter. \u8fd94\u79cd\u90fd\u80fd\u8fdb\u5165\u5bb9\u5668\uff0c\u4f46\u662f\u6700\u597d\u7528\u6700\u5e38\u7528\u7684\u662fexec exec\u547d\u4ee4 sh docker exec --help -d \u4ee5\u540e\u53f0\u65b9\u5f0f\u6267\u884c\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u6267\u884c\u5b8c\u8fd9\u6761\u547d\u4ee4\uff0c\u8fd8\u53ef\u4ee5\u5e72\u5176\u4ed6\u4e8b\u60c5\uff0c\u5199\u811a\u672c\u6700\u5e38\u7528 -e \u4ee3\u8868\u73af\u5883\u53d8\u91cf -i \u4ee5\u4ea4\u4e92\u65b9\u5f0f\u8fd0\u884c\uff0c\u662f\u963b\u585e\u5f0f\u7684 -t \u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff0c\u8fd9\u4e2a\u53c2\u6570\u901a\u5e38\u4e0e-i\u53c2\u6570\u4e00\u8d77\u4f7f\u7528\uff0c\u7136\u540e\u5728\u540e\u9762\u8ddf\u4e0a\u5bb9\u5668\u91cc\u7684/bin/bash\uff0c\u8fd9\u6837\u5c31\u628a\u6211\u4eec\u5e26\u5230\u5bb9\u5668\u91cc\u53bb\u4e86\u3002 -u \u6307\u5b9a\u8fdb\u5165\u7684\u5bb9\u5668\u4ee5\u54ea\u4e2a\u7528\u6237\u767b\u9646\uff0c\u9ed8\u8ba4\u662froot \u8fdb\u5165\u5bb9\u5668\u547d\u4ee4 sh #\u542f\u52a8\u955c\u50cf\uff0c\u82e5\u955c\u50cf\u5bb9\u5668\u5df2\u7ecf\u521b\u5efa\uff0c\u5219\u901a\u8fc7docker ps -a\u67e5\u8be2\u505c\u6b62\u7684\u5bb9\u5668id\uff0c\u5728\u901a\u8fc7docker start \u5bb9\u5668ID \u542f\u52a8\u5bb9\u5668 docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:1.0.0 #\u8fdb\u5165\u5bb9\u5668\u7684\u76f8\u5173\u547d\u4ee4 docker exec -it eureka sh #\u8fdb\u5165\u540e\u53ef\u4ee5\u4f7f\u7528ls\u67e5\u770b\u76ee\u5f55\uff08/app/service/eureka/data/app.jar\uff09 docker exec -it eureka /bin/bash docker exec -it eureka pwd docker exec -it eureka top 3\u3001\u5bb9\u5668\u5185\u90e8\u6539\u53d8\u540e\uff0c\u80fd\u5426\u91cd\u65b0\u751f\u6210\u955c\u50cf \u4f7f\u7528ll\u547d\u4ee4\u9a8c\u8bc1 sh \u2460\u3001\u8fdb\u5165\u5bb9\u5668\uff1a docker exec -it eureka /bin/bash \u2461\u3001\u4fee\u6539\u5bb9\u5668\u5185\u5bb9\uff1aecho \"alias ll='ls -l'\" >> ~/.bashrc && source ~/.bashrc \u2462\u3001\u9a8c\u8bc1ll\u547d\u4ee4: ll \u2463\u3001\u5f3a\u5236\u5220\u9664\u5bb9\u5668\uff1adocker rm -f \u5bb9\u5668ID \u2464\u3001\u542f\u52a8\u955c\u50cf\u5bb9\u5668\uff1adocker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:1.0.0 \u2465\u3001\u8fdb\u5165\u5bb9\u5668\u4f7f\u7528ll\u547d\u4ee4\uff1a\u53d1\u73b0\u5148\u524d\u4fee\u6539\u7684\u5b9e\u6548 \u4fee\u6539\u5bb9\u5668\u540e\uff0c\u91cd\u65b0\u751f\u6210\u955c\u50cf sh \u2460\u3001\u8fdb\u5165\u5bb9\u5668\uff1adocker exec -it eureka /bin/bash \u2461\u3001\u4fee\u6539\u5bb9\u5668\u5185\u5bb9\uff1aecho \"alias ll='ls -l'\" >> ~/.bashrc && source ~/.bashrc \u2462\u3001\u9a8c\u8bc1ll\u547d\u4ee4:ll #\u751f\u6210\u955c\u50cf\u547d\u4ee4 docker commit --help -a \u7528\u6765\u6307\u5b9a\u4f5c\u8005 -c \u4f7f\u7528Dockerfile\u6307\u4ee4\u6765\u521b\u5efa\u955c\u50cf -m \u63cf\u8ff0\u6211\u4eec\u6b64\u6b21\u521b\u5efaimage\u7684\u4fe1\u606f -p \u5728commit\u65f6\uff0c\u5c06\u5bb9\u5668\u6682\u505c \u2463\u3001\u91cd\u65b0\u751f\u6210\u955c\u50cf docker commit -m=\"add ll\" --author=\"jackly\" eureka registry-jackly/eureka-server:2.0.0 \u2464\u3001\u542f\u52a8\u65b0\u955c\u50cf docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:2.0.0 \u4e94\u3001\u7f51\u7edc\u7ba1\u7406 1\u3001\u5916\u90e8\u7f51\u7edc\u5982\u4f55\u8bbf\u95ee\u5bb9\u5668\u5e94\u7528 \u5916\u90e8\u8bbf\u95ee\u5bb9\u5668\u5e94\u7528\uff0c\u662f\u901a\u8fc7\u7aef\u53e3\u6765\u5b9e\u73b0\u7684 sh #\u53c2\u6570-p\uff0c\u6307\u5b9a\u7aef\u53e3\uff0c\u5176\u4e2d 8080\u662f\u5bbf\u4e3b\u673a\u7684\u7aef\u53e3\uff0c80\u662f\u5bb9\u5668\u7684\u7aef\u53e3 docker run -d -p 8080:80 nginx #\u53c2\u6570-P\uff08\u5927\u5199\uff09\uff0c\u968f\u673a\u7aef\u53e3\uff0c\u968f\u673a\u8303\u56f4 32769-60999 docker run -d -P nginx dockerfile\u7684\u7aef\u53e3\u5b9e\u73b0\u89c4\u5219 1.\u5f00\u653eEXPOSE 8761 SH #\u53c2\u6570-p\uff0c\u6307\u5b9a\u7aef\u53e3 docker run -d -p 8761:8761 --name=eureka registry-agan/eureka-server:1.0.0 #\u53c2\u6570-P\uff0c\u968f\u673a\u7aef\u53e3\uff08 \u8fbe\u5230\u7684\u6548\u679c\u662f0.0.0.0:32771->8761\uff09 docker run -d -P --name=eureka registry-jackly/eureka-server:2.0.0 2.\u6ca1\u6709\u5f00\u653eEXPOSE8761 SH #\u53c2\u6570-p\uff0c\u6307\u5b9a\u7aef\u53e3(\u6548\u679c\uff1a\u6b63\u5e38) docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:2.0.0 #\u53c2\u6570-P\uff0c\u968f\u673a\u7aef\u53e3\uff08 \u8fbe\u5230\u7684\u6548\u679c\u662f\uff0c\u65e0\u7aef\u53e3\u53f7\uff0c\u8fde\u5185\u90e8\u5bb9\u5668\u90fd\u6ca1\u6709\u7aef\u53e3\uff09 docker run -d -P --name=eureka registry-jackly/eureka-server:2.0.0 2\u3001\u5982\u4f55\u5b9e\u73b0\u5bb9\u5668\u4e4b\u95f4\u7684\u7f51\u7edc\u901a\u4fe1 \u4e1a\u52a1\u573a\u666f\u4e3a4\u4e2a\u5bb9\u5668 mysql\u3001eureka\u3001product\u3001config \u5b89\u88c5mysql sh #\u542f\u52a8mysql\u5bb9\u5668 docker run -p 3306:3306 --name mysql \\ -e MYSQL_ROOT_PASSWORD=agan \\ -d mysql:5.7 #\u8fdb\u5165mysql\u5bb9\u5668 docker exec -it mysql /bin/bash #docker\u955c\u50cf\u6ca1\u6709ifconfig\u3001ping\u6307\u4ee4 apt-get update apt install net-tools # ifconfig apt install iputils-ping # ping \u521b\u5efaeureka\u5bb9\u5668 sh docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:2.0.0 \u90e8\u7f72config\u955c\u50cf\u548c\u5bb9\u5668 ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER jackly #3.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD config-server-0.0.1-SNAPSHOT.jar /app/service/config/data/app.jar #5.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/config/data/app.jar\"] ``` \u6784\u5efa\u955c\u50cf sh #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-jackly/config-server:1.0.0 . \u521b\u5efa\u5bb9\u5668 sh #\u67e5\u770b\u672c\u5730\u955c\u50cf docker images #\u542f\u52a8\u955c\u50cf link eureka:jacklyureka==>link \u5bb9\u5668\u540d\u79f0\uff1a\u522b\u540d\uff08\u5c06\u914d\u7f6e\u4e2d\u5fc3\u670d\u52a1\u6ce8\u518c\u5230eureka\uff09 docker run -d -p 9030:9030 --name config \\ --link eureka:jacklyureka \\ registry-jackly/config-server:1.0.0 #\u67e5\u770bconfig\u4fe1\u606f http://172.31.65.26:9030/e-book-product/deauflt \u90e8\u7f72product\u955c\u50cf\u548c\u5bb9\u5668 ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER jackly #3.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD e-book-product-core-0.0.1-SNAPSHOT.jar /app/service/product/data/app.jar #5.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/product/data/app.jar\"] ``` \u6784\u5efa\u955c\u50cf ```sh #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-jackly/product-server:1.0.0 . ``` \u521b\u5efa\u5bb9\u5668 sh #\u67e5\u770b\u672c\u5730\u955c\u50cf docker images #\u542f\u52a8\u955c\u50cf \u6ce8\uff1alink\u5c31\u662f\u5bb9\u5668\u76f4\u63a5\u7684\u8fde\u63a5\uff0c\u4f60\u4e0d\u7528IP\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u901a\u8fc7link\u6765\u5b9e\u73b0\u5bb9\u5668\u540d\u4e4b\u95f4\u7684\u901a\u4fe1\uff1b\u5b83\u7684\u8bed\u6cd5\u662f link \u5bb9\u5668\u540d\uff1a\u522b\u540d docker run -d -p 8083:8083 --name product \\ --link mysql:jacklymysql \\ --link eureka:jacklyeureka \\ registry-jackly/product-server:1.0.0 #\u9a8c\u8bc1\u6548\u679c http://172.31.65.26:8761/ http://172.31.65.26:8083/product/findAllProduct link\u539f\u7406 sh #\u539f\u7406\u5c31\u662f\u5728prodct\u5bb9\u5668\u4e2d\u7684hosts\u52a0\u4e862\u6761\u8bb0\u5f55\u3002 docker exec -it product /bin/bash cat /etc/hosts \u516d\u3001\u6570\u636e\u7ba1\u7406 1\u3001docker\u5bb9\u5668\u7684\u6570\u636e\u5982\u4f55\u5171\u4eab\u7ed9\u5bbf\u4e3b\u673a \u5bbf\u4e3b\u673a\u67e5\u770beureka\u65e5\u5fd7 \u4f7f\u7528docker run volume\u65b9\u5f0f\u5b9e\u73b0 sh #\u6784\u5efa\u955c\u50cf docker build -t registry-jackly/eureka-server:2.0.0 . #\u521b\u5efa\u5bb9\u5668 #\u5c31\u662f\u628adocker\u7684\u6570\u636e\u4fdd\u5b58\u5230\u5bbf\u4e3b\u673a\u7684\u78c1\u76d8\u4e2d\uff0c\u901a\u5e38\u8bf4\u7684\u5c31\u662f\u6302\u8f7d\u70b9\uff0c\u6216\u8005\u53eb\u505a\u5377\u3002 #\u8bed\u6cd5\uff1a -v \u5bbf\u4e3b\u673a\u76ee\u5f55\uff1a\u5bb9\u5668\u76ee\u5f55 docker run -d -p 8761:8761 --name=eureka \\ --privileged=true \\ -v /app/service/eureka/logs:/opt/data \\ registry-jackly/eureka-server:2.0.0 \u4f7f\u7528dockerfile\u65b9\u5f0f\u5b9e\u73b0 ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER jackly #3.\u52a0\u5165\u6302\u8f7d\u70b9 VOLUME /opt/data #4.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD eureka-server-0.0.1-SNAPSHOT.jar /app/service/eureka/data/app.jar #5.\u544a\u8bc9docker\u5bb9\u5668\u66b4\u9732\u7aef\u53e3\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7-p \u505a\u7aef\u53e3\u6620\u5c04 EXPOSE 8761 #6.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/eureka/data/app.jar\"] ``` sh #\u91cd\u65b0\u6784\u5efaeureka docker build -t registry-jackly/eureka-server:3.0.0 . #\u521b\u5efa\u5bb9\u5668 docker run -d -p 8761:8761 --name=eureka \\ --privileged=true \\ registry-jackly/eureka-server:3.0.0 \u6ce8\u610f\u70b9\uff1a dockerfile volume \u65e0\u6cd5\u6307\u5b9a\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\uff0c\u90fd\u662f\u81ea\u52a8\u751f\u6210\uff0c\u800c\u4e14\u662f\u968f\u673a\u7684\uff1b\u9ed8\u8ba4\u5728/var/lib/docker/volumes/\u3002\uff08\u4e3a\u4ec0\u4e48\u662f\u968f\u673a\u751f\u6210\uff1f\u56e0\u4e3adockerfile\u65e0\u6cd5\u786e\u5b9a\u6bcf\u53f0\u5bbf\u4e3b\u673a\u662f\u5426\u90fd\u5b58\u5728\u76ee\u5f55\uff09 sh #\u5982\u4f55\u627e\u5230\u5bbf\u4e3b\u673a\u7684\u6302\u8f7d\u76ee\u5f55\uff1f docker inspect eureka #\u4fe1\u606f\u6bb5 \"Mounts\": [ { \"Type\": \"volume\", \"Name\": \"cf527694ebafb92426a52f1916b26832b4c8977093083450a96fbccb3d866669\", \"Source\": \"/var/lib/docker/volumes/cf527694ebafb92426a52f1916b26832b4c8977093083450a96fbccb3d866669/_data\", \"Destination\": \"/opt/data\", \"Driver\": \"local\", \"Mode\": \"\", \"RW\": true, \"Propagation\": \"\" } \u603b\u7ed3 docker run \u662f\u80fd\u6307\u5b9a\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\u3002dockerfile volume\u65e0\u6cd5\u6307\u5b9a\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\uff0c\u90fd\u662f\u81ea\u52a8\u751f\u6210\uff0c\u800c\u4e14\u662f\u968f\u673a\u7684\uff0c\u9ed8\u8ba4\u5728/var/lib/docker/volumes/\u3002 2\u3001\u5bbf\u4e3b\u673a\u5982\u4f55\u76f4\u63a5\u7ef4\u62a4docker\u5bb9\u5668\u7684\u6570\u636e \u5728\u6ca1\u6709\u4f7f\u7528-v\u6302\u8f7d\u70b9\u65f6\uff0c\u521b\u5efa\u7684\u5bb9\u5668\uff0c\u5728\u5bb9\u5668\u5220\u9664\u540e\uff0c\u6839\u636e\u955c\u50cf\u91cd\u65b0\u751f\u6210\u5bb9\u5668\u540e\uff0c\u6570\u636e\u4e5f\u968f\u4e4b\u6d41\u5931\u3002\u5982\u679c\u4f7f\u7528\u4e86\u6302\u8f7d\u70b9\uff0c\u5220\u9664\u5bb9\u5668\u540e\uff0c\u5728\u6839\u636e\u955c\u50cf\u751f\u6210\u5bb9\u5668\uff0c\u6570\u636e\u8fd8\u4f1a\u4fdd\u7559\u3002 docker run -p 3306:3306 --name mysql \\ -e MYSQL_ROOT_PASSWORD=agan \\ --privileged=true \\ -v /app/data/mysql:/var/lib/mysql \\ -d mysql:5.7 \u4e03\u3001\u955c\u50cf\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf\u642d\u5efa \u642d\u5efa\u4e00\u4e2a\u955c\u50cf\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf\u9700\u89813\u4e2a\u6b65\u9aa4\uff0c\u5206\u522b\u662f\uff1a\u751f\u6210\u4e00\u4e2a\u8ba4\u8bc1\u6587\u4ef6\uff0crsa\u7684\u8ba4\u8bc1\u6587\u4ef6\uff1b\u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93\u5bb9\u5668\uff1b\u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93web\u7ba1\u7406\u7cfb\u7edf \u751f\u6210\u4e00\u4e2a\u8ba4\u8bc1\u6587\u4ef6\uff0crsa\u7684\u8ba4\u8bc1\u6587\u4ef6 sh #\u5efa\u7acb/app/registry-jackly/conf\uff0c\u5728/app/registry-jackly\u76ee\u5f55\u4e0b\u6267\u884c \u4ee5\u4e0b\u547d\u4ee4\uff1a openssl req -new -newkey rsa:4096 -days 365 -subj \"/CN=localhost\" -nodes -x509 -keyout conf/auth.key -out conf/auth.cert \u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93\u7ba1\u7406 ```sh #\u521b\u5efa\u914d\u7f6e\u6587\u4ef6/app/registry-jackly/conf/registry-jackly.yml version: 0.1 #\u955c\u50cf\u5b58\u50a8\u5730\u65b9 storage: filesystem: rootdirectory: /var/lib/registry #\u955c\u50cf\u7684\u5220\u9664\u6743\u9650\uff0cenabled: true\u4ee3\u8868\u5f00\u542f\u5220\u9664\u6743\u9650 delete: enabled: true log: level: info #\u5f00\u542f\u4ed3\u5e93\u7684\u7f51\u7edc\uff0c\u7aef\u53e3\u53f7\u4e3a5000 http: addr: 0.0.0.0:5000 ``` sh #\u521b\u5efa\u4ed3\u5e93\u547d\u4ee4 docker run \\ -v /app/registry-jackly/conf/registry-jackly.yml:/etc/docker/registry/config.yml:ro \\ -v /app/registry-jackly/conf/auth.cert:/etc/docker/registry/auth.cert:ro \\ -p 5000:5000 --name registry-docker -d \\ --privileged=true \\ registry \u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93web\u7ba1\u7406\u7cfb\u7edf sh #\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a/app/registry-jackly/conf/registry-web.yml registry: # \u6307\u5b9aregistry\u7684\u5730\u5740\uff08\u6ce8\u610f\uff1aregistry-docker\u4e3a\u4ed3\u5e93\u7684\u5bb9\u5668\u540d\u5b57\uff09 url: http://registry-docker:5000/v2 #\u4ed3\u5e93\u7684\u540d\u79f0\uff08\u6ce8\u610f\uff1aregistry-docker\u4e3a\u4ed3\u5e93\u7684\u5bb9\u5668\u540d\u5b57\uff09 name: registry-docker:5000 #\u662f\u5426\u4e3a\u53ea\u8bfb\u6a21\u5f0f\uff0c\u8bbe\u7f6etrue\u65f6\uff0c\u4e0d\u5141\u8bb8\u5220\u9664\u955c\u50cf readonly: false #\u6743\u9650\u9a8c\u8bc1 auth: #\u662f\u5426\u5f00\u542f\u9a8c\u8bc1 enabled: true #\u9a8c\u8bc1\u8bc1\u4e66\u7684key key: /conf/auth.key #\u8bc1\u4e66\u9881\u53d1\u8005\u7684\u540d\u79f0 issuer: docker sh #\u521b\u5efa\u4ed3\u5e93web\u7ba1\u7406\u7cfb\u7edf\u547d\u4ee4(\u6ce8\u610f\uff1a--link registry-docker\u5f88\u91cd\u8981\uff0c\u6ca1\u6709\u7684\u8bdd\uff0c\u65e0\u6cd5\u8fde\u63a5\u4ed3\u5e93\u3002) docker run \\ -v /app/registry-jackly/conf/registry-web.yml:/conf/config.yml:ro \\ -v /app/registry-jackly/conf/auth.key:/conf/auth.key \\ -v /app/registry-jackly/db:/data \\ -d -p 8080:8080 --link registry-docker --name registry-web \\ --privileged=true \\ hyper/docker-registry-web \u6548\u679c\u9a8c\u8bc1 ```sh #\u767b\u5f55\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf http://172.31.65.26:8080/login/auth \u7528\u6237\u540d=admin \u5bc6\u7801 =admin #\u6784\u5efa\u955c\u50cf #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-docker:5000/eureka-server:3.0.0 . #\u4fee\u6539hosts(vi /etc/hosts) 127.0.0.1 registry-docker #\u7ed9\u642d\u5efa\u597d\u7684\u4ed3\u5e93\u52a0\u4e2a\u955c\u50cf docker push registry-docker:5000/eureka-server:3.0.0 #\u6743\u9650\u8bbe\u7f6e \u9ed8\u8ba4admin\u7528\u6237\u662f\u6ca1\u6709\u5220\u9664\u6743\u9650\uff0c\u9700\u8981\u91cd\u65b0\u521b\u5efa\u7528\u6237\uff0c\u5e76\u4e14\u7ed9\u4e88\u6743\u9650\u3002 ``` \u516b\u3001maven\u6784\u5efaspringcloud\u955c\u50cf \u5728\u5148\u524d\u6784\u5efa\u9879\u76ee\u65f6\uff0c\u5148\u901a\u8fc7maven\u6253\u5305\u51fajar,\u5728\u624b\u52a8\u4e0a\u4f20\u5230\u865a\u62df\u673a\u4e0a\uff0c\u5e76\u7f16\u5199dockerfile\u6587\u4ef6\uff0c\u5728\u4f7f\u7528docker build\u547d\u4ee4\u6784\u5efa\u955c\u50cf\uff0c\u6bd4\u8f83\u7e41\u7410\u3002\u5b9e\u9645\u4e0a\u53ef\u4ee5\u901a\u8fc7maven\u6765\u76f4\u63a5\u6784\u5efaspringcloud\u955c\u50cf\uff0cmaven\u6784\u5efaspringcloud\u955c\u50cf\u63a8\u9001\u7ed9\u4ed3\u5e93\uff0c\u9700\u89812\u6b65\u9aa4\uff1a\u5f00\u542fdocker\u8fdc\u7a0bAPI\uff1b\u7f16\u5199maven\u7684docker\u63d2\u4ef6\u3002 \u5f00\u542fdocker\u8fdc\u7a0bAPI sh #\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u52a0\u5165\uff1a-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock vi /usr/lib/systemd/system/docker.service #\u91cd\u542fdocker systemctl daemon-reload systemctl restart docker #\u9a8c\u8bc1docker\u8fdc\u7a0bapi\u662f\u5426\u751f\u6548 netstat -anp|grep 2375 curl 127.0.0.1:2375/info \u7f16\u5199maven\u7684docker\u63d2\u4ef6 ```sh #\u672c\u5730\u914d\u7f6ehosts(c:\\windows\\system32\\drivers\\etc) 172.31.65.26 registry-docker #docker maven\u63d2\u4ef6 org.springframework.boot spring-boot-maven-plugin com.spotify docker-maven-plugin 1.1.1 registry-docker:5000 http://registry-docker:2375 registry-docker:5000/${project.artifactId}:${project.version} java:8 [\"java\", \"-jar\", \"/${project.build.finalName}.jar\"] ${project.version} latest true true / ${project.build.directory} ${project.build.finalName}.jar #\u6267\u884c\u547d\u4ee4 clean package -DskipTests docker:build ``` \u4e5d\u3001\u7f16\u6392\u6784\u5efaspringcloud\u5b9e\u4f8b \u4ec0\u4e48\u662fcompose\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528compose \u56e0\u4e3a\u8fd0\u884c\u4e00\u4e2adocker\u955c\u50cf\uff0c\u901a\u5e38\u662f\u9700\u8981docker run \u547d\u4ee4\uff0c\u5728\u8fd0\u884c\u955c\u50cf\u7684\u65f6\u5019\u8fd8\u9700\u8981\u4e00\u5b9a\u7684\u53c2\u6570 \uff1b\u4f8b\u5982 \u5bb9\u5668\u7684\u540d\u79f0 \u6620\u5c04\u7684\u5377\uff0c\u7ed1\u5b9a\u7aef\u53e3\u7b49\u7b49\uff0c\u975e\u5e38\u9ebb\u70e6\u3002\u90a3\u5982\u679c\u6709\u4e2a\u4e00\u4e2a\u6587\u4ef6\u6765\u8bb0\u5f55\u4fdd\u5b58\u8fd9\u4e9b\u547d\u4ee4\u8be5\u591a\u597d\uff1f\u6240\u4ee5compose\u5c31\u662f\u7528\u4e8e\u5b58\u50a8\u8fd9\u4e9b\u547d\u4ee4\uff0c\u800c\u4e14\u5462\u662f\u6bd4docker run\u8fd8\u8981\u7b80\u5355\u5b58\u50a8\u3002\u90a3compose\u662f\u4ec0\u4e48\u5462\uff1f\u5b83\u65e2\u662f\u4e00\u4e2ayaml\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u4f8b\u5982docker-compose.yml\u6587\u4ef6\u3002 ```sh #\u5b89\u88c5\u6700\u65b0compose curl -L https://get.daocloud.io/docker/compose/releases/download/1.21.2/docker-compose- uname -s - uname -m > /usr/local/bin/docker-compose #\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650 chmod +x /usr/local/bin/docker-compose #\u6d4b\u8bd5\u5b89\u88c5\u7ed3\u679c docker-compose --version ``` \u81ea\u52a8\u6784\u5efaspring cloud\u6ce8\u518c\u4e2d\u5fc3eureka \u521b\u5efa\u4e00\u4e2a\u7f51\u7edc sh \u521b\u5efa\u547d\u4ee4\uff1adocker network create dockernet \u67e5\u770b\u547d\u4ee4\uff1adocker network ls compose\u5185\u5bb9\uff1a ```sh #docker compse \u7684\u914d\u7f6e\u6587\u4ef6\u5305\u542b3\u5927\u90e8\u5206\uff1aversion services networks version: '3' services: # \u670d\u52a1\u540d\u79f0 eureka: # \u5bb9\u5668\u540d\u79f0 container_name: eureka # \u955c\u50cf\u540d\u79f0 image: registry-docker:5000/eureka-server:0.0.1-SNAPSHOT # \u66b4\u9732\u7684\u7aef\u53e3\u53f7 ports: - \"8761:8761\" # \u8bbe\u7f6e\u5377\u6302\u8f7d\u7684\u8def\u5f84 /opt/data\u4ee3\u8868\u7684\u662f\u65e5\u5fd7\u5b58\u50a8\u8def\u5f84 volumes: - /app/service/eureka/logs:/opt/data # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet ``` \u8fd0\u884c\u547d\u4ee4 sh docker-compose -f docker-compose-eureka.yml up -d \u6f14\u793a\u6548\u679c sh http://172.31.65.26:8761/ \u81ea\u52a8\u6784\u5efaspring cloud \u914d\u7f6e\u4e2d\u5fc3config compose\u5185\u5bb9 ```sh version: '3' services: config-server: container_name: config-server image: registry-docker:5000/config-server:0.0.1-SNAPSHOT ports: - \"9030:9030\" networks: - default networks: default: external: name: dockernet ``` sh docker-compose -f docker-compose-config.yml up -d sh http://172.31.65.26:9030/e-book-product/default \u81ea\u52a8\u6784\u5efaspring cloud \u8c03\u7528\u94fezipkin compose\u5185\u5bb9 ```sh version: '3' services: zipkin-server: container_name: zipkin-server image: registry-docker:5000/zipkin-server:0.0.1-SNAPSHOT ports: - \"9411:9411\" networks: - default networks: default: external: name: dockernet ``` sh docker-compose -f docker-compose-zipkin.yml up -d sh http://172.31.65.26:9411 \u81ea\u52a8\u6784\u5efaspring cloud \u65e5\u5fd7\u7cfb\u7edfELK compose\u5185\u5bb9 ```sh version: '3' services: elasticsearch: container_name: elasticsearch image: docker.elastic.co/elasticsearch/elasticsearch:6.1.1 command: elasticsearch ports: - \"9200:9200\" - \"9300:9300\" privileged: true networks: - default logstash: container_name: logstash image: docker.elastic.co/logstash/logstash:6.1.1 command: logstash -f /etc/logstash/conf.d/logstash.conf volumes: # \u6302\u8f7dlogstash\u914d\u7f6e\u6587\u4ef6 - /app/service/logstash/config:/etc/logstash/conf.d - /app/service/logstash/build/:/opt/build/ ports: - \"6000:5000\" privileged: true networks: - default kibana: container_name: kibana image: docker.elastic.co/kibana/kibana:6.1.1 environment: - ELASTICSEARCH_URL=http://elasticsearch:9200 ports: - \"5601:5601\" privileged: true networks: - default networks: default: external: name: dockernet ``` logstash.conf\u5b58\u653e\u5728/app/service/config\u4e0b sh # For detail structure of this file # Set: https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html input { # For detail config for log4j as input, # See: https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html tcp { mode => \"server\" host => \"logstash\" #logstash\u5bb9\u5668\u540d\u79f0 port => 9250 } } filter { #Only matched data are send to output. } output { # For detail config for elasticsearch as output, # See: https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html elasticsearch { action => \"index\" #The operation on ES hosts => \"elasticsearch:9200\" #ElasticSearch host, can be array. elasticsearch\u5bb9\u5668\u540d\u79f0 index => \"applog\" #The index to write data to. } } \u8fd0\u884c ```sh docker-compose -f docker-compose-elk.yml up -d \u5982\u679celasticsearch \u62a5\u8fd9\u4e2a\u9519\u8bef ERROR: [1] bootstrap checks failed [1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] \u89e3\u51b3\u65b9\u6848\uff1asudo sysctl -w vm.max_map_count=262144 ``` \u6f14\u793a\u6548\u679c ```sh #\u521b\u5efa\u4e00\u4e2a\u7d22\u5f15 curl -XPUT http://172.31.65.26:9200/applog #\u8fdb\u5165elk\u9875\u9762 http://172.31.65.26:5601/app/kibana ``` \u81ea\u52a8\u6784\u5efaproduct \u670d\u52a1 \u7b2c\u4e00\u6b65\uff1a\u81ea\u52a8\u6784\u5efa mysql \u5fae\u670d\u52a1 ```sh # Docker Compose \u914d\u7f6e\u6587\u4ef6\uff0c\u5305\u542b3\u5927\u90e8\u5206 version\u3001services\u3001networks version: '3' services: # \u670d\u52a1\u540d\u79f0 mysql: # \u5bb9\u5668\u540d\u79f0 container_name: mysql # \u955c\u50cf\u540d\u79f0 image: mysql:5.7 # \u66b4\u9732\u7aef\u53e3 ports: - \"3306:3306\" # \u8bbe\u7f6e\u5377\u6302\u8f7d\u8def\u5f84 volumes: - /app/data/mysql:/var/lib/mysql # \u73af\u5883\u53d8\u91cf environment: MYSQL_USER: root MYSQL_PASSWORD: agan MYSQL_ROOT_PASSWORD: agan # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet #\u542f\u52a8mysql\u5bb9\u5668 docker-compose -f docker-compose-mysql.yml up -d ``` \u7b2c\u4e8c\u6b65\uff1a\u81ea\u52a8\u6784\u5efa product \u5fae\u670d\u52a1 ```sh #docker-compose-product.yml version: '3' services: product: container_name: e-book-product image: registry-docker:5000/e-book-product-core:0.0.1-SNAPSHOT ports: - \"8083:8083\" # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet #\u542f\u52a8\u5bb9\u5668 docker-compose -f docker-compose-product.yml up -d ``` \u7b2c\u4e09\u6b65\uff1a\u6f14\u793a\u6548\u679c sh #\u770b\u6ce8\u518c\u4e2d\u5fc3 http://172.31.65.26:8761/ #\u4ea7\u54c1\u67e5\u8be2\u63a5\u53e3 http://172.31.65.26:8083/product/findAllProduct #\u770b\u65e5\u5fd7 http://172.31.65.26:5601/app/kibana #\u8c03\u7528\u94fe http://172.31.65.26:9411/ \u81ea\u52a8\u6784\u5efa\u81ea\u52a8\u6784\u5efa user order trade consumer \u5fae\u670d\u52a1 \u7b2c\u4e00\u6b65\uff1a \u6784\u5efa\u76f8\u5173\u670d\u52a1 ```sh #docker-compose-service.yml version: '3' services: product: container_name: e-book-product image: registry-docker:5000/e-book-product-core:0.0.1-SNAPSHOT ports: - \"8083:8083\" networks: - default user: container_name: e-book-user image: registry-docker:5000/e-book-user-core:0.0.1-SNAPSHOT ports: - \"8084:8084\" networks: - default order: container_name: e-book-order image: registry-docker:5000/e-book-order-core:0.0.1-SNAPSHOT ports: - \"8085:8085\" networks: - default trade: container_name: e-book-trade image: registry-docker:5000/e-book-trade-core:0.0.1-SNAPSHOT ports: - \"8086:8086\" networks: - default consumer: container_name: e-book-consumer-order image: registry-docker:5000/e-book-consumer-order:0.0.1-SNAPSHOT ports: - \"8090:8090\" networks: - default networks: default: external: name: dockernet #\u542f\u52a8\u5bb9\u5668\u547d\u4ee4 docker-compose -f docker-compose-service.yml up -d ``` \u7b2c\u4e8c\u6b65\uff1a\u6f14\u793a\u6548\u679c sh #\u770b\u6ce8\u518c\u4e2d\u5fc3 http://172.31.65.26:8761/ #\u4ea7\u54c1\u67e5\u8be2\u63a5\u53e3 http://172.31.65.26:8083/product/findAllProduct #\u521b\u5efa\u8ba2\u5355 http://172.31.65.26:8090/createOrder #\u770b\u65e5\u5fd7 http://172.31.65.26:5601/app/kibana #\u8c03\u7528\u94fe http://172.31.65.26:9411/ \u81ea\u52a8\u6784\u5efaspring cloud \u7f51\u5173zuul \u7b2c\u4e00\u6b65\uff1a\u6784\u5efazuul\u670d\u52a1 ```sh #docker-compose-zuul.yml version: '3' services: zuul-gateway: container_name: zuul-gateway image: registry-docker:5000/zuul-gateway:0.0.1-SNAPSHOT ports: - \"9010:9010\" # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet #\u542f\u52a8\u5bb9\u5668 docker-compose -f docker-compose-zuul.yml up -d ``` \u7b2c\u4e8c\u6b65\uff1a\u6f14\u793a\u6548\u679c sh http://172.31.65.26:9010/e-book-consumer-order/createOrder http://172.31.65.26:9010/e-book-product/product/findAllProduct","title":"\u4e00\u3001docker\u5165\u95e8"},{"location":"docker/#docker","text":"1\u3001docker\u7684\u5b89\u88c5\u53ca\u5165\u95e8\u793a\u4f8b \u73af\u5883\u51c6\u5907\uff1adocker\u9700\u8981\u5b89\u88c5\u5728centos7 64\u4f4d\u7cfb\u7edf\u4e0a\uff1bdocker\u8981\u6c42\u7cfb\u7edf\u5185\u6838\u57283.10\u4ee5\u4e0a \u67e5\u770b\u7cfb\u7edf\u5185\u6838\uff1a shell uname -r \u5b89\u88c5\u547d\u4ee4\uff1a shell yum -y install docker-io \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u542f\u52a8\u547d\u4ee4 sh service docker start \u5b89\u88c5nginx\u4f53\u9a8c sh docker run -p 80:80 -d nginx 2\u3001docker\u7684\u7406\u8bba\u6982\u5ff5 \u4ec0\u4e48\u662fdocker: \u9cb8\u9c7c\u901a\u8fc7\u8eab\u4e0a\u7684\u96c6\u88c5\u7bb1\uff08Container\uff09\u6765\u5c06\u4e0d\u540c\u79cd\u7c7b\u7684\u8d27\u7269\u8fdb\u884c\u9694\u79bb\uff1b\u800c\u4e0d\u662f\u901a\u8fc7\u751f\u51fa\u5f88\u591a\u5c0f\u9cb8\u9c7c\uff08Guest OS\uff09\u6765\u627f\u8fd0\u4e0d\u540c\u79cd\u7c7b\u7684\u8d27\u7269\u3002Docker\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5e94\u7528\u5bb9\u5668\u5f15\u64ce\uff0c\u57fa\u4e8eGo\u8bed\u8a00 \u5e76\u9075\u5faaApache2.0\u534f\u8bae\u5f00\u6e90\u3002Docker\u53ef\u4ee5\u8ba9\u5f00\u53d1\u8005\u6253\u5305\u4ed6\u4eec\u7684\u5e94\u7528\u4ee5\u53ca\u4f9d\u8d56\u5305\u5230\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u3001\u53ef\u79fb\u690d\u7684\u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u53d1\u5e03\u5230\u4efb\u4f55\u6d41\u884c\u7684Linux\u673a\u5668\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u865a\u62df\u5316\u3002\u5bb9\u5668\u65f6\u5b8c\u5168\u4f7f\u7528\u4f7f\u7528\u6c99\u7bb1\u673a\u5236\uff0c\u76f8\u4e92\u4e4b\u95f4\u4e0d\u4f1a\u6709\u4efb\u4f55\u63a5\u53e3\uff08\u7c7b\u4f3ciPhone\u7684app\uff09\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5bb9\u5668\u6027\u80fd\u5f00\u9500\u6781\u4f4e\u3002 \u7269\u7406\u673a\u3001\u865a\u62df\u673a\u3001docker\u7684\u5f62\u8c61\u5bf9\u6bd4 \u8fd9\u662f\u7269\u7406\u673a\uff1a\u4e00\u680b\u697c\u4e00\u6237\u4eba\u5bb6\u3001\u72ec\u7acb\u57fa\u5730\u3001\u72ec\u7acb\u82b1\u56ed\u3002 \u8fd9\u662f\u865a\u62df\u673a\uff1a\u4e00\u680b\u697c\u5305\u542b\u591a\u5957\u623f\u5b50\uff0c\u4e00\u5957\u623f\u4e00\u6237\u4eba\u5bb6\uff0c\u5171\u4eab\u57fa\u5730\u3001\u5171\u4eab\u82b1\u56ed\uff0c\u72ec\u7acb\u536b\u751f\u95f4\u3001\u53a8\u623f\u3001\u5e26\u5bbd \u8fd9\u662fdokcer\u5bb9\u5668\uff1a\u4e00\u5957\u623f\u9694\u79bb\u6210\u591a\u4e2a\u5c0f\u7a7a\u95f4\u4fd7\u79f0\u80f6\u56ca\u516c\u5bd3\uff0c\u6bcf\u4e2a\u8f83\u5b6c\u4f4f\u4e00\u4e2a\u79df\u5ba2\uff0c\u5171\u4eab\u5730\u57fa\u3001\u82b1\u56ed\u3001\u536b\u751f\u95f4\u3001\u53a8\u623f\u3001\u5e26\u5bbd\u7b49 docker\u548c\u865a\u62df\u673a\u7684\u5bf9\u6bd4 docker \u865a\u62df\u673a \u8fd0\u884c\u73af\u5883 docker\u6784\u5efa\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u6240\u4ee5docker\u751a\u81f3\u53ef\u4ee5\u5728\u865a\u62df\u673a\u4e0a\u8fd0\u884c \u865a\u62df\u5316\u6280\u672f\u4f9d\u8d56\u7269\u7406CPU\u548c\u5185\u5b58\uff0c\u662f\u786c\u4ef6\u7ea7\u522b\u7684 \u9694\u79bb\u6027 docker\u5c5e\u4e8e\u8fdb\u7a0b\u4e4b\u95f4\u7684\u9694\u79bb \u865a\u62df\u673a\u53ef\u4ee5\u5b9e\u73b0\u7cfb\u7edf\u7ea7\u522b\u9694\u79bb \u5b89\u5168\u6027 Docker\u7684\u79df\u6237root\u548c\u5bbf\u4e3b\u673aroot\u7b49\u540c\uff0c\u4e00\u65e6\u5bb9\u5668\u5185\u7684\u7528\u6237\u4ece\u666e\u901a\u7528\u6237\u6743\u9650\u63d0\u5347\u4e3aroot\u6743\u9650\uff0c\u4ed6\u5c31\u76f4\u63a5\u5177\u5907\u4e86\u5bbf\u4e3b\u673a\u7684root\u6743\u9650\uff0c\u8fdb\u800c\u53ef\u8fdb\u884c\u65e0\u9650\u5236\u7684\u64cd\u4f5c\u3002\u6545\uff1adocker\u7684\u5b89\u5168\u6027\u4e5f\u66f4\u5f31 \u865a\u62df\u673a\u79df\u6237root\u6743\u9650\u548c\u5bbf\u4e3b\u673a\u7684root\u865a\u62df\u673a\u6743\u9650\u662f\u5206\u79bb\u7684\uff0c\u5e76\u4e14\u865a\u62df\u673a\u5229\u7528\u786c\u4ef6\u9694\u79bb\uff1a\u5982Intel\u7684VT-d\u548cVT-x\u7684ring-1\u786c\u4ef6\u9694\u79bb\u6280\u672f\uff0c\u8fd9\u79cd\u9694\u79bb\u6280\u672f\u53ef\u4ee5\u9632\u6b62\u865a\u62df\u673a\u7a81\u7834\u548c\u5f7c\u6b64\u4ea4\u4e92\u3002 \u865a\u62df\u673a\u7684\u5b89\u5168\u6027\u9ad8 \u53ef\u7ba1\u7406\u6027 docker\u7684\u96c6\u4e2d\u5316\u7ba1\u7406\u5de5\u5177\u8fd8\u4e0d\u7b97\u6210\u719f \u5404\u79cd\u865a\u62df\u5316\u6280\u672f\u90fd\u6709\u6210\u719f\u7684\u7ba1\u7406\u5de5\u5177\uff0c\u4f8b\u5982VMware vCenter\u63d0\u4f9b\u5b8c\u5907\u7684\u865a\u62df\u673a\u7ba1\u7406\u80fd\u529b\u3002 \u5feb\u901f\u521b\u5efa\u3001\u5220\u9664 Docker\u5bb9\u5668\u521b\u5efa\u662f\u79d2\u7ea7\u522b\u7684\uff0cDocker\u7684\u5feb\u901f\u8fed\u4ee3\u6027\uff0c\u51b3\u5b9a\u4e86\u65e0\u8bba\u662f\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u90e8\u7f72\u90fd\u53ef\u4ee5\u8282\u7ea6\u5927\u91cf\u65f6\u95f4\u3002 \u865a\u62df\u5316\u521b\u5efa\u65f6\u5206\u949f\u7ea7\u522b\u7684 \u4ea4\u4ed8\u3001\u90e8\u7f72 Docker\u5728Dockerfile\u4e2d\u8bb0\u5f55\u4e86\u5bb9\u5668\u6784\u5efa\u8fc7\u7a0b\uff0c\u53ef\u5728\u96c6\u7fa4\u4e2d\u5b9e\u73b0\u5feb\u901f\u5206\u53d1\u548c\u5feb\u901f\u90e8\u7f72\uff1b \u865a\u62df\u673a\u53ef\u4ee5\u901a\u8fc7\u955c\u50cf\u5b9e\u73b0\u73af\u5883\u4ea4\u4e92\u7684\u4e00\u81f4\u6027\uff0c\u4f46\u955c\u50cf\u5206\u53d1\u65e0\u6cd5\u4f53\u7cfb\u5316\uff1b docker\u7684\u67b6\u6784\u539f\u7406 server daemon: docker server\u662f\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5b83\u53ef\u4ee5\u90e8\u7f72\u8fdc\u7a0b\u4e5f\u53ef\u4ee5\u90e8\u7f72\u672c\u5730\u3002\u5b83\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u7f51\u7edcnetwork\u548c\u78c1\u76d8data volumes REST API: \u5b9e\u73b0client\u548cserver\u95f4\u901a\u4fe1\u4ea4\u4e92\u534f\u8bae CLI(command line interface): docker client, \u5b83\u5305\u62ec\u4e24\u90e8\u5206\u5bb9\u5668\u548c\u955c\u50cf\uff0c1\u4e2a\u955c\u50cf\u53ef\u4ee5\u521b\u5efaN\u4e2a\u5bb9\u5668 Image: \u4e00\u4e2a\u53ea\u8bfb\u7684\u955c\u50cf\u6a21\u677f\u3002\u53ef\u4ee5\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u955c\u50cf\u4e5f\u53ef\u4ee5\u4ece\u7f51\u7ad9\u4e0a\u4e0b\u8f7d\u955c\u50cf\u4f9b\u81ea\u5df1\u4f7f\u7528\u3002 Container: \u7531docker client\u901a\u8fc7\u955c\u50cf\u521b\u5efa\u7684\u5b9e\u4f8b\uff0c\u7528\u6237\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u5e94\u7528\uff0c\u4e00\u65e6\u521b\u5efa\u540e\u5c31\u53ef\u4ee5\u770b\u505a\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6bcf\u4e2a\u5e94\u7528\u8fd0\u884c\u5728\u9694\u79bb\u7684\u5bb9\u5668\u4e2d\uff0c\u4eab\u7528\u72ec\u81ea\u7684\u6743\u9650\u3001\u7528\u6237\u3001\u7f51\u7edc\u3002 Registry: \u955c\u50cf\u4ed3\u5e93\uff0c\u7528\u6765\u5b58\u50a8\u548c\u7ba1\u7406image\u955c\u50cf\uff0c\u76ee\u524d\u4e3b\u6d41\u7684\u4ed3\u5e93\u6709Docker hub\u3001\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u3001\u4e5f\u53ef\u4ee5\u81ea\u5df1\u521b\u5efa\u4ed3\u5e93\u6765\u7ba1\u7406\u3002 \u8bf4\u660e\uff1a docker client \u901a\u8fc73\u4e2a\u547d\u4ee4\uff0c\u5148\u5230docker daemon pull\u62c9\u53d6images\uff0c\u5982\u679c\u670d\u52a1\u5668\u7aef\u6ca1\u6709\uff0c\u5148\u5230\u4ed3\u5e93\u62c9\u53d6\uff0c\uff08\u5982\u679c\u4ed3\u5e93\u6ca1\u6709\uff0c\u4f60\u53ef\u4ee5build\u81ea\u5efaimages\uff09;\u6700\u540e\u901a\u8fc7run\u547d\u4ee4\u521b\u5efa\u5bb9\u5668","title":"\u4e00\u3001docker\u5165\u95e8"},{"location":"docker/#_1","text":"1\u3001\u4ec0\u4e48\u662f\u955c\u50cf \u4e00\u4e2a\u53ea\u8bfb\u7684\u6a21\u677f\uff0c\u5c31\u662f\u4e00\u4e2adockerfile\uff0c\u53ef\u4ee5\u5728\u955c\u50cf\u4ed3\u5e93\u4e0a\u4f20\u6216\u8005\u4e0b\u8f7d \u5148\u6709\u955c\u50cf\uff0c\u540e\u6709\u5bb9\u5668\uff1b\u5e76\u4e14\u4e00\u4e2a\u955c\u50cf\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u5bb9\u5668 docker\u5bb9\u5668\u6700\u5927\u7684\u7279\u70b9\uff1a\u5206\u5c42\u7ed3\u6784 \u6700\u5e95\u5c42\u662f\u4e00\u4e2abase\u5c42\uff0c\u4e5f\u5373\u662f\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5c42\u3002\u5b83\u8fd8\u4f1a\u4ecebase\u5c42\u4e00\u5c42\u5c42\u7684\u53e0\u52a0\u751f\u6210\uff08\u4ec0\u4e48\u662f\u5c42\u5c42\u53e0\u52a0\uff1f \u4f8b\u5982\uff0c\u5b89\u88c5\u4e00\u4e2a\u8f6f\u4ef6\uff0c\u4ed6\u5c31\u4f1a\u5728base\u5c42\u7684\u57fa\u7840\u4e0a\u8ffd\u52a0\u4e00\u5c42\u3002\u5b83\u7684\u597d\u5904\u5c31\u662f\u8d44\u6e90\u5171\u4eab\uff09\u3002 2\u3001\u955c\u50cf\u76f8\u5173\u547d\u4ee4 \u67e5\u770bdocker\u672c\u5730\u7684\u955c\u50cf sh docker images \u641c\u7d22\u4e00\u4e2a\u955c\u50cf sh docker search mysql INDEX: \u4ed3\u5e93\u5730\u5740 NAME: \u4ed3\u5e93+\u540d\u79f0 STARS: \u7528\u6237\u7684\u559c\u6b22\u7a0b\u5ea6 OFFICIAL: \u662f\u5426\u5b98\u65b9\uff0c\u5982\u679c\u4e3aOK\u7684\u8bdd\u4ee3\u8868\u5b98\u65b9\uff0c\u53ef\u4fe1\u5ea6\u9ad8\uff0c\u653e\u5fc3\u4f7f\u7528; AUTOMATED: \u662f\u5426\u4e3a\u516c\u5f00\u7684dockerfile\u811a\u672c\u5236\u6210\u7684\uff1f\u4e5f\u5373\u662f\u8bf4dockerfile\u662f\u5426\u63d0\u4f9b\u3002 \u4e0b\u8f7d\u4e00\u4e2a\u955c\u50cf sh docker pull mysql:5.7 \u4e0b\u8f7d\u5b8c\u540e\uff0c\u67e5\u770b\u662f\u5426\u5728\u672c\u5730docker images \u5220\u9664docker\u955c\u50cf sh docker rmi [imageID] # \u5982\u679c\u8981\u5220\u9664\u5168\u90e8\u955c\u50cf docker rmi $(docker images -q) \u52a0\u901f\u5668\u7684\u914d\u7f6e sh #centos\u7684\u963f\u91cc\u52a0\u901f\u5668\u547d\u4ee4 mkdir -p /etc/docker tee /etc/docker/daemon.json <<-'EOF' { \"registry-mirrors\": [\"https://uqxmqcrw.mirror.aliyuncs.com\"] } EOF systemctl daemon-reload systemctl restart docker 3\u3001dockerfile \u6982\u5ff5 dockefile\u662f\u4e00\u4e2a\u6587\u672c\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5b83\u53ef\u4ee5\u5feb\u901f\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u955c\u50cf\uff0c\u6587\u672c\u5185\u5bb9\u5305\u542b\u4e86\u82e5\u5e72\u7684\u547d\u4ee4\u884c\uff0c\u5e76\u652f\u6301#\u4f5c\u4e3a\u6ce8\u91ca\u884c\uff0c\u6587\u672c\u683c\u5f0f\u5305\u542b\u57fa\u7840\u955c\u50cfFROM\uff0c\u7ef4\u62a4\u8005MAINTAINER\uff0c\u64cd\u4f5c\u6307\u4ee4ADD\uff0c\u5bb9\u5668\u542f\u52a8\u540e\u6307\u4ee4\u7b49\u5171\u8ba14\u90e8\u5206 dockerfile \u6587\u4ef6\u793a\u4f8b ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER tang #3.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD eureka-server-0.0.1-SNAPSHOT.jar /app/service/eureka/data/app.jar #\u544a\u8bc9docker\u5bb9\u5668\u66b4\u9732\u7aef\u53e3\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7-p \u505a\u7aef\u53e3\u6620\u5c04 EXPOSE 8761 #5.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/eureka/data/app.jar\"] ``` \u6784\u5efadocker\u955c\u50cf ```sh #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-jackly/eureka-server:1.0.0 . ``` \u67e5\u770b\u548c\u8fd0\u884c\u955c\u50cf\u5bb9\u5668 ```sh #\u67e5\u770b\u672c\u5730\u955c\u50cf docker images #\u542f\u52a8\u955c\u50cf docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:1.0.0 ```","title":"\u4e8c\u3001\u955c\u50cf\u7ba1\u7406"},{"location":"docker/#_2","text":"1\u3001\u5efa\u8bbedockerhub\u5b98\u65b9\u4ed3\u5e93 \u4ec0\u4e48\u662f\u955c\u50cf\u4ed3\u5e93 \u5c31\u662f\u5b58\u653e\u955c\u50cf\u7684\u5730\u65b9 \u63a8\u9001\u955c\u50cf\u5230dockerhub(\u9700\u7ffb\u5899) ```sh \u2460\u3001\u767b\u5f55 https://hub.docker.com/\uff0c\u521b\u5efa\u4e00\u4e2aeureka-server\u4ed3\u5e93 \u2461\u3001\u672c\u5730linux\u767b\u5f55docker\u5b98\u65b9\uff0c docker login \u2462\u3001\u6539\u955c\u50cf\u7684\u540d\uff0c\uff08\u4e3a\u4ec0\u4e48\u8981\u6539\uff1f\u56e0\u4e3adocker\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93\u662f\u4ee5 \u7528\u6237\u540d \u6765\u547d\u540d\u4ed3\u5e93\u7684\uff09 docker tag registry-jackly/eureka-server:1.0.0 jacklydocker/eureka-server:1.0.0 \u2463\u3001\u63a8\u9001\u955c\u50cf\u5230\u5b98\u65b9\u4ed3\u5e93 docker push jacklydocker/eureka-server:1.0.0 \u2464\u3001\u62c9\u53d6\u4e0a\u4f20\u7684\u955c\u50cf \u5148\u5220\u9664\u65e7\u955c\u50cf:docker rmi jacklydocker/eureka-server:1.0.0 \u62c9\u53d6\u955c\u50cf\uff1adocker pull jacklydocker/eureka-server:1.0.0 \u521b\u5efa\u5bb9\u5668\uff1adocker run -d -p 8761:8761 --name=eureka docker.io/jacklydocker/eureka-server:1.0.0 ``` 2\u3001\u5efa\u8bbe\u963f\u91cc\u4e91docker\u4ed3\u5e93 \u63a8\u9001\u955c\u50cf\u5230\u963f\u91cc\u4e91\u4ed3\u5e93 ```sh \u2460\u3001\u767b\u5f55\u963f\u91cc\u4e91\uff0c\u5148\u521b\u5efa\u547d\u540d\u7a7a\u95f4\uff0c\u5e76\u5efa\u4e2a\u955c\u50cf\u4ed3\u5e93 \u2461\u3001\u672c\u5730linux\u767b\u5f55\u767b\u5f55\u963f\u91cc\u4e91Docker Registry\uff0c docker login --username=\u4f60\u7684\u7528\u6237\u540d registry.cn-shenzhen.aliyuncs.com \u2462\u3001\u6539\u955c\u50cf\u7684\u540d\uff0c\uff08\u4e3a\u4ec0\u4e48\u8981\u6539\uff1f\u56e0\u4e3aaliyun docker\u955c\u50cf\u4ed3\u5e93\u662f\u4ee5 \u7528\u6237\u540d \u6765\u547d\u540d\u4ed3\u5e93\u7684\uff09 docker tag 58acc264425c registry.cn-shenzhen.aliyuncs.com/jackly/eureka-server:1.0.0 \u2463\u3001\u63a8\u9001\u955c\u50cf\u5230\u963f\u91cc\u4e91\u4ed3\u5e93 docker push registry.cn-shenzhen.aliyuncs.com/jackly/eureka-server:1.0.0 \u2464\u3001\u62c9\u53d6\u4e0a\u4f20\u7684\u955c\u50cf docker pull registry.cn-shenzhen.aliyuncs.com/jackly/eureka-server:1.0.0 ``` 3\u3001\u5efa\u8bbe\u672c\u5730\u4ed3\u5e93 \u4e3a\u4ec0\u4e48\u9700\u8981\u642d\u5efa\u672c\u5730\u4ed3\u5e93 \u8282\u7ea6\u5e26\u5bbd\uff1a\u56e0\u4e3a\u5982\u679c\u7528docker\u6216\u8005\u963f\u91cc\u4e91\u5b98\u65b9\u7684\u4ed3\u5e93\u8d70\u7684\u4e92\u8054\u7f51 \u6d6a\u8d39\u5e26\u5bbd\uff0c\u800c\u4e14\u6162\u3002 \u63d0\u4f9b\u8d44\u6e90\u5229\u7528\u548c\u5b89\u5168\uff1a\u56e0\u4e3a\u516c\u53f8\u5185\u90e8\u7684\u955c\u50cf\uff0c\u63a8\u9001\u5230\u672c\u5730\u4ed3\u5e93\uff0c\u66f4\u65b9\u4fbf\u516c\u53f8\u5185\u90e8\u4eba\u7528\uff0c\u800c\u4e14\u5b89\u5168\u6027\u9ad8 \u521b\u5efa\u4ed3\u5e93\u5bb9\u5668 sh #\u67e5\u627e\u5b98\u65b9\u4ed3\u5e93 docker search registry #\u62c9\u53d6\u4ed3\u5e93\u955c\u50cf docker pull registry #\u8fd0\u884c\u4ed3\u5e93\u5bb9\u5668 docker run -d -p 5000:5000 \\ --restart=always \\ --privileged=true \\ --name=registry-local-jackly \\ -v /date/volume/registry:/var/lib/registry \\ registry \u63a8\u9001\u955c\u50cf\u5230\u672c\u5730\u79c1\u6709\u4ed3\u5e93 sh \u2460\u3001\u6539\u955c\u50cf\u7684\u540d docker tag 58acc264425c reg.qxbdocker.com:5000/eureka-server:1.0.0 \u2461\u3001\u63a8\u9001\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93(\u6ce8\u610f\uff1a\u8bb0\u5f97\u6539\u672c\u5730hosts\uff1a127.0.0.1 reg.qxbdocker.com) docker push reg.qxbdocker.com:5000/eureka-server:1.0.0 \u2462\u3001\u67e5\u770b\u642d\u5efa\u4ed3\u5e93\u7684\u4fe1\u606f \u67e5\u770b\u4ed3\u5e93\u7684\u955c\u50cf\uff1a curl -X GET http://127.0.0.1:5000/v2/_catalog \u4ed3\u5e93\u67d0\u4e2a\u955c\u50cf\u7684\u7248\u672c\u4fe1\u606f\uff1a curl -X GET http://127.0.0.1:5000/v2/eureka-server/tags/list \u2464\u3001\u62c9\u53d6\u4e0a\u4f20\u7684\u955c\u50cf #\u5148\u5220\u9664\u672c\u5730\u955c\u50cf docker rmi reg.qxbdocker.com:5000/eureka-server:1.0.0 #\u5728\u62c9\u53d6\u4ed3\u5e93\u4e2d\u7684\u955c\u50cf docker pull reg.qxbdocker.com:5000/eureka-server:1.0.0","title":"\u4e09\u3001\u955c\u50cf\u4ed3\u5e93\u7ba1\u7406"},{"location":"docker/#_3","text":"1\u3001\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u5b9e\u8df5 \u4ec0\u4e48\u662f\u5bb9\u5668 \u5bb9\u5668\u7c7b\u4f3c\u4e8e\u80f6\u56ca\u516c\u5bd3\uff0c\u5b83\u662f\u4e00\u4e2a\u7cbe\u7b80\u7248\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e00\u822c\u5bb9\u5668\u4e2d\u53ea\u8fd0\u884c\u4e00\u4e2a\u5e94\u7528\uff08\u4f8b\u5982\uff1aeureka-server\u955c\u50cf\uff09\u3002 \u5982\u4f55\u521b\u5efa\u5bb9\u5668 \u901a\u8fc7\u955c\u50cf\u521b\u5efa\u5bb9\u5668\uff0c\u901a\u8fc7docker run\u547d\u4ee4\u521b\u5efa\u3002 \u5bb9\u5668\u7684\u4f5c\u7528 \u5bb9\u5668\u8d77\u5230\u4e86\u9694\u79bb\u7684\u4f5c\u7528\uff0c\u72ec\u4eab\u7a7a\u95f4\u3001\u7f51\u7edc\u7b49\u7b49\u3002 doker\u547d\u4ee4 sh docker run --help -d, --detach=false \u6307\u5b9a\u5bb9\u5668\u8fd0\u884c\u4e8e\u524d\u53f0\u8fd8\u662f\u540e\u53f0\uff0c\u9ed8\u8ba4\u4e3afalse -i, --interactive=false \u6253\u5f00STDIN\uff0c\u7528\u4e8e\u63a7\u5236\u53f0\u4ea4\u4e92 -t, --tty=false \u5206\u914dtty\u8bbe\u5907\uff0c\u8be5\u53ef\u4ee5\u652f\u6301\u7ec8\u7aef\u767b\u5f55\uff0c\u9ed8\u8ba4\u4e3afalse -u, --user=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u7528\u6237 -a, --attach=[] \u767b\u5f55\u5bb9\u5668\uff08\u5fc5\u987b\u662f\u4ee5docker run -d\u542f\u52a8\u7684\u5bb9\u5668\uff09 -w, --workdir=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55 -c, --cpu-shares=0 \u8bbe\u7f6e\u5bb9\u5668CPU\u6743\u91cd\uff0c\u5728CPU\u5171\u4eab\u573a\u666f\u4f7f\u7528 -e, --env=[] \u6307\u5b9a\u73af\u5883\u53d8\u91cf\uff0c\u5bb9\u5668\u4e2d\u53ef\u4ee5\u4f7f\u7528\u8be5\u73af\u5883\u53d8\u91cf -m, --memory=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u5185\u5b58\u4e0a\u9650 -P, --publish-all=false \u6307\u5b9a\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3 -p, --publish=[] \u6307\u5b9a\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3 -h, --hostname=\"\" \u6307\u5b9a\u5bb9\u5668\u7684\u4e3b\u673a\u540d -v, --volume=[] \u7ed9\u5bb9\u5668\u6302\u8f7d\u5b58\u50a8\u5377\uff0c\u6302\u8f7d\u5230\u5bb9\u5668\u7684\u67d0\u4e2a\u76ee\u5f55 --volumes-from=[] \u7ed9\u5bb9\u5668\u6302\u8f7d\u5176\u4ed6\u5bb9\u5668\u4e0a\u7684\u5377\uff0c\u6302\u8f7d\u5230\u5bb9\u5668\u7684\u67d0\u4e2a\u76ee\u5f55 --cap-add=[] \u6dfb\u52a0\u6743\u9650\uff0c\u6743\u9650\u6e05\u5355\u8be6\u89c1:http://linux.die.net/man/7/capabilities --cap-drop=[] \u5220\u9664\u6743\u9650\uff0c\u6743\u9650\u6e05\u5355\u8be6\u89c1:http://linux.die.net/man/7/capabilities --cidfile=\"\" \u8fd0\u884c\u5bb9\u5668\u540e\uff0c\u5728\u6307\u5b9a\u6587\u4ef6\u4e2d\u5199\u5165\u5bb9\u5668PID\u503c\uff0c\u4e00\u79cd\u5178\u578b\u7684\u76d1\u63a7\u7cfb\u7edf\u7528\u6cd5 --cpuset=\"\" \u8bbe\u7f6e\u5bb9\u5668\u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9bCPU\uff0c\u6b64\u53c2\u6570\u53ef\u4ee5\u7528\u6765\u5bb9\u5668\u72ec\u5360CPU --device=[] \u6dfb\u52a0\u4e3b\u673a\u8bbe\u5907\u7ed9\u5bb9\u5668\uff0c\u76f8\u5f53\u4e8e\u8bbe\u5907\u76f4\u901a --dns=[] \u6307\u5b9a\u5bb9\u5668\u7684dns\u670d\u52a1\u5668 --dns-search=[] \u6307\u5b9a\u5bb9\u5668\u7684dns\u641c\u7d22\u57df\u540d\uff0c\u5199\u5165\u5230\u5bb9\u5668\u7684/etc/resolv.conf\u6587\u4ef6 --entrypoint=\"\" \u8986\u76d6image\u7684\u5165\u53e3\u70b9 --env-file=[] \u6307\u5b9a\u73af\u5883\u53d8\u91cf\u6587\u4ef6\uff0c\u6587\u4ef6\u683c\u5f0f\u4e3a\u6bcf\u884c\u4e00\u4e2a\u73af\u5883\u53d8\u91cf --expose=[] \u6307\u5b9a\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3\uff0c\u5373\u4fee\u6539\u955c\u50cf\u7684\u66b4\u9732\u7aef\u53e3 --link=[] \u6307\u5b9a\u5bb9\u5668\u95f4\u7684\u5173\u8054\uff0c\u4f7f\u7528\u5176\u4ed6\u5bb9\u5668\u7684IP\u3001env\u7b49\u4fe1\u606f --lxc-conf=[] \u6307\u5b9a\u5bb9\u5668\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u6709\u5728\u6307\u5b9a--exec-driver=lxc\u65f6\u4f7f\u7528 --name=\"\" \u6307\u5b9a\u5bb9\u5668\u540d\u5b57\uff0c\u540e\u7eed\u53ef\u4ee5\u901a\u8fc7\u540d\u5b57\u8fdb\u884c\u5bb9\u5668\u7ba1\u7406\uff0clinks\u7279\u6027\u9700\u8981\u4f7f\u7528\u540d\u5b57 --net=\"bridge\" \u5bb9\u5668\u7f51\u7edc\u8bbe\u7f6e: bridge \u4f7f\u7528docker daemon\u6307\u5b9a\u7684\u7f51\u6865 host //\u5bb9\u5668\u4f7f\u7528\u4e3b\u673a\u7684\u7f51\u7edc container:NAME_or_ID >//\u4f7f\u7528\u5176\u4ed6\u5bb9\u5668\u7684\u7f51\u8def\uff0c\u5171\u4eabIP\u548cPORT\u7b49\u7f51\u7edc\u8d44\u6e90 none \u5bb9\u5668\u4f7f\u7528\u81ea\u5df1\u7684\u7f51\u7edc\uff08\u7c7b\u4f3c--net=bridge\uff09\uff0c\u4f46\u662f\u4e0d\u8fdb\u884c\u914d\u7f6e --privileged=false \u6307\u5b9a\u5bb9\u5668\u662f\u5426\u4e3a\u7279\u6743\u5bb9\u5668\uff0c\u7279\u6743\u5bb9\u5668\u62e5\u6709\u6240\u6709\u7684capabilities --restart=\"no\" \u6307\u5b9a\u5bb9\u5668\u505c\u6b62\u540e\u7684\u91cd\u542f\u7b56\u7565: no\uff1a\u5bb9\u5668\u9000\u51fa\u65f6\u4e0d\u91cd\u542f on-failure\uff1a\u5bb9\u5668\u6545\u969c\u9000\u51fa\uff08\u8fd4\u56de\u503c\u975e\u96f6\uff09\u65f6\u91cd\u542f always\uff1a\u5bb9\u5668\u9000\u51fa\u65f6\u603b\u662f\u91cd\u542f --rm=false \u6307\u5b9a\u5bb9\u5668\u505c\u6b62\u540e\u81ea\u52a8\u5220\u9664\u5bb9\u5668(\u4e0d\u652f\u6301\u4ee5docker run -d\u542f\u52a8\u7684\u5bb9\u5668) --sig-proxy=true \u8bbe\u7f6e\u7531\u4ee3\u7406\u63a5\u53d7\u5e76\u5904\u7406\u4fe1\u53f7\uff0c\u4f46\u662fSIGCHLD\u3001SIGSTOP\u548cSIGKILL\u4e0d\u80fd\u88ab\u4ee3\u7406 docker\u521b\u5efa\u793a\u4f8b sh docker run -d -p 5000:5000 \\ --restart=always \\ --privileged=true \\ --name=registry-local-jackly \\ -v /date/volume/registry:/var/lib/registry \\ registry docker \u5e38\u7528\u547d\u4ee4 sh #\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668 docker ps #\u67e5\u770b\u6240\u6709\u7684\u5bb9\u5668(\u5305\u62ec\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668) docker ps -a #\u505c\u6b62\u5bb9\u5668 docker stop \u5bb9\u5668ID #\u5f3a\u5236\u505c\u6b62\u5bb9\u5668 docker kill \u5bb9\u5668ID #\u542f\u52a8\u5bb9\u5668 docker start \u5bb9\u5668ID #\u91cd\u542f\u5bb9\u5668 docker restart \u5bb9\u5668ID #\u5220\u9664\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668 docker rm \u5bb9\u5668ID #\u5220\u9664\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u5f3a\u5236\u5220\u9664 docker rm -f \u5bb9\u5668ID 2\u3001\u5982\u4f55\u8fdb\u5165\u5bb9\u5668\u5185\u90e8 \u8fdb\u5165\u5bb9\u5668\u7684\u65b9\u5f0f \u67094\u79cd\u65b9\u5f0f\u80fd\u8fdb\u5165\u5bb9\u5668\uff0c\u5206\u522b\u662fexec\u3001docker attach\u3001ssh\u3001nsenter. \u8fd94\u79cd\u90fd\u80fd\u8fdb\u5165\u5bb9\u5668\uff0c\u4f46\u662f\u6700\u597d\u7528\u6700\u5e38\u7528\u7684\u662fexec exec\u547d\u4ee4 sh docker exec --help -d \u4ee5\u540e\u53f0\u65b9\u5f0f\u6267\u884c\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u6267\u884c\u5b8c\u8fd9\u6761\u547d\u4ee4\uff0c\u8fd8\u53ef\u4ee5\u5e72\u5176\u4ed6\u4e8b\u60c5\uff0c\u5199\u811a\u672c\u6700\u5e38\u7528 -e \u4ee3\u8868\u73af\u5883\u53d8\u91cf -i \u4ee5\u4ea4\u4e92\u65b9\u5f0f\u8fd0\u884c\uff0c\u662f\u963b\u585e\u5f0f\u7684 -t \u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff0c\u8fd9\u4e2a\u53c2\u6570\u901a\u5e38\u4e0e-i\u53c2\u6570\u4e00\u8d77\u4f7f\u7528\uff0c\u7136\u540e\u5728\u540e\u9762\u8ddf\u4e0a\u5bb9\u5668\u91cc\u7684/bin/bash\uff0c\u8fd9\u6837\u5c31\u628a\u6211\u4eec\u5e26\u5230\u5bb9\u5668\u91cc\u53bb\u4e86\u3002 -u \u6307\u5b9a\u8fdb\u5165\u7684\u5bb9\u5668\u4ee5\u54ea\u4e2a\u7528\u6237\u767b\u9646\uff0c\u9ed8\u8ba4\u662froot \u8fdb\u5165\u5bb9\u5668\u547d\u4ee4 sh #\u542f\u52a8\u955c\u50cf\uff0c\u82e5\u955c\u50cf\u5bb9\u5668\u5df2\u7ecf\u521b\u5efa\uff0c\u5219\u901a\u8fc7docker ps -a\u67e5\u8be2\u505c\u6b62\u7684\u5bb9\u5668id\uff0c\u5728\u901a\u8fc7docker start \u5bb9\u5668ID \u542f\u52a8\u5bb9\u5668 docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:1.0.0 #\u8fdb\u5165\u5bb9\u5668\u7684\u76f8\u5173\u547d\u4ee4 docker exec -it eureka sh #\u8fdb\u5165\u540e\u53ef\u4ee5\u4f7f\u7528ls\u67e5\u770b\u76ee\u5f55\uff08/app/service/eureka/data/app.jar\uff09 docker exec -it eureka /bin/bash docker exec -it eureka pwd docker exec -it eureka top 3\u3001\u5bb9\u5668\u5185\u90e8\u6539\u53d8\u540e\uff0c\u80fd\u5426\u91cd\u65b0\u751f\u6210\u955c\u50cf \u4f7f\u7528ll\u547d\u4ee4\u9a8c\u8bc1 sh \u2460\u3001\u8fdb\u5165\u5bb9\u5668\uff1a docker exec -it eureka /bin/bash \u2461\u3001\u4fee\u6539\u5bb9\u5668\u5185\u5bb9\uff1aecho \"alias ll='ls -l'\" >> ~/.bashrc && source ~/.bashrc \u2462\u3001\u9a8c\u8bc1ll\u547d\u4ee4: ll \u2463\u3001\u5f3a\u5236\u5220\u9664\u5bb9\u5668\uff1adocker rm -f \u5bb9\u5668ID \u2464\u3001\u542f\u52a8\u955c\u50cf\u5bb9\u5668\uff1adocker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:1.0.0 \u2465\u3001\u8fdb\u5165\u5bb9\u5668\u4f7f\u7528ll\u547d\u4ee4\uff1a\u53d1\u73b0\u5148\u524d\u4fee\u6539\u7684\u5b9e\u6548 \u4fee\u6539\u5bb9\u5668\u540e\uff0c\u91cd\u65b0\u751f\u6210\u955c\u50cf sh \u2460\u3001\u8fdb\u5165\u5bb9\u5668\uff1adocker exec -it eureka /bin/bash \u2461\u3001\u4fee\u6539\u5bb9\u5668\u5185\u5bb9\uff1aecho \"alias ll='ls -l'\" >> ~/.bashrc && source ~/.bashrc \u2462\u3001\u9a8c\u8bc1ll\u547d\u4ee4:ll #\u751f\u6210\u955c\u50cf\u547d\u4ee4 docker commit --help -a \u7528\u6765\u6307\u5b9a\u4f5c\u8005 -c \u4f7f\u7528Dockerfile\u6307\u4ee4\u6765\u521b\u5efa\u955c\u50cf -m \u63cf\u8ff0\u6211\u4eec\u6b64\u6b21\u521b\u5efaimage\u7684\u4fe1\u606f -p \u5728commit\u65f6\uff0c\u5c06\u5bb9\u5668\u6682\u505c \u2463\u3001\u91cd\u65b0\u751f\u6210\u955c\u50cf docker commit -m=\"add ll\" --author=\"jackly\" eureka registry-jackly/eureka-server:2.0.0 \u2464\u3001\u542f\u52a8\u65b0\u955c\u50cf docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:2.0.0","title":"\u56db\u3001\u5bb9\u5668\u7ba1\u7406"},{"location":"docker/#_4","text":"1\u3001\u5916\u90e8\u7f51\u7edc\u5982\u4f55\u8bbf\u95ee\u5bb9\u5668\u5e94\u7528 \u5916\u90e8\u8bbf\u95ee\u5bb9\u5668\u5e94\u7528\uff0c\u662f\u901a\u8fc7\u7aef\u53e3\u6765\u5b9e\u73b0\u7684 sh #\u53c2\u6570-p\uff0c\u6307\u5b9a\u7aef\u53e3\uff0c\u5176\u4e2d 8080\u662f\u5bbf\u4e3b\u673a\u7684\u7aef\u53e3\uff0c80\u662f\u5bb9\u5668\u7684\u7aef\u53e3 docker run -d -p 8080:80 nginx #\u53c2\u6570-P\uff08\u5927\u5199\uff09\uff0c\u968f\u673a\u7aef\u53e3\uff0c\u968f\u673a\u8303\u56f4 32769-60999 docker run -d -P nginx dockerfile\u7684\u7aef\u53e3\u5b9e\u73b0\u89c4\u5219 1.\u5f00\u653eEXPOSE 8761 SH #\u53c2\u6570-p\uff0c\u6307\u5b9a\u7aef\u53e3 docker run -d -p 8761:8761 --name=eureka registry-agan/eureka-server:1.0.0 #\u53c2\u6570-P\uff0c\u968f\u673a\u7aef\u53e3\uff08 \u8fbe\u5230\u7684\u6548\u679c\u662f0.0.0.0:32771->8761\uff09 docker run -d -P --name=eureka registry-jackly/eureka-server:2.0.0 2.\u6ca1\u6709\u5f00\u653eEXPOSE8761 SH #\u53c2\u6570-p\uff0c\u6307\u5b9a\u7aef\u53e3(\u6548\u679c\uff1a\u6b63\u5e38) docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:2.0.0 #\u53c2\u6570-P\uff0c\u968f\u673a\u7aef\u53e3\uff08 \u8fbe\u5230\u7684\u6548\u679c\u662f\uff0c\u65e0\u7aef\u53e3\u53f7\uff0c\u8fde\u5185\u90e8\u5bb9\u5668\u90fd\u6ca1\u6709\u7aef\u53e3\uff09 docker run -d -P --name=eureka registry-jackly/eureka-server:2.0.0 2\u3001\u5982\u4f55\u5b9e\u73b0\u5bb9\u5668\u4e4b\u95f4\u7684\u7f51\u7edc\u901a\u4fe1 \u4e1a\u52a1\u573a\u666f\u4e3a4\u4e2a\u5bb9\u5668 mysql\u3001eureka\u3001product\u3001config \u5b89\u88c5mysql sh #\u542f\u52a8mysql\u5bb9\u5668 docker run -p 3306:3306 --name mysql \\ -e MYSQL_ROOT_PASSWORD=agan \\ -d mysql:5.7 #\u8fdb\u5165mysql\u5bb9\u5668 docker exec -it mysql /bin/bash #docker\u955c\u50cf\u6ca1\u6709ifconfig\u3001ping\u6307\u4ee4 apt-get update apt install net-tools # ifconfig apt install iputils-ping # ping \u521b\u5efaeureka\u5bb9\u5668 sh docker run -d -p 8761:8761 --name=eureka registry-jackly/eureka-server:2.0.0 \u90e8\u7f72config\u955c\u50cf\u548c\u5bb9\u5668 ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER jackly #3.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD config-server-0.0.1-SNAPSHOT.jar /app/service/config/data/app.jar #5.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/config/data/app.jar\"] ``` \u6784\u5efa\u955c\u50cf sh #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-jackly/config-server:1.0.0 . \u521b\u5efa\u5bb9\u5668 sh #\u67e5\u770b\u672c\u5730\u955c\u50cf docker images #\u542f\u52a8\u955c\u50cf link eureka:jacklyureka==>link \u5bb9\u5668\u540d\u79f0\uff1a\u522b\u540d\uff08\u5c06\u914d\u7f6e\u4e2d\u5fc3\u670d\u52a1\u6ce8\u518c\u5230eureka\uff09 docker run -d -p 9030:9030 --name config \\ --link eureka:jacklyureka \\ registry-jackly/config-server:1.0.0 #\u67e5\u770bconfig\u4fe1\u606f http://172.31.65.26:9030/e-book-product/deauflt \u90e8\u7f72product\u955c\u50cf\u548c\u5bb9\u5668 ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER jackly #3.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD e-book-product-core-0.0.1-SNAPSHOT.jar /app/service/product/data/app.jar #5.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/product/data/app.jar\"] ``` \u6784\u5efa\u955c\u50cf ```sh #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-jackly/product-server:1.0.0 . ``` \u521b\u5efa\u5bb9\u5668 sh #\u67e5\u770b\u672c\u5730\u955c\u50cf docker images #\u542f\u52a8\u955c\u50cf \u6ce8\uff1alink\u5c31\u662f\u5bb9\u5668\u76f4\u63a5\u7684\u8fde\u63a5\uff0c\u4f60\u4e0d\u7528IP\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u901a\u8fc7link\u6765\u5b9e\u73b0\u5bb9\u5668\u540d\u4e4b\u95f4\u7684\u901a\u4fe1\uff1b\u5b83\u7684\u8bed\u6cd5\u662f link \u5bb9\u5668\u540d\uff1a\u522b\u540d docker run -d -p 8083:8083 --name product \\ --link mysql:jacklymysql \\ --link eureka:jacklyeureka \\ registry-jackly/product-server:1.0.0 #\u9a8c\u8bc1\u6548\u679c http://172.31.65.26:8761/ http://172.31.65.26:8083/product/findAllProduct link\u539f\u7406 sh #\u539f\u7406\u5c31\u662f\u5728prodct\u5bb9\u5668\u4e2d\u7684hosts\u52a0\u4e862\u6761\u8bb0\u5f55\u3002 docker exec -it product /bin/bash cat /etc/hosts \u516d\u3001\u6570\u636e\u7ba1\u7406 1\u3001docker\u5bb9\u5668\u7684\u6570\u636e\u5982\u4f55\u5171\u4eab\u7ed9\u5bbf\u4e3b\u673a \u5bbf\u4e3b\u673a\u67e5\u770beureka\u65e5\u5fd7 \u4f7f\u7528docker run volume\u65b9\u5f0f\u5b9e\u73b0 sh #\u6784\u5efa\u955c\u50cf docker build -t registry-jackly/eureka-server:2.0.0 . #\u521b\u5efa\u5bb9\u5668 #\u5c31\u662f\u628adocker\u7684\u6570\u636e\u4fdd\u5b58\u5230\u5bbf\u4e3b\u673a\u7684\u78c1\u76d8\u4e2d\uff0c\u901a\u5e38\u8bf4\u7684\u5c31\u662f\u6302\u8f7d\u70b9\uff0c\u6216\u8005\u53eb\u505a\u5377\u3002 #\u8bed\u6cd5\uff1a -v \u5bbf\u4e3b\u673a\u76ee\u5f55\uff1a\u5bb9\u5668\u76ee\u5f55 docker run -d -p 8761:8761 --name=eureka \\ --privileged=true \\ -v /app/service/eureka/logs:/opt/data \\ registry-jackly/eureka-server:2.0.0 \u4f7f\u7528dockerfile\u65b9\u5f0f\u5b9e\u73b0 ```sh #1.\u57fa\u7840\u955c\u50cf\uff1aFROM\u6307\u4ee4\uff1a\u57fa\u7840\u955c\u50cf\u540d\uff1atag,\u4f8b\u5982java:8 FROM java:8 #2.\u7ef4\u62a4\u8005\uff1a\u683c\u5f0f\uff1aMAINTAINER MAINTAINER jackly #3.\u52a0\u5165\u6302\u8f7d\u70b9 VOLUME /opt/data #4.\u955c\u50cf\u7684\u64cd\u4f5c\u6307\u4ee4 # ADD\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u5bb9\u5668\u4e2d\uff0c\u683c\u5f0f\uff1aADD ADD eureka-server-0.0.1-SNAPSHOT.jar /app/service/eureka/data/app.jar #5.\u544a\u8bc9docker\u5bb9\u5668\u66b4\u9732\u7aef\u53e3\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7-p \u505a\u7aef\u53e3\u6620\u5c04 EXPOSE 8761 #6.\u914d\u7f6e\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6267\u884c\u4ec0\u4e48\u547d\u4ee4 ENTRYPOINT [\"java\",\"-jar\",\"/app/service/eureka/data/app.jar\"] ``` sh #\u91cd\u65b0\u6784\u5efaeureka docker build -t registry-jackly/eureka-server:3.0.0 . #\u521b\u5efa\u5bb9\u5668 docker run -d -p 8761:8761 --name=eureka \\ --privileged=true \\ registry-jackly/eureka-server:3.0.0 \u6ce8\u610f\u70b9\uff1a dockerfile volume \u65e0\u6cd5\u6307\u5b9a\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\uff0c\u90fd\u662f\u81ea\u52a8\u751f\u6210\uff0c\u800c\u4e14\u662f\u968f\u673a\u7684\uff1b\u9ed8\u8ba4\u5728/var/lib/docker/volumes/\u3002\uff08\u4e3a\u4ec0\u4e48\u662f\u968f\u673a\u751f\u6210\uff1f\u56e0\u4e3adockerfile\u65e0\u6cd5\u786e\u5b9a\u6bcf\u53f0\u5bbf\u4e3b\u673a\u662f\u5426\u90fd\u5b58\u5728\u76ee\u5f55\uff09 sh #\u5982\u4f55\u627e\u5230\u5bbf\u4e3b\u673a\u7684\u6302\u8f7d\u76ee\u5f55\uff1f docker inspect eureka #\u4fe1\u606f\u6bb5 \"Mounts\": [ { \"Type\": \"volume\", \"Name\": \"cf527694ebafb92426a52f1916b26832b4c8977093083450a96fbccb3d866669\", \"Source\": \"/var/lib/docker/volumes/cf527694ebafb92426a52f1916b26832b4c8977093083450a96fbccb3d866669/_data\", \"Destination\": \"/opt/data\", \"Driver\": \"local\", \"Mode\": \"\", \"RW\": true, \"Propagation\": \"\" } \u603b\u7ed3 docker run \u662f\u80fd\u6307\u5b9a\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\u3002dockerfile volume\u65e0\u6cd5\u6307\u5b9a\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\uff0c\u90fd\u662f\u81ea\u52a8\u751f\u6210\uff0c\u800c\u4e14\u662f\u968f\u673a\u7684\uff0c\u9ed8\u8ba4\u5728/var/lib/docker/volumes/\u3002 2\u3001\u5bbf\u4e3b\u673a\u5982\u4f55\u76f4\u63a5\u7ef4\u62a4docker\u5bb9\u5668\u7684\u6570\u636e \u5728\u6ca1\u6709\u4f7f\u7528-v\u6302\u8f7d\u70b9\u65f6\uff0c\u521b\u5efa\u7684\u5bb9\u5668\uff0c\u5728\u5bb9\u5668\u5220\u9664\u540e\uff0c\u6839\u636e\u955c\u50cf\u91cd\u65b0\u751f\u6210\u5bb9\u5668\u540e\uff0c\u6570\u636e\u4e5f\u968f\u4e4b\u6d41\u5931\u3002\u5982\u679c\u4f7f\u7528\u4e86\u6302\u8f7d\u70b9\uff0c\u5220\u9664\u5bb9\u5668\u540e\uff0c\u5728\u6839\u636e\u955c\u50cf\u751f\u6210\u5bb9\u5668\uff0c\u6570\u636e\u8fd8\u4f1a\u4fdd\u7559\u3002 docker run -p 3306:3306 --name mysql \\ -e MYSQL_ROOT_PASSWORD=agan \\ --privileged=true \\ -v /app/data/mysql:/var/lib/mysql \\ -d mysql:5.7","title":"\u4e94\u3001\u7f51\u7edc\u7ba1\u7406"},{"location":"docker/#_5","text":"\u642d\u5efa\u4e00\u4e2a\u955c\u50cf\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf\u9700\u89813\u4e2a\u6b65\u9aa4\uff0c\u5206\u522b\u662f\uff1a\u751f\u6210\u4e00\u4e2a\u8ba4\u8bc1\u6587\u4ef6\uff0crsa\u7684\u8ba4\u8bc1\u6587\u4ef6\uff1b\u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93\u5bb9\u5668\uff1b\u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93web\u7ba1\u7406\u7cfb\u7edf \u751f\u6210\u4e00\u4e2a\u8ba4\u8bc1\u6587\u4ef6\uff0crsa\u7684\u8ba4\u8bc1\u6587\u4ef6 sh #\u5efa\u7acb/app/registry-jackly/conf\uff0c\u5728/app/registry-jackly\u76ee\u5f55\u4e0b\u6267\u884c \u4ee5\u4e0b\u547d\u4ee4\uff1a openssl req -new -newkey rsa:4096 -days 365 -subj \"/CN=localhost\" -nodes -x509 -keyout conf/auth.key -out conf/auth.cert \u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93\u7ba1\u7406 ```sh #\u521b\u5efa\u914d\u7f6e\u6587\u4ef6/app/registry-jackly/conf/registry-jackly.yml version: 0.1 #\u955c\u50cf\u5b58\u50a8\u5730\u65b9 storage: filesystem: rootdirectory: /var/lib/registry #\u955c\u50cf\u7684\u5220\u9664\u6743\u9650\uff0cenabled: true\u4ee3\u8868\u5f00\u542f\u5220\u9664\u6743\u9650 delete: enabled: true log: level: info #\u5f00\u542f\u4ed3\u5e93\u7684\u7f51\u7edc\uff0c\u7aef\u53e3\u53f7\u4e3a5000 http: addr: 0.0.0.0:5000 ``` sh #\u521b\u5efa\u4ed3\u5e93\u547d\u4ee4 docker run \\ -v /app/registry-jackly/conf/registry-jackly.yml:/etc/docker/registry/config.yml:ro \\ -v /app/registry-jackly/conf/auth.cert:/etc/docker/registry/auth.cert:ro \\ -p 5000:5000 --name registry-docker -d \\ --privileged=true \\ registry \u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93web\u7ba1\u7406\u7cfb\u7edf sh #\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a/app/registry-jackly/conf/registry-web.yml registry: # \u6307\u5b9aregistry\u7684\u5730\u5740\uff08\u6ce8\u610f\uff1aregistry-docker\u4e3a\u4ed3\u5e93\u7684\u5bb9\u5668\u540d\u5b57\uff09 url: http://registry-docker:5000/v2 #\u4ed3\u5e93\u7684\u540d\u79f0\uff08\u6ce8\u610f\uff1aregistry-docker\u4e3a\u4ed3\u5e93\u7684\u5bb9\u5668\u540d\u5b57\uff09 name: registry-docker:5000 #\u662f\u5426\u4e3a\u53ea\u8bfb\u6a21\u5f0f\uff0c\u8bbe\u7f6etrue\u65f6\uff0c\u4e0d\u5141\u8bb8\u5220\u9664\u955c\u50cf readonly: false #\u6743\u9650\u9a8c\u8bc1 auth: #\u662f\u5426\u5f00\u542f\u9a8c\u8bc1 enabled: true #\u9a8c\u8bc1\u8bc1\u4e66\u7684key key: /conf/auth.key #\u8bc1\u4e66\u9881\u53d1\u8005\u7684\u540d\u79f0 issuer: docker sh #\u521b\u5efa\u4ed3\u5e93web\u7ba1\u7406\u7cfb\u7edf\u547d\u4ee4(\u6ce8\u610f\uff1a--link registry-docker\u5f88\u91cd\u8981\uff0c\u6ca1\u6709\u7684\u8bdd\uff0c\u65e0\u6cd5\u8fde\u63a5\u4ed3\u5e93\u3002) docker run \\ -v /app/registry-jackly/conf/registry-web.yml:/conf/config.yml:ro \\ -v /app/registry-jackly/conf/auth.key:/conf/auth.key \\ -v /app/registry-jackly/db:/data \\ -d -p 8080:8080 --link registry-docker --name registry-web \\ --privileged=true \\ hyper/docker-registry-web \u6548\u679c\u9a8c\u8bc1 ```sh #\u767b\u5f55\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf http://172.31.65.26:8080/login/auth \u7528\u6237\u540d=admin \u5bc6\u7801 =admin #\u6784\u5efa\u955c\u50cf #\u5176\u4e2d -t \u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\uff0c\u4e00\u822c\u7684\u547d\u540d\u6cd5\uff1a\u4ed3\u5e93\u540d\u5b57/\u955c\u50cf\u540d\u5b57\uff1a\u7248\u672c\u53f7 #\u6ce8\u610f\uff1a\u5176\u4e2d .\u53f7\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684dockerfile\u6587\u4ef6 docker build -t registry-docker:5000/eureka-server:3.0.0 . #\u4fee\u6539hosts(vi /etc/hosts) 127.0.0.1 registry-docker #\u7ed9\u642d\u5efa\u597d\u7684\u4ed3\u5e93\u52a0\u4e2a\u955c\u50cf docker push registry-docker:5000/eureka-server:3.0.0 #\u6743\u9650\u8bbe\u7f6e \u9ed8\u8ba4admin\u7528\u6237\u662f\u6ca1\u6709\u5220\u9664\u6743\u9650\uff0c\u9700\u8981\u91cd\u65b0\u521b\u5efa\u7528\u6237\uff0c\u5e76\u4e14\u7ed9\u4e88\u6743\u9650\u3002 ``` \u516b\u3001maven\u6784\u5efaspringcloud\u955c\u50cf \u5728\u5148\u524d\u6784\u5efa\u9879\u76ee\u65f6\uff0c\u5148\u901a\u8fc7maven\u6253\u5305\u51fajar,\u5728\u624b\u52a8\u4e0a\u4f20\u5230\u865a\u62df\u673a\u4e0a\uff0c\u5e76\u7f16\u5199dockerfile\u6587\u4ef6\uff0c\u5728\u4f7f\u7528docker build\u547d\u4ee4\u6784\u5efa\u955c\u50cf\uff0c\u6bd4\u8f83\u7e41\u7410\u3002\u5b9e\u9645\u4e0a\u53ef\u4ee5\u901a\u8fc7maven\u6765\u76f4\u63a5\u6784\u5efaspringcloud\u955c\u50cf\uff0cmaven\u6784\u5efaspringcloud\u955c\u50cf\u63a8\u9001\u7ed9\u4ed3\u5e93\uff0c\u9700\u89812\u6b65\u9aa4\uff1a\u5f00\u542fdocker\u8fdc\u7a0bAPI\uff1b\u7f16\u5199maven\u7684docker\u63d2\u4ef6\u3002 \u5f00\u542fdocker\u8fdc\u7a0bAPI sh #\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u52a0\u5165\uff1a-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock vi /usr/lib/systemd/system/docker.service #\u91cd\u542fdocker systemctl daemon-reload systemctl restart docker #\u9a8c\u8bc1docker\u8fdc\u7a0bapi\u662f\u5426\u751f\u6548 netstat -anp|grep 2375 curl 127.0.0.1:2375/info \u7f16\u5199maven\u7684docker\u63d2\u4ef6 ```sh #\u672c\u5730\u914d\u7f6ehosts(c:\\windows\\system32\\drivers\\etc) 172.31.65.26 registry-docker #docker maven\u63d2\u4ef6 org.springframework.boot spring-boot-maven-plugin com.spotify docker-maven-plugin 1.1.1 registry-docker:5000 http://registry-docker:2375 registry-docker:5000/${project.artifactId}:${project.version} java:8 [\"java\", \"-jar\", \"/${project.build.finalName}.jar\"] ${project.version} latest true true / ${project.build.directory} ${project.build.finalName}.jar #\u6267\u884c\u547d\u4ee4 clean package -DskipTests docker:build ```","title":"\u4e03\u3001\u955c\u50cf\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf\u642d\u5efa"},{"location":"docker/#springcloud","text":"\u4ec0\u4e48\u662fcompose\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528compose \u56e0\u4e3a\u8fd0\u884c\u4e00\u4e2adocker\u955c\u50cf\uff0c\u901a\u5e38\u662f\u9700\u8981docker run \u547d\u4ee4\uff0c\u5728\u8fd0\u884c\u955c\u50cf\u7684\u65f6\u5019\u8fd8\u9700\u8981\u4e00\u5b9a\u7684\u53c2\u6570 \uff1b\u4f8b\u5982 \u5bb9\u5668\u7684\u540d\u79f0 \u6620\u5c04\u7684\u5377\uff0c\u7ed1\u5b9a\u7aef\u53e3\u7b49\u7b49\uff0c\u975e\u5e38\u9ebb\u70e6\u3002\u90a3\u5982\u679c\u6709\u4e2a\u4e00\u4e2a\u6587\u4ef6\u6765\u8bb0\u5f55\u4fdd\u5b58\u8fd9\u4e9b\u547d\u4ee4\u8be5\u591a\u597d\uff1f\u6240\u4ee5compose\u5c31\u662f\u7528\u4e8e\u5b58\u50a8\u8fd9\u4e9b\u547d\u4ee4\uff0c\u800c\u4e14\u5462\u662f\u6bd4docker run\u8fd8\u8981\u7b80\u5355\u5b58\u50a8\u3002\u90a3compose\u662f\u4ec0\u4e48\u5462\uff1f\u5b83\u65e2\u662f\u4e00\u4e2ayaml\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u4f8b\u5982docker-compose.yml\u6587\u4ef6\u3002 ```sh #\u5b89\u88c5\u6700\u65b0compose curl -L https://get.daocloud.io/docker/compose/releases/download/1.21.2/docker-compose- uname -s - uname -m > /usr/local/bin/docker-compose #\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650 chmod +x /usr/local/bin/docker-compose #\u6d4b\u8bd5\u5b89\u88c5\u7ed3\u679c docker-compose --version ``` \u81ea\u52a8\u6784\u5efaspring cloud\u6ce8\u518c\u4e2d\u5fc3eureka \u521b\u5efa\u4e00\u4e2a\u7f51\u7edc sh \u521b\u5efa\u547d\u4ee4\uff1adocker network create dockernet \u67e5\u770b\u547d\u4ee4\uff1adocker network ls compose\u5185\u5bb9\uff1a ```sh #docker compse \u7684\u914d\u7f6e\u6587\u4ef6\u5305\u542b3\u5927\u90e8\u5206\uff1aversion services networks version: '3' services: # \u670d\u52a1\u540d\u79f0 eureka: # \u5bb9\u5668\u540d\u79f0 container_name: eureka # \u955c\u50cf\u540d\u79f0 image: registry-docker:5000/eureka-server:0.0.1-SNAPSHOT # \u66b4\u9732\u7684\u7aef\u53e3\u53f7 ports: - \"8761:8761\" # \u8bbe\u7f6e\u5377\u6302\u8f7d\u7684\u8def\u5f84 /opt/data\u4ee3\u8868\u7684\u662f\u65e5\u5fd7\u5b58\u50a8\u8def\u5f84 volumes: - /app/service/eureka/logs:/opt/data # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet ``` \u8fd0\u884c\u547d\u4ee4 sh docker-compose -f docker-compose-eureka.yml up -d \u6f14\u793a\u6548\u679c sh http://172.31.65.26:8761/ \u81ea\u52a8\u6784\u5efaspring cloud \u914d\u7f6e\u4e2d\u5fc3config compose\u5185\u5bb9 ```sh version: '3' services: config-server: container_name: config-server image: registry-docker:5000/config-server:0.0.1-SNAPSHOT ports: - \"9030:9030\" networks: - default networks: default: external: name: dockernet ``` sh docker-compose -f docker-compose-config.yml up -d sh http://172.31.65.26:9030/e-book-product/default \u81ea\u52a8\u6784\u5efaspring cloud \u8c03\u7528\u94fezipkin compose\u5185\u5bb9 ```sh version: '3' services: zipkin-server: container_name: zipkin-server image: registry-docker:5000/zipkin-server:0.0.1-SNAPSHOT ports: - \"9411:9411\" networks: - default networks: default: external: name: dockernet ``` sh docker-compose -f docker-compose-zipkin.yml up -d sh http://172.31.65.26:9411 \u81ea\u52a8\u6784\u5efaspring cloud \u65e5\u5fd7\u7cfb\u7edfELK compose\u5185\u5bb9 ```sh version: '3' services: elasticsearch: container_name: elasticsearch image: docker.elastic.co/elasticsearch/elasticsearch:6.1.1 command: elasticsearch ports: - \"9200:9200\" - \"9300:9300\" privileged: true networks: - default logstash: container_name: logstash image: docker.elastic.co/logstash/logstash:6.1.1 command: logstash -f /etc/logstash/conf.d/logstash.conf volumes: # \u6302\u8f7dlogstash\u914d\u7f6e\u6587\u4ef6 - /app/service/logstash/config:/etc/logstash/conf.d - /app/service/logstash/build/:/opt/build/ ports: - \"6000:5000\" privileged: true networks: - default kibana: container_name: kibana image: docker.elastic.co/kibana/kibana:6.1.1 environment: - ELASTICSEARCH_URL=http://elasticsearch:9200 ports: - \"5601:5601\" privileged: true networks: - default networks: default: external: name: dockernet ``` logstash.conf\u5b58\u653e\u5728/app/service/config\u4e0b sh # For detail structure of this file # Set: https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html input { # For detail config for log4j as input, # See: https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html tcp { mode => \"server\" host => \"logstash\" #logstash\u5bb9\u5668\u540d\u79f0 port => 9250 } } filter { #Only matched data are send to output. } output { # For detail config for elasticsearch as output, # See: https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html elasticsearch { action => \"index\" #The operation on ES hosts => \"elasticsearch:9200\" #ElasticSearch host, can be array. elasticsearch\u5bb9\u5668\u540d\u79f0 index => \"applog\" #The index to write data to. } } \u8fd0\u884c ```sh docker-compose -f docker-compose-elk.yml up -d \u5982\u679celasticsearch \u62a5\u8fd9\u4e2a\u9519\u8bef ERROR: [1] bootstrap checks failed [1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] \u89e3\u51b3\u65b9\u6848\uff1asudo sysctl -w vm.max_map_count=262144 ``` \u6f14\u793a\u6548\u679c ```sh #\u521b\u5efa\u4e00\u4e2a\u7d22\u5f15 curl -XPUT http://172.31.65.26:9200/applog #\u8fdb\u5165elk\u9875\u9762 http://172.31.65.26:5601/app/kibana ``` \u81ea\u52a8\u6784\u5efaproduct \u670d\u52a1 \u7b2c\u4e00\u6b65\uff1a\u81ea\u52a8\u6784\u5efa mysql \u5fae\u670d\u52a1 ```sh # Docker Compose \u914d\u7f6e\u6587\u4ef6\uff0c\u5305\u542b3\u5927\u90e8\u5206 version\u3001services\u3001networks version: '3' services: # \u670d\u52a1\u540d\u79f0 mysql: # \u5bb9\u5668\u540d\u79f0 container_name: mysql # \u955c\u50cf\u540d\u79f0 image: mysql:5.7 # \u66b4\u9732\u7aef\u53e3 ports: - \"3306:3306\" # \u8bbe\u7f6e\u5377\u6302\u8f7d\u8def\u5f84 volumes: - /app/data/mysql:/var/lib/mysql # \u73af\u5883\u53d8\u91cf environment: MYSQL_USER: root MYSQL_PASSWORD: agan MYSQL_ROOT_PASSWORD: agan # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet #\u542f\u52a8mysql\u5bb9\u5668 docker-compose -f docker-compose-mysql.yml up -d ``` \u7b2c\u4e8c\u6b65\uff1a\u81ea\u52a8\u6784\u5efa product \u5fae\u670d\u52a1 ```sh #docker-compose-product.yml version: '3' services: product: container_name: e-book-product image: registry-docker:5000/e-book-product-core:0.0.1-SNAPSHOT ports: - \"8083:8083\" # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet #\u542f\u52a8\u5bb9\u5668 docker-compose -f docker-compose-product.yml up -d ``` \u7b2c\u4e09\u6b65\uff1a\u6f14\u793a\u6548\u679c sh #\u770b\u6ce8\u518c\u4e2d\u5fc3 http://172.31.65.26:8761/ #\u4ea7\u54c1\u67e5\u8be2\u63a5\u53e3 http://172.31.65.26:8083/product/findAllProduct #\u770b\u65e5\u5fd7 http://172.31.65.26:5601/app/kibana #\u8c03\u7528\u94fe http://172.31.65.26:9411/ \u81ea\u52a8\u6784\u5efa\u81ea\u52a8\u6784\u5efa user order trade consumer \u5fae\u670d\u52a1 \u7b2c\u4e00\u6b65\uff1a \u6784\u5efa\u76f8\u5173\u670d\u52a1 ```sh #docker-compose-service.yml version: '3' services: product: container_name: e-book-product image: registry-docker:5000/e-book-product-core:0.0.1-SNAPSHOT ports: - \"8083:8083\" networks: - default user: container_name: e-book-user image: registry-docker:5000/e-book-user-core:0.0.1-SNAPSHOT ports: - \"8084:8084\" networks: - default order: container_name: e-book-order image: registry-docker:5000/e-book-order-core:0.0.1-SNAPSHOT ports: - \"8085:8085\" networks: - default trade: container_name: e-book-trade image: registry-docker:5000/e-book-trade-core:0.0.1-SNAPSHOT ports: - \"8086:8086\" networks: - default consumer: container_name: e-book-consumer-order image: registry-docker:5000/e-book-consumer-order:0.0.1-SNAPSHOT ports: - \"8090:8090\" networks: - default networks: default: external: name: dockernet #\u542f\u52a8\u5bb9\u5668\u547d\u4ee4 docker-compose -f docker-compose-service.yml up -d ``` \u7b2c\u4e8c\u6b65\uff1a\u6f14\u793a\u6548\u679c sh #\u770b\u6ce8\u518c\u4e2d\u5fc3 http://172.31.65.26:8761/ #\u4ea7\u54c1\u67e5\u8be2\u63a5\u53e3 http://172.31.65.26:8083/product/findAllProduct #\u521b\u5efa\u8ba2\u5355 http://172.31.65.26:8090/createOrder #\u770b\u65e5\u5fd7 http://172.31.65.26:5601/app/kibana #\u8c03\u7528\u94fe http://172.31.65.26:9411/ \u81ea\u52a8\u6784\u5efaspring cloud \u7f51\u5173zuul \u7b2c\u4e00\u6b65\uff1a\u6784\u5efazuul\u670d\u52a1 ```sh #docker-compose-zuul.yml version: '3' services: zuul-gateway: container_name: zuul-gateway image: registry-docker:5000/zuul-gateway:0.0.1-SNAPSHOT ports: - \"9010:9010\" # \u8bbe\u7f6e\u6743\u9650 \uff1a\u62e5\u6709root\u6743\u9650 privileged: true networks: - default networks: default: external: name: dockernet #\u542f\u52a8\u5bb9\u5668 docker-compose -f docker-compose-zuul.yml up -d ``` \u7b2c\u4e8c\u6b65\uff1a\u6f14\u793a\u6548\u679c sh http://172.31.65.26:9010/e-book-consumer-order/createOrder http://172.31.65.26:9010/e-book-product/product/findAllProduct","title":"\u4e5d\u3001\u7f16\u6392\u6784\u5efaspringcloud\u5b9e\u4f8b"}]}